<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Monitoring &amp; Integration Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Monitoring と Integration に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazmon-integ.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazmon-integ.github.io/blog/"/>
  <updated>2021-09-21T12:18:55.402Z</updated>
  <id>https://jpazmon-integ.github.io/blog/</id>
  
  <author>
    <name>Japan Azure Monitoring &amp; Integration Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>&lt;第 4 弾&gt; インターン生から見た Azure Monitoring &amp; Integration チーム</title>
    <link href="https://jpazmon-integ.github.io/blog/general/TeamIntroductionfromInternship/"/>
    <id>https://jpazmon-integ.github.io/blog/general/TeamIntroductionfromInternship/</id>
    <published>2021-09-21T08:00:00.000Z</published>
    <updated>2021-09-21T12:18:55.402Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！Azure Monitoring &amp; Integration チームでサマー インターンシップをさせていただいております、中条 夢佳 (チュウジョウ ユメカ) です。<br>今回はインターン生として実際に働いてみて、Microsoft という会社、サポート エンジニアという仕事、チームの魅力についてお伝えしたいと思います！</p><span id="more"></span><p><img src="/blog/general/TeamIntroductionfromInternship/photo1.png"></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#1-Microsoft-%E3%81%AE%E9%AD%85%E5%8A%9B">1. Microsoft の魅力</a></li><li><a href="#2-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88-%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%81%A8%E3%81%97%E3%81%A6%E5%83%8D%E3%81%8F%E3%81%93%E3%81%A8%E3%81%AE%E9%AD%85%E5%8A%9B">2. サポート エンジニアとして働くことの魅力</a></li><li><a href="#3-Azure-Monitoring-&%5EIntegration-%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AE%E9%AD%85%E5%8A%9B">3. Azure Monitoring &amp; Integration チームの魅力</a></li><li><a href="#4-%E3%81%BE%E3%81%A8%E3%82%81">4. まとめ</a></li></ul><h2 id="1-Microsoft-の魅力"><a href="#1-Microsoft-の魅力" class="headerlink" title="1. Microsoft の魅力"></a>1. Microsoft の魅力</h2><p>Microsoft には自分が輝くのではなく、お客様やチームの仲間を輝かせることを大切にするという考え方があります。他者への貢献が評価され、自社の利益ではなく社会への貢献を目指しているからこそ、Microsoft は長きにわたり成長し続けているのです。『地球上のすべての個人とすべての組織が、より多くのことを達成できるようにする』という Microsoft が掲げているミッションを実現しようとする本気度を感じます。このミッションの “地球上のすべての個人とすべての組織が” ということを実現させるために、Microsoft では社内の多様化が進んでおり、誰もが自己を認められ、自分らしく働くことができる環境作りに取り組んでいます。この Diversity &amp; Inclusion という考え方を知ることで、自分とは異なる価値観とお互いを尊重して認め合うことを学び、より幅広いお客様により適切なアプローチができるようになります。<br>さらに Microsoft ではサポート エンジニアだけではなく、技術的な提案をする営業など他の職種や、海外へ挑戦する機会もあり、日々過去の自分よりも成長しようとすることを歓迎し、評価する文化があります。<br>今年の新卒採用の選考過程、およびサマー インターンシップは、すべてオンラインで実施されています。Microsoft Teamsという自社のIT技術を駆使し、すべてフル リモートで参加できる仕組みが確立されています。こうした社会情勢に柔軟に対応できるというのも、Microsoft ならではの魅力ではないでしょうか。</p><p><img src="/blog/general/TeamIntroductionfromInternship/photo2.png"></p><h2 id="2-サポート-エンジニアとして働くことの魅力"><a href="#2-サポート-エンジニアとして働くことの魅力" class="headerlink" title="2. サポート エンジニアとして働くことの魅力"></a>2. サポート エンジニアとして働くことの魅力</h2><p>お客様が Microsoft の製品をお使いいただく中で、自分では解決できないお困りごとがあると、サポート チームに連絡をいただきます。<br>そして、製品のプロフェッショナルであるサポート エンジニアが、マニュアルに従って、お悩みをサクッと解決！と思いきや、実はそうではないのです。<br>お客様からご相談いただくお困りごとは、一見同じ内容のように見えても、それぞれご質問をいただいた背景が異なります。お客様のご事情を把握し、ご質問を解決した先にあるお客様が達成したいことを実現するために必要な、適切な情報を回答することを大切にしています。ご質問にお答えするだけではなく、さらにお客様にとって価値のある情報を回答するために、お客様から話を伺い、真に必要な情報を見極めることが、サポート エンジニアに求められるスキルです。<br>Microsoft のサポート エンジニアは製品技術の知識、お客様とのコミュニケーションの方法、適切な解決策を導き出す洞察力を身に付けるために最適な場所だと考えています。</p><h2 id="3-Azure-Monitoring-amp-Integration-チームの魅力"><a href="#3-Azure-Monitoring-amp-Integration-チームの魅力" class="headerlink" title="3. Azure Monitoring &amp; Integration チームの魅力"></a>3. Azure Monitoring &amp; Integration チームの魅力</h2><p>チームの皆さんとお話しさせていただく中で、私が感じた魅力をぎゅっと 3 点にまとめてご紹介します。</p><h3 id="助け合い精神"><a href="#助け合い精神" class="headerlink" title="助け合い精神"></a>助け合い精神</h3><p>外資系の会社って社内競争が厳しくて、チーム内が殺伐としていそう… というイメージとは全く逆でした。自分一人で解決できない問題にぶつかったとき、必ずチームの誰かが手を差し伸べてくれます。自分の持っている知識を共有するだけではなく、時には一緒に悩んで解決策を考えて、チームで問題を解決していくという雰囲気の中で、先輩社員の方をお手本にして成長していける環境だと思います。</p><h3 id="思いやりの心"><a href="#思いやりの心" class="headerlink" title="思いやりの心"></a>思いやりの心</h3><p>先輩社員の方は質問がしやすいように、自分がどんなに忙しくとも相談者の対応を優先するという意識を持たれていたり、失敗してしまった後輩社員の方を怒ったり責めたりせず、一緒に落ち込んで、失敗を次に活かす方法を一緒に考えたりしてくださるそうです。<br>チームでは 1 人あたり 30 分の持ち時間で自己紹介、自己開示をする時間を定期的につくっています。これは 1 人 1 回だけで終わりではありません。今までの経験、興味分野、家族、趣味などざっくばらんに、チーム メンバーそれぞれがみんなに知ってもらいたいことをシェアすることで、リモート ワークで離れていても、お互いのことをよく知ることができ、相談しやすいチームの雰囲気作りをしています。</p><h3 id="夢を叶える応援"><a href="#夢を叶える応援" class="headerlink" title="夢を叶える応援"></a>夢を叶える応援</h3><p>マネージャーはチーム ミーティングの際に、技術的な面だけではなく、精神面についてもお伝えくださいます。たとえば、『目標を叶えるための方法』について、ご自身のエピソードを交えて具体的にお話しいただきました。ほかにも『仕事の意義』『絶対不変の真理』『凡事徹底』など、働き方、生き方について、今後の指針になるようなトピックを毎回お伝えいただくことで、自分の課題や今後の目標を見つめ直す機会になります。<br>さらに、マネージャーと定期的に 1 対 1 でお話しする機会があります。自分が今後どうなりたいかをお伝えすると、目標に近づくためにはどうすればよいかを一緒に考えてくださいます。自分自身が成長したい！という想いがあれば、必ず応援してくださる強い味方となってくださるマネージャーがまとめてくださるチームというのは、とても素敵な環境だと感じています。</p><h2 id="4-まとめ"><a href="#4-まとめ" class="headerlink" title="4. まとめ"></a>4. まとめ</h2><p>このチームでのインターンシップを通して、サポート エンジニアのお仕事の魅力は、お客様とサポート エンジニアが共に、問題を解決したいという同じ方向に向かって進むことができることであるとわかりました。だからこそ、難しい問題をチームで解決できた時の達成感や、お客様からいただく “ありがとう” という言葉が、やりがいに繋がっていると感じます。<br>そして、お話しを聞く中で皆さんがおっしゃっていた、チームの皆さんは素敵な人、このチームが好きという言葉にも象徴されるように、お互いを尊重し合いながら働いていらっしゃるのが、このチームの魅力であるように感じています。<br>本当に素敵な Azure Monitoring &amp; Integration チームの皆さんと出会うことができ、インターン生として一緒に働くことができて、とても幸せに思います。<br>自分の成長を日々実感しながら、誰かのために働きたい、そんな思いをお持ちの方は、ぜひ勇気を出して一歩踏み出してみてください！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは！Azure Monitoring &amp;amp; Integration チームでサマー インターンシップをさせていただいております、中条 夢佳 (チュウジョウ ユメカ) です。&lt;br&gt;今回はインターン生として実際に働いてみて、Microsoft という会社、サポート エンジニアという仕事、チームの魅力についてお伝えしたいと思います！&lt;/p&gt;</summary>
    
    
    
    
    <category term="General" scheme="https://jpazmon-integ.github.io/blog/tags/General/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 3 弾&gt; Azure Monitoring &amp; Integration チームのようす、雰囲気について</title>
    <link href="https://jpazmon-integ.github.io/blog/general/OurTeamAtmosphere/"/>
    <id>https://jpazmon-integ.github.io/blog/general/OurTeamAtmosphere/</id>
    <published>2021-09-04T11:00:00.000Z</published>
    <updated>2021-09-21T12:18:55.398Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！Azure Monitoring &amp; Integration チームの猪股です。<br>現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です！！<br>今日は、私たちのチームの普段のようすや雰囲気について紹介いたします。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AE%E3%82%88%E3%81%86%E3%81%99%E3%80%81%E9%9B%B0%E5%9B%B2%E6%B0%97">チームのようす、雰囲気</a></li><li><a href="#Voices-from-our-team">Voices from our team</a></li><li><a href="#%E3%81%93%E3%81%AE%E3%83%81%E3%83%BC%E3%83%A0%E3%82%92%E9%81%B8%E3%82%93%E3%81%A0%E7%90%86%E7%94%B1%E3%81%AF%EF%BC%9F%EF%BC%9F">このチームを選んだ理由は？？</a></li><li><a href="#%EF%BD%9E-%E3%81%82%E3%82%8B%E6%97%A5%E3%81%AE%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%E3%82%88%E3%82%8A-%EF%BD%9E">～ ある日のチャットより ～</a></li><li><a href="#%E3%83%81%E3%83%BC%E3%83%A0-%E3%83%A1%E3%83%B3%E3%83%90%E3%83%BC%E3%81%AE%E6%8A%80%E8%A1%93%E5%BF%97%E5%90%91%E3%82%A8%E3%83%AA%E3%82%A2">チーム メンバーの技術志向エリア</a></li></ul><h2 id="チームのようす、雰囲気"><a href="#チームのようす、雰囲気" class="headerlink" title="チームのようす、雰囲気"></a>チームのようす、雰囲気</h2><p>現在はそれぞれ自宅からフル リモートで仕事しています。わたしも入社して 1 年 4 ヶ月経ちますが、入社してから 2 回 (入社日含む。面接ですら全部オンラインでした) しかオフィスに行ったことないです。ほとんど Teams のチャットや電話で対応できますし、そのような環境が整っており、またチームみんなからのサポートで仕事を進めることができます。</p><p><strong>お陰様で Azure 事業は好調であり、チームも今伸び盛りの状況で更に一緒に Azure Monitoring &amp; Integration サポートを盛り上げていける仲間を募集しています !!!</strong></p><h2 id="Voices-from-our-team"><a href="#Voices-from-our-team" class="headerlink" title="Voices from our team"></a><em><strong>Voices from our team</strong></em></h2><blockquote><p>和気藹々とした雰囲気。 困ったこと、相談事があれば、みんなが積極的に助けてくれる。</p></blockquote><blockquote><p>仲良く、冗談を言い合いながらチームみんなで課題に向かっていくよい雰囲気</p></blockquote><blockquote><p>入社歴が短い人が半数以上で、和気あいあいとやっている雰囲気 。冷たい感じは全くしない 。アットホームな職場です＾＾</p></blockquote><blockquote><p>みんな協力的で、困ったことがあったらすぐにアドバイスをもらえる。</p></blockquote><blockquote><p>あだ名で呼び合っていたり、業務外でのチャットなどでの交流が多かったりと、とても仲の良い雰囲気</p></blockquote><blockquote><p>お問い合わせ対応について私から相談すること、相談をチーム宛にいただく事が多いのですが、 普段から業務内外問わず会話が多く皆さん優しいのでお話しやすいです。 ワーク フロム ホームが一般的な時代になっていますが、仲がいいので疎外感等感じる事はないです。</p></blockquote><blockquote><p>オープン わきあいあい！</p></blockquote><blockquote><p>意見交換しやすい雰囲気です。さりげなく質問することができて、お互いに助け合う雰囲気です。</p></blockquote><blockquote><p>オープン、フレンドリーでカジュアル。みんなでワイワイざっくばらんに盛り上がる感じ</p></blockquote><h2 id="このチームを選んだ理由は？？"><a href="#このチームを選んだ理由は？？" class="headerlink" title="このチームを選んだ理由は？？"></a><em><strong>このチームを選んだ理由は？？</strong></em></h2><blockquote><p>Azure Autmation に興味を持ったため。</p></blockquote><blockquote><p>Monitoring では Azure の様々なサービスの監視を機能なので、Azure を総合的に学ぶのにはとてもいいポジションだと思いました。</p></blockquote><blockquote><p>ログを扱うという事でジャンル問わず様々な製品に関連した業務ができると思ったので。</p></blockquote><blockquote><p>Azure を Deep に身に着けるためです。</p></blockquote><blockquote><p>zabbix とか触っていてサーバー運用していたので、技術エリア的に近いと思ったので</p></blockquote><h2 id="～-ある日のチャットより-～"><a href="#～-ある日のチャットより-～" class="headerlink" title="～ ある日のチャットより ～"></a><em><strong>～ ある日のチャットより ～</strong></em></h2><p>Teams のチャットで困りごとや相談事項、雑談などみなそれぞれのペースで気楽にコミュニケーションとっています :-)<br><img src="/blog/general/OurTeamAtmosphere/chat.png"></p><h2 id="チーム-メンバーの技術志向エリア"><a href="#チーム-メンバーの技術志向エリア" class="headerlink" title="チーム メンバーの技術志向エリア"></a><em><strong>チーム メンバーの技術志向エリア</strong></em></h2><p>どんな Tech が好きか、チーム メンバーに聞いてみました！みんないろんな方向性に興味のベクトルがある感じです☆<br><img src="/blog/general/OurTeamAtmosphere/techarea.png"></p><!--> プログラミング。サービス、技術の動作原理を調べること。> マイコン大好き> 基本的にコンピューターを使うような技術は好き。 Azure のアーキテクチャーを紐解いていくことも好き。> 前職では Kotlin にハマってました。> 歯車が動くような、メカニックなゴツゴツした機械が動くようなハードよりの技術が好きです。 動画認識の技術に注目しています。（手話解析につながりそう）> 仮想化> Azure のサービスではアプリケーションの実装により近い Application Insights や App Service 他は PowerShell や shell などのコマンドライン操作をより快適にする記述方法やツールの使用方法> 自動化できる技術なら何でも好きです。> スクリプトのコーディング　ネットワーク関連のトラシュー--><p>以上、Monitoring &amp; Integration チーム紹介 Blog の第 3 弾でした！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは！Azure Monitoring &amp;amp; Integration チームの猪股です。&lt;br&gt;現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です！！&lt;br&gt;今日は、私たちのチームの普段のようすや雰囲気について紹介いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="General" scheme="https://jpazmon-integ.github.io/blog/tags/General/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 2 弾&gt; Azure Monitoring &amp; Integration チームについて ~リモート ワークでの働き方~</title>
    <link href="https://jpazmon-integ.github.io/blog/general/HowWeWorkRemotely/"/>
    <id>https://jpazmon-integ.github.io/blog/general/HowWeWorkRemotely/</id>
    <published>2021-08-24T10:30:00.000Z</published>
    <updated>2021-09-21T12:18:55.370Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！Azure Monitoring &amp; Integration チームの伊東です。<br>現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です！！<br>今日は、私たちのチームがどのように働いているのか、少しでも皆さんにイメージしていただき、興味をもっていただけるよう、普段の働き方や仕事環境について紹介いたします。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E4%BB%95%E4%BA%8B%E3%81%AE%E6%B5%81%E3%82%8C">仕事の流れ</a></li><li><a href="#%E3%83%87%E3%82%B9%E3%82%AF-%E3%83%84%E3%82%A2%E3%83%BC%EF%BC%81">デスク ツアー！</a></li><li><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88-%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E9%AD%85%E5%8A%9B">リモート ワークの魅力</a></li><li><a href="#%E4%BC%91%E6%86%A9%E6%99%82%E9%96%93%E3%81%AE%E9%81%8E%E3%81%94%E3%81%97%E6%96%B9%E3%80%81%E6%B0%97%E5%88%86%E8%BB%A2%E6%8F%9B%E3%81%AE%E6%96%B9%E6%B3%95">休憩時間の過ごし方、気分転換の方法</a></li></ul><h2 id="仕事の流れ"><a href="#仕事の流れ" class="headerlink" title="仕事の流れ"></a>仕事の流れ</h2><p>Microsoft のサポート エンジニアはお客様から起票いただいたサポート リクエストを通してお客様の抱える問題を解決するための技術支援を行います。<br>案件の受付からクローズまで基本的には担当するメンバーがオーナーシップを持って対応します。<br>基本的な案件対応の流れとしては、<strong>案件の受付 → 調査方針の決定 → 発生している問題の調査 → 回答、事象の解消を確認 → クローズ</strong>、です。<br>案件の受付から、概ね 14 日程度でクローズとなります。<br>各エンジニアは 10 ~ 20 件ほどの案件を担当として受け持ち、また同時並行で案件対応を進めていきます。</p><p>このように記載すると 1 つの案件を最初から最後まで自分ひとりで対応しなければいけないように感じるかもしれません。<br>しかし、実際には同じチームのメンバーや、その他の Azure サポート チームのメンバーと非常に密に連携しながら調査を進めています。<br>クラウド サービスでは、新しい機能の追加や機能の改修が日常的に行われており、もはや一人のスーパー エンジニアが何でも知っている、という時代ではなくなっています。<br>言い換えれば、新しい機能や未知の問題に直面したとき、あなたがその問題の第一人者です。<br>このような状況から、各案件でオーナーシップをとる担当者がいるものの、実際には色々なメンバーと支援をし合いながら調査を行っています。</p><p>次に、Monitoring &amp; Integration チームのサポート エンジニアのとある 1 日について紹介いたします！</p><h3 id="とある-1-日の流れ"><a href="#とある-1-日の流れ" class="headerlink" title="とある 1 日の流れ"></a>とある 1 日の流れ</h3><p><strong>9:00 - サポート窓口が開きます。</strong><br>業務を開始！まずはメール チェックし、今日一日のタスクの洗い出し。</p><hr><p><strong>9:30 - チームの朝会に参加します！</strong><br>チーム全体への共有事項の展開や、サポート案件対応で困ったポイントを相談します。</p><hr><p><strong>10:00 - 新規案件対応。</strong><br>その日に新しくお問い合わせいただいた案件について、お客様へ電話をして対応方針をお客様と相談します。</p><hr><p><strong>12:00 - お昼休憩！</strong><br>家族と一緒にお昼ご飯を食べます！</p><hr><p><strong>13:00 - ミーティングに参加します！</strong><br>チーム ミーティングや他のサポート チームとのミーティングに参加し、打ち合わせを行います。</p><hr><p><strong>14:00 - 案件調査を行います。</strong><br>気合を入れて、時間のかかる調査 (ログの解析、再現テスト) を行います。</p><hr><p><strong>15:00 - Coffee Break ミーティングに参加。</strong><br>Coffee Break ミーティングでは、業務に関連のない雑談もしてリフレッシュ！<br>また、定期的に各メンバーが自己紹介プレゼンを行います。メンバーの新たな一面を知れて、コミュニケーションを取るきっかけになり案件対応の相談もしやすくなっているように感じます！</p><hr><p><strong>15:30 - 調査を再開します！</strong><br>サポート窓口が閉まる 17:30 までにお客様へ調査結果を報告できるようラスト スパート！</p><hr><p><strong>17:30 - サポート窓口が閉まります。</strong><br>気が済むまで、翌日報告予定の案件の調査や、他メンバーの案件の内容を勉強します。</p><h2 id="デスク-ツアー！"><a href="#デスク-ツアー！" class="headerlink" title="デスク ツアー！"></a>デスク ツアー！</h2><p>Monitoring &amp; Integration チームのメンバーのデスクの様子をご紹介いたします！<br>実際のメンバーのデスクですので、こちらからメンバーがどのような環境で働いているのか参考になれば嬉しいです！</p><ul><li><p><em>こだわりのキーボードや椅子に囲まれて業務効率 UP！</em><br><img src="/blog/general/HowWeWorkRemotely/Desk_Kitayama-san.png"></p></li><li><p><em>Simple is the best!</em><br><img src="/blog/general/HowWeWorkRemotely/Desk_Ito.png"></p></li><li><p><em>女優ライトでオンライン ミーティングも完璧！</em><br><img src="/blog/general/HowWeWorkRemotely/Desk_Hori-san.png"></p></li><li><p><em>おしゃれ &amp; 実用性のデスク！</em><br><img src="/blog/general/HowWeWorkRemotely/Desk_Kisara-san.png"></p></li><li><p><em>こだわりの自作 PC で重い作業もサクサク、快適に作業！</em><br><img src="/blog/general/HowWeWorkRemotely/Desk_Inomata-san.png"></p></li></ul><h2 id="リモート-ワークの魅力"><a href="#リモート-ワークの魅力" class="headerlink" title="リモート ワークの魅力"></a>リモート ワークの魅力</h2><p>現在、Monitoring &amp; Integration チームでは、リモート ワーク中心で業務を行っています！<br>実際にメンバーが感じているリモート ワークの魅力がこちらです！</p><ul><li>自分の時間が取りやすい (通勤なし、すぐ家族に会える) のは非常に良いポイント。</li><li>家からでも仕事が出来ました。整えるまで最初は大変ですが、一度環境を作ってしまえば大丈夫。</li><li>家族との時間が格段に増える。</li><li>出勤時間が 0 になるので、自由時間が増える。</li><li>自由なタイミングで休憩時間をとって、役所行ったり子供の面倒を見たり出来る。</li><li>通勤時間がなくなるので、その分を有意義に使えます。</li><li>自分の集中できるときに、集中できる場所で行うことができるなどある程度の自由さ。</li><li>宅配の荷物が受け取れる。</li><li>入社してからずっとフル リモート ワークですが、自分の環境でゆったり仕事できるので効率的。</li></ul><h2 id="休憩時間の過ごし方、気分転換の方法"><a href="#休憩時間の過ごし方、気分転換の方法" class="headerlink" title="休憩時間の過ごし方、気分転換の方法"></a>休憩時間の過ごし方、気分転換の方法</h2><p>このようなリモート ワークの魅力がある一方、運動不足やちょっとした雑談ができないストレスもあります。<br>このようなストレスに対して、休憩時間を使ってどのように対応、気分転換をしているかについてもメンバーに聞いてみました！</p><ul><li>コーヒーを入れる。</li><li>(すぐそこにいる) 子供に会いに行く。</li><li>チーム メンバーにくだらないチャットを投げかけて雑談する</li><li>時々部屋の外に出て猫を揉みに行きます。</li><li>ガムをかむ、目薬をさす、エナジー ドリンクを飲む、チョコレートを食べる、独り言を言う、歌を歌う。</li><li>顔を洗う、歯を磨く、手を洗う、髪の毛を櫛でとく。</li><li>音楽、漫画。</li><li>ゲームをしたり、メンバーとチャットや通話します。</li><li>作曲します。業後にお酒も飲みます。</li><li>寝る！！ あと筋トレ、散歩、おいしいもの食べる。</li></ul><p>以上、Monitoring &amp; Integration チーム紹介 Blog の第二弾でした！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは！Azure Monitoring &amp;amp; Integration チームの伊東です。&lt;br&gt;現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です！！&lt;br&gt;今日は、私たちのチームがどのように働いているのか、少しでも皆さんにイメージしていただき、興味をもっていただけるよう、普段の働き方や仕事環境について紹介いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="General" scheme="https://jpazmon-integ.github.io/blog/tags/General/"/>
    
  </entry>
  
  <entry>
    <title>&quot;The pipeline was not run because a pipeline is already running&quot; エラー発生時の対処方法</title>
    <link href="https://jpazmon-integ.github.io/blog/automation/ThePipelineWasNotRunBecauseAPipelineIsAlreadyRunningError/"/>
    <id>https://jpazmon-integ.github.io/blog/automation/ThePipelineWasNotRunBecauseAPipelineIsAlreadyRunningError/</id>
    <published>2021-08-23T03:00:00.000Z</published>
    <updated>2021-09-21T12:18:55.366Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring &amp; Integration サポート チームの趙です。<br>本日は、Azure Automation の Runbook 実行時、”The pipeline was not run because a pipeline is already running” のエラーでジョブが失敗する場合の対処方法をご紹介していきます。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li>事象<ul><li>この事象はどういう事象ですか？</li><li> このエラーはいつ発生しますか？</li></ul></li><li>原因<ul><li>Automation ジョブの動作</li><li>図解</li></ul></li><li>対策<ul><li>1.処理 (例えば、起動する VM) ごとに、 Automation アカウントを分ける</li><li>2.スケジュールの時間を数分ずらして実行する</li><li>3.Start/Stop VMs during off-hours ソリューションを利用する</li></ul></li></ul><h2 id="事象"><a href="#事象" class="headerlink" title="事象"></a>事象</h2><h3 id="この事象はどういう事象ですか？"><a href="#この事象はどういう事象ですか？" class="headerlink" title="この事象はどういう事象ですか？"></a>この事象はどういう事象ですか？</h3><p>以下エラーで、ジョブが失敗する事象です。</p><pre><code>  The pipeline was not run because a pipeline is already running. Pipelines cannot be run concurrently.</code></pre><h3 id="このエラーはいつ発生しますか？"><a href="#このエラーはいつ発生しますか？" class="headerlink" title="このエラーはいつ発生しますか？"></a>このエラーはいつ発生しますか？</h3><p><strong>同時に複数のジョブを実行</strong>する際に、タイミングによっては、当該エラーが表示され、ジョブが失敗する場合がございます。<br>特にグラフィック Runbook <strong>Start Azure V2 VMs</strong>、<strong>Stop Azure V2 VMs</strong> を利用しているお客様から当該エラーのお問い合わせを複数いただいております。<br>こちらの Runbook をご利用されている方は、後述する対策をご検討いただけますと幸いです。  </p><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>以下 Automation ジョブの動作により、発生する事象です。</p><h3 id="Automation-ジョブの動作"><a href="#Automation-ジョブの動作" class="headerlink" title="Automation ジョブの動作"></a>Automation ジョブの動作</h3><p>Automation では、Runbook を実行すると、 Azure 実行基盤上にワーカーというプロセスが作成されます。<br>このワーカーに Runbook のジョブが割り当てられ (ジョブ 1 : ワーカー 1) 、実行されます。<br>一方で、Runbook による複数のジョブが同一のワーカーにて (ジョブ N : ワーカー 1) 実行されてしまう場合があります。<br>このため、タイミングによっては、該当のエラー メッセージが表示され、ジョブが失敗することがございます。  </p><div class="alert is-info"><p class="alert-title">Note</p><p>お客様から、この動作が修正される予定があるかとのお問い合わせを複数いただいておりますが、</p><p>こちらの動作は、より多くのお客様が Automation サービスをご利用できるように</p><p>Azure 実行基盤上のリソースを効率良く割り当てるための仕組みであり、</p><p>今後、修正される見込みはないこと、ご了承いただければ幸いです。</p></div><div class="alert is-success"><p class="alert-title">ヒント</p><p>Azure Automation の実行基盤は、サンドボックス環境とも呼ばれます。</p><p>サンドボックス環境の実態は、弊社データセンターにあるサーバー インスタンスでございます。</p><p>Automation でジョブが実行されると、このジョブは、弊社データ センターにあるサーバー インスタンス上で、実行されます。</p><p>詳しくは、<a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-runbook-execution#runbook-execution-environment">Runbook の実行環境</a> をご参考いただければ幸いです。</p></div><h3 id="図解"><a href="#図解" class="headerlink" title="図解"></a>図解</h3><p>図で表すと以下のようになります。</p><p><img src="/blog/automation/ThePipelineWasNotRunBecauseAPipelineIsAlreadyRunningError/pipeline2.png"></p><h2 id="対策"><a href="#対策" class="headerlink" title="対策"></a>対策</h2><p>以下 3 つの対策の中でいずれかの対策のご利用をご検討いただけますと幸いです。</p><ol><li>処理 (例えば、起動する VM) ごとに、 Automation アカウントを分ける</li><li>スケジュールの時間を数分ずらして実行する</li><li>Start/Stop VMs during off-hours ソリューションを利用する</li></ol><h3 id="1-処理-例えば、起動する-VM-ごとに、-Automation-アカウントを分ける"><a href="#1-処理-例えば、起動する-VM-ごとに、-Automation-アカウントを分ける" class="headerlink" title="1. 処理 (例えば、起動する VM) ごとに、 Automation アカウントを分ける"></a>1. 処理 (例えば、起動する VM) ごとに、 Automation アカウントを分ける</h3><p>ジョブを実行した Automation アカウントが同一の場合にのみ、<br>Runbook のジョブを実行するワーカーが重複する可能性があります。<br>回避策として、Runbook で実現する処理ごとに、Automation アカウントを分ける対応をご検討いただければ幸いです。</p><p>例えば、VM を起動する Runbook にて、当該エラーが発生した場合、<br>以下例のように VM ごとに Automation アカウントを分けて Runbook を実行する案をご検討いただけますと幸いです。 </p><p>例)</p><table><thead><tr><th>対象 VM</th><th>Automation アカウント</th></tr></thead><tbody><tr><td>VM01</td><td>AutomationAccount-A</td></tr><tr><td>VM02</td><td>AutomationAccount-B</td></tr><tr><td>VM03</td><td>AutomationAccount-C</td></tr><tr><td>VM04</td><td>AutomationAccount-D</td></tr></tbody></table><h3 id="2-スケジュールの時間を数分ずらして実行する"><a href="#2-スケジュールの時間を数分ずらして実行する" class="headerlink" title="2. スケジュールの時間を数分ずらして実行する"></a>2. スケジュールの時間を数分ずらして実行する</h3><p>同時に複数のジョブを実行する場合、<br>Runbook のジョブを実行するワーカーが重複する可能性があります。<br>回避策として、ジョブの同時実行を回避する対応をご検討いただければ幸いです。  </p><p>例えば、VM を起動する Runbook にて、当該エラーが発生した場合、<br>以下例のようにスケジュールの時間をずらして、VM を起動する案をご検討いただけますと幸いです。<br>ジョブの間隔を 2 ~ 3 分程度、空けていただくことを目安と設定いただければ幸いです。</p><p>例)</p><table><thead><tr><th>対象 VM</th><th>ジョブを実行する時刻 (スケジュール)</th><th>Automation アカウント</th></tr></thead><tbody><tr><td>VM01</td><td>2021-08-20 08:00</td><td>AutomationAccount-A</td></tr><tr><td>VM02</td><td>2021-08-20 08:02</td><td>AutomationAccount-A</td></tr><tr><td>VM03</td><td>2021-08-20 08:05</td><td>AutomationAccount-A</td></tr><tr><td>VM04</td><td>2021-08-20 08:07</td><td>AutomationAccount-A</td></tr></tbody></table><h3 id="3-Start-Stop-VMs-during-off-hours-ソリューションを利用する"><a href="#3-Start-Stop-VMs-during-off-hours-ソリューションを利用する" class="headerlink" title="3. Start/Stop VMs during off-hours ソリューションを利用する"></a>3. Start/Stop VMs during off-hours ソリューションを利用する</h3><p>Runbook で VM 起動・停止時に事象が発生する場合は、こちらの策をご検討いただければ幸いです。<br><a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-solution-vm-management">Start/Stop VMs during off-hours ソリューション</a>では、上記のような動作 (一つのワーカーに複数のジョブがアサインされる動作) が回避できる仕組みがスクリプト レベルで実装されております。<br>なお、Start/Stop VMs during off-hours ソリューションをご利用いただくことで、VM の開始および停止をスケジュールで実行することができます。<br>回避策として、Start/Stop VMs during off-hours ソリューションを利用する案をご検討いただければ幸いです。</p><div class="alert is-info"><p class="alert-title">Note</p><p>Runbook <strong>Start Azure V2 VMs</strong> と <strong>Stop Azure V2 VMs</strong> は、グラフィカル Runbook の<a href="https://docs.microsoft.com/ja-jp/azure/automation/learn/automation-tutorial-runbook-graphical">チュートリアル用の Runbook</a> です。</p><p>なお、2016 年に作成された以降、更新されていない Runbook です。</p><p>また、<a href="https://docs.microsoft.com/ja-jp/powershell/azure/new-azureps-module-az?view=azps-6.3.0#supportability">2024 年 2 月 29 日にサポートが終了する AzureRM モジュール</a>を利用する Runbook です。</p><p>そのため、弊社としては、お客様の VM 停止・起動の運用、ワークロードのために利用する Runbook として、Start/Stop VMs during off-hours ソリューションの Runbook のご利用を推奨します。</p><p><img src="/blog/automation/ThePipelineWasNotRunBecauseAPipelineIsAlreadyRunningError/startazurev2vmsstopazurev2vms.png"></p></div><div class="alert is-info"><p class="alert-title">Note</p><p><a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-solution-vm-management">Start/Stop VMs during off-hours ソリューション v1</a>は、2022 年 5 月 21 日に非推奨となる予定です。</p><p>そのため、長期的な観点では、<a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/start-stop-vms/overview">Start/Stop VMs during off-hours ソリューション v2</a> のご利用をご検討いただけますと幸いです。</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring &amp;amp; Integration サポート チームの趙です。&lt;br&gt;本日は、Azure Automation の Runbook 実行時、”The pipeline was not run because a pipeline is already running” のエラーでジョブが失敗する場合の対処方法をご紹介していきます。&lt;/p&gt;</summary>
    
    
    
    
    <category term="FAQ" scheme="https://jpazmon-integ.github.io/blog/tags/FAQ/"/>
    
    <category term="Automation" scheme="https://jpazmon-integ.github.io/blog/tags/Automation/"/>
    
    <category term="Troubleshooting" scheme="https://jpazmon-integ.github.io/blog/tags/Troubleshooting/"/>
    
    <category term="Job" scheme="https://jpazmon-integ.github.io/blog/tags/Job/"/>
    
    <category term="Worker" scheme="https://jpazmon-integ.github.io/blog/tags/Worker/"/>
    
    <category term="StartAzureV2VMs" scheme="https://jpazmon-integ.github.io/blog/tags/StartAzureV2VMs/"/>
    
    <category term="StopAzureV2VMs" scheme="https://jpazmon-integ.github.io/blog/tags/StopAzureV2VMs/"/>
    
    <category term="Sandbox" scheme="https://jpazmon-integ.github.io/blog/tags/Sandbox/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 1 弾&gt; Azure Monitoring &amp; Integration チームについて</title>
    <link href="https://jpazmon-integ.github.io/blog/general/AboutMonandIntg/"/>
    <id>https://jpazmon-integ.github.io/blog/general/AboutMonandIntg/</id>
    <published>2021-08-17T15:00:00.000Z</published>
    <updated>2021-09-21T12:18:55.370Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！Azure Monitoring &amp; Integration チームの猪股です。<br>現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です!!<br>今日は、私たちのチームが普段 Azure のどのような製品を担当しているのかについて、簡単にご案内いたします。</p><h3 id="Azure-Monitoring-amp-Integration-チームについて"><a href="#Azure-Monitoring-amp-Integration-チームについて" class="headerlink" title="Azure Monitoring &amp; Integration チームについて"></a>Azure Monitoring &amp; Integration チームについて</h3><p>Azure Automation, Azure Monitor (Application Insights, Log Analytics), Azure Logic Apps の各製品の技術サポートをしているチームです。<br>現在は完全にフルリモートで各自家から仕事 (WfH, work from home と呼んでいます) しています。</p><ul><li><p>Azure Automation<br><a href="https://docs.microsoft.com/ja-jp/azure/automation/">https://docs.microsoft.com/ja-jp/azure/automation/</a></p></li><li><p>Azure Monitor<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/">https://docs.microsoft.com/ja-jp/azure/azure-monitor/</a></p></li><li><p>Azure Logic Apps<br><a href="https://docs.microsoft.com/ja-jp/azure/logic-apps/">https://docs.microsoft.com/ja-jp/azure/logic-apps/</a></p></li></ul><h3 id="Azure-Automation-ってどんな製品？"><a href="#Azure-Automation-ってどんな製品？" class="headerlink" title="Azure Automation ってどんな製品？"></a>Azure Automation ってどんな製品？</h3><p>PowerShell や Python スクリプトで定義された処理を自動実行させる Runbook、Azure やオンプレミス環境、その他のクラウド環境で、Azure での Windows と Linux VM に対する OS の更新プログラムを管理する Update Mangement、PowerShell Desired State Configuration (DSC) の構成を記述、管理、およびコンパイルできる Azure Automation State Configuration など、クラウド環境の自動化に必要な様々な機能を提供しています。<br><IMG  src="https://docs.microsoft.com/ja-jp/azure/automation/media/automation-runbook-execution/job-statuses.png"  alt="ジョブの状態 - PowerShell Workflow"/></p><h3 id="Azure-Monitor-ってどんな製品？"><a href="#Azure-Monitor-ってどんな製品？" class="headerlink" title="Azure Monitor ってどんな製品？"></a>Azure Monitor ってどんな製品？</h3><p>収集された各種ログ データを Kusto と呼ばれるクエリ言語を使って解析したり、そのクエリを利用してアラートを発報させたりする Log Analytics や、実行中のアプリケーションのパフォーマンスや使用状況を把握したり、監視する Application Insights、VM や AKS 等コンテナー関連の監視機能を提供する VM insights 及び Container insights、Azure Monitor メトリックを使ったデータ収集やアラート作成などなど、非常にバリエーションに富んだ、Azure の監視に必要な機能を提供しています。<br><IMG  src="https://docs.microsoft.com/en-us/azure/azure-monitor/media/overview/overview.png"  alt="Azure Monitor overview"/></p><h3 id="Azure-Logic-Apps-ってどんな製品？"><a href="#Azure-Logic-Apps-ってどんな製品？" class="headerlink" title="Azure Logic Apps ってどんな製品？"></a>Azure Logic Apps ってどんな製品？</h3><p>Logic Apps とは、ビジネス プロセスの実行を自動化するクラウド サービスです。<br>Microsoft が管理するあらかじめ構築された 400 を超える API コネクタと組み込み操作が提供されており、クラウド、オンプレミス、ハイブリッド環境で、レガシ、最新、および最先端システムをより簡単に接続できます。</p><p><img src="https://user-images.githubusercontent.com/76590599/129905624-ca545c60-569b-4e8b-8d0b-58f0d9902c7f.png" alt="Azure Logic Apps overview"></p><p>グラフィカル デザイン ツールを使って、ノンコーディングに必要なものを自由に組み合わせることができるため、さまざまなサービスを簡単に結合してワークフローを実装できる強みがあります。<br><img src="https://user-images.githubusercontent.com/76590599/129907012-eb7c9e68-7f15-4448-936c-a3253a459a7e.png" alt="Azure Logic Apps イメージ図"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは！Azure Monitoring &amp;amp; Integration チームの猪股です。&lt;br&gt;現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です!!&lt;br&gt;今日は、私たちのチームが普段 Azure のど</summary>
      
    
    
    
    
    <category term="General" scheme="https://jpazmon-integ.github.io/blog/tags/General/"/>
    
  </entry>
  
  <entry>
    <title>サービス正常性アラートの設定手順と推奨設定について</title>
    <link href="https://jpazmon-integ.github.io/blog/ame/HowToSetUpServiceHealthAlertsAndRecommendedSettings/"/>
    <id>https://jpazmon-integ.github.io/blog/ame/HowToSetUpServiceHealthAlertsAndRecommendedSettings/</id>
    <published>2021-07-30T15:00:00.000Z</published>
    <updated>2021-09-21T12:18:55.362Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring &amp; Integration サポート チームの堀です。<br>今回はサービス正常性アラートの設定手順と推奨設定についてご案内いたします。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li>サービスの正常性アラートの概要</li><li>サービス正常性アラートの設定手順</li><li>サービス正常性アラートの推奨設定</li></ul><h2 id="サービスの正常性アラートの概要"><a href="#サービスの正常性アラートの概要" class="headerlink" title="サービスの正常性アラートの概要"></a>サービスの正常性アラートの概要</h2><p>サービス正常性アラートでは、お客様環境にてご利用いただいている Azure サービスおよびリージョンを監視対象とし、Azure サービス自体の正常性を監視することが可能です。Azure サービスの障害や、計画メンテナンスの情報を監視でき、イベントが発生した際に、メールや SMS 等の方法で管理者にアラート通知できます。</p><p>サービス正常性アラートにて検知できるイベントの詳細は、下記弊社公開情報をご覧ください。<br>– Service Health の概要<br><a href="https://docs.microsoft.com/ja-jp/azure/service-health/service-health-overview#service-health-events">https://docs.microsoft.com/ja-jp/azure/service-health/service-health-overview#service-health-events</a><br>※ [Service Health のイベント] をご覧ください。</p><h2 id="サービス正常性アラートの設定手順"><a href="#サービス正常性アラートの設定手順" class="headerlink" title="サービス正常性アラートの設定手順"></a>サービス正常性アラートの設定手順</h2><p>以下に、Azure ポータルよりサービス正常性アラートを設定する方法をご案内いたします。</p><ol><li>Azureポータルにログインします。 </li><li>すべてのサービスから [サービス正常性] を開きます。</li><li>左ウィンドウの [アラート] - [正常性アラート] のブレードを開きます。<br><img src="/blog/ame/HowToSetUpServiceHealthAlertsAndRecommendedSettings/Step3.png" alt="Step3"></li><li>画面上部の [サービス正常性アラートの追加] をクリックします。<br><img src="/blog/ame/HowToSetUpServiceHealthAlertsAndRecommendedSettings/Step4.png" alt="Step4"></li><li>[アラート ルールの作成] より、アラートの対象となる [サブスクリプション] 、 [サービス] 、 [リージョン] を選択します。</li><li>監視対象の [イベントの種類] を選択します。</li><li>[アクション グループ] の [アクション グループの選択] をクリックします。任意のアクション グループを指定します。</li><li>[アラートの詳細] より [アラート ルール名] と [説明] を入力します。</li><li>[リソース グループにアラートを保存します] よりアラート ルールを作成する [リソース グループ] を選択します。</li><li>[アラート ルールの作成] をクリックします。 </li></ol><p>手順は以上です。  </p><p>手順の詳細は、下記弊社公開情報をご覧ください。<br>– Azure portal を使用してサービスの通知でアクティビティ ログ アラートを作成する<br><a href="https://docs.microsoft.com/ja-jp/azure/service-health/alerts-activity-log-service-notifications#alert-and-new-action-group-using-azure-portal">https://docs.microsoft.com/ja-jp/azure/service-health/alerts-activity-log-service-notifications#alert-and-new-action-group-using-azure-portal</a></p><h2 id="サービス正常性アラートの推奨設定"><a href="#サービス正常性アラートの推奨設定" class="headerlink" title="サービス正常性アラートの推奨設定"></a>サービス正常性アラートの推奨設定</h2><p>サービス正常性アラート設定時の “サービス” や “リージョン” はすべて選択いただくことを推奨しております。<br>サービス正常性アラートは、ご利用いただいているサービスのご利用いただいているリージョンを対象としたイベントが発生した場合にのみ通知が行われる仕組みです。<br>このため、サブスクリプション上のすべてのサービス、リージョンおよびイベントの種類を選択した場合にも、利用していないリソースに対してアラートは発生いたしません。  </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring &amp;amp; Integration サポート チームの堀です。&lt;br&gt;今回はサービス正常性アラートの設定手順と推奨設定についてご案内いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="How-To" scheme="https://jpazmon-integ.github.io/blog/tags/How-To/"/>
    
    <category term="Tips" scheme="https://jpazmon-integ.github.io/blog/tags/Tips/"/>
    
    <category term="Azure Monitor Essentials" scheme="https://jpazmon-integ.github.io/blog/tags/Azure-Monitor-Essentials/"/>
    
  </entry>
  
  <entry>
    <title>Application Insights クラシック版とワークスペース版との違いについて</title>
    <link href="https://jpazmon-integ.github.io/blog/applicationInsights/aboutDifferentTypesOfAi/"/>
    <id>https://jpazmon-integ.github.io/blog/applicationInsights/aboutDifferentTypesOfAi/</id>
    <published>2021-07-19T15:00:00.000Z</published>
    <updated>2021-09-21T12:18:55.362Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring &amp; Integration サポート チームの北山です。<br>今回の記事では、Application Insights リソースのクラシック版とワークスペース版との違いについて説明します。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E3%83%86%E3%83%AC%E3%83%A1%E3%83%88%E3%83%AA-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BF%9D%E5%AD%98%E5%85%88%E3%81%8C%E7%95%B0%E3%81%AA%E3%82%8B">テレメトリ データの保存先が異なる</a></li><li><a href="#%E3%83%86%E3%83%AC%E3%83%A1%E3%83%88%E3%83%AA-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E6%96%B9%E6%B3%95%E3%81%8C%E7%95%B0%E3%81%AA%E3%82%8B">テレメトリ データのエクスポート方法が異なる</a><ul><li><a href="#%E9%80%A3%E7%B6%9A%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%B3%A8%E6%84%8F%E7%82%B9">連続エクスポートに関する注意点</a></li><li><a href="#%E8%A8%BA%E6%96%AD%E8%A8%AD%E5%AE%9A%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%B3%A8%E6%84%8F%E7%82%B9">診断設定に関する注意点</a></li></ul></li><li><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E4%BF%9D%E6%9C%89%E6%9C%9F%E9%96%93%E3%81%AE%E8%A8%AD%E5%AE%9A%E5%A0%B4%E6%89%80%E3%81%8C%E7%95%B0%E3%81%AA%E3%82%8B">データ保有期間の設定場所が異なる</a></li><li><a href="#%E3%81%9D%E3%81%AE%E4%BB%96-%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%81%94%E8%B3%AA%E5%95%8F">その他 よくあるご質問</a><ul><li><a href="#Q-1-%E6%96%99%E9%87%91%E3%81%AF%E5%A4%89%E3%82%8F%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B">Q 1 料金は変わりますか</a></li><li><a href="#Q-2-%E3%83%AD%E3%82%B0-%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%88-%E3%83%AB%E3%83%BC%E3%83%AB%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%81%9F%E4%BB%8A%E3%81%BE%E3%81%A7%E3%81%AE%E3%82%AF%E3%82%A8%E3%83%AA%E3%81%AF%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B">Q 2 ログ アラート ルールで使用していた今までのクエリは使えなくなりますか</a></li><li><a href="#Q-3-%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E3%82%AF%E3%83%A9%E3%82%B7%E3%83%83%E3%82%AF%E7%89%88%E3%81%8B%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E7%89%88%E3%81%8B%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B">Q 3 どうやってクラシック版かワークスペース版かを確認すればよいですか</a></li><li><a href="#Q-4-%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E7%89%88%E3%81%B8%E7%A7%BB%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%A8%E4%BB%8A%E3%81%BE%E3%81%A7%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B%E6%A9%9F%E8%83%BD%E3%81%AF%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B">Q 4 ワークスペース版へ移行すると、今まで使えなくなる機能はありますか</a></li><li><a href="#Q-5-%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E7%89%88%E3%81%B8%E3%81%AE%E7%A7%BB%E8%A1%8C%E4%BD%9C%E6%A5%AD%E4%B8%AD%E3%81%AF%E3%83%86%E3%83%AC%E3%83%A1%E3%83%88%E3%83%AA-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AF%E6%AC%A0%E8%90%BD%E3%81%97%E3%81%BE%E3%81%99%E3%81%8B">Q 5 ワークスペース版への移行作業中は、テレメトリ データは欠落しますか</a></li></ul></li></ul><h2 id="テレメトリ-データの保存先が異なる"><a href="#テレメトリ-データの保存先が異なる" class="headerlink" title="テレメトリ データの保存先が異なる"></a>テレメトリ データの保存先が異なる</h2><p>クラシック版 Application Insights リソースは、下図のようにテレメトリ データを独自のワークスペースに保存していました。  </p><p><img src="https://user-images.githubusercontent.com/25476639/126289964-fd294432-a722-43f7-91d2-670b2e4a2b1c.png"></p><p>しかしワークスペース版では、Log Analytics ワークスペースに対してテレメトリ データを保存しています。<br>そのため、ワークスペース版 Application Insights リソースを作成する場合は、必ず 1 つの Log Analytics ワークスペースも一緒に作成する必要があります。<br>(既存 Log Analytics ワークスペースを利用することも可能です)</p><p><img src="https://user-images.githubusercontent.com/25476639/126290035-ee93423f-8418-4722-88fd-ddc6692c5e90.png"></p><p>Log Analytics ワークスペースを利用する事で Log Analytics の機能が使えるようになる点が、ワークスペース版のメリットとなります。</p><ul><li>Log Analytics ワークスペースの容量予約レベルが使えるようになり、従量課金制と比べて最大 30 % のコストを抑えることが可能になります。</li><li>カスタマー マネージド キー (CMK) を使って、ユーザー独自の暗号化キーでデータを暗号化が行えます。</li><li>診断設定を用いて、ストレージ アカウントやイベント ハブへの転送可能となります。</li></ul><p>Log Analytics ワークスペースは、他 Azure サービスのリソース ログの分析や Azure VM や オンプレ環境コンピューターのログ分析、Azure Sentinel などでも利用されている、開発が活発なサービスです。<br>そのため、クラシック版では体験出来ないような新機能が、これからもご利用いただけます。<br>そのポイントが主なメリットであると思っています。</p><h4 id="参考資料"><a href="#参考資料" class="headerlink" title="参考資料"></a>参考資料</h4><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/create-workspace-resource#new-capabilities">ワークスペース版の新機能</a></li></ul><h2 id="テレメトリ-データのエクスポート方法が異なる"><a href="#テレメトリ-データのエクスポート方法が異なる" class="headerlink" title="テレメトリ データのエクスポート方法が異なる"></a>テレメトリ データのエクスポート方法が異なる</h2><p>クラシック版とワークスペース版と比較して、下記のような違いがあります。</p><table><thead><tr><th></th><th>クラシック版</th><th>ワークスペース版</th></tr></thead><tbody><tr><td>エクスポート方法</td><td>連続エクスポート</td><td>診断設定</td></tr><tr><td>ストレージ アカウントへのエクスポート</td><td>○</td><td>○</td></tr><tr><td>(別の) Log Analytics ワークスペースへのエクスポート</td><td></td><td>○</td></tr><tr><td>イベント ハブへのエクスポート</td><td></td><td>○</td></tr></tbody></table><p>クラシック版とワークスペース版と比較してエクスポート方法が異なります。<br>そのため、クラシック版からワークスペース版へ移行した場合は、連続エクスポートがご利用出来なくなります。<br>移行前には必ず連続エクスポートを機能を無効化していただき、移行後に診断設定を構築していただく必要があるため注意が必要です。</p><h3 id="連続エクスポートに関する注意点"><a href="#連続エクスポートに関する注意点" class="headerlink" title="連続エクスポートに関する注意点"></a>連続エクスポートに関する注意点</h3><p>現時点では連続エクスポートは非推奨となっております。<br>また、連続エクスポートに対応していないリージョンも存在するため、もしクラシック版で連続エクスポートをご利用いただく場合は、下記のドキュメントをご一読いただくようお願いしています。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/export-telemetry">Application Insights からのテレメトリのエクスポート</a></li></ul><h3 id="診断設定に関する注意点"><a href="#診断設定に関する注意点" class="headerlink" title="診断設定に関する注意点"></a>診断設定に関する注意点</h3><p>ワークスペース版 Application Insights リソースにて、診断設定を利用して他の Log Analytics ワークスペースへエクスポートした場合、当該 Application Insights リソースからログ検索すると<strong>二重でログが取得される</strong>現象が発生します。<br>(Application Insights リソースに紐付いている Log Analytics ワークスペースに格納されたログと、診断設定で指定した他の Log Analytics ワークスペースに格納されたログが取得される)  </p><p>現時点では仕様となっております。<br>そのため、予め注意していただけますと幸いです。</p><h4 id="参考資料-1"><a href="#参考資料-1" class="headerlink" title="参考資料"></a>参考資料</h4><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/export-telemetry">Application Insights からのテレメトリのエクスポート (連続エクスポート)</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/create-workspace-resource#export-telemetry">テレメトリのエクスポート (診断設定)</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/convert-classic-resource#continuous-export">ワークスペース版への移行の際の、連続エクスポートに関する注意点</a></li></ul><h2 id="データ保有期間の設定場所が異なる"><a href="#データ保有期間の設定場所が異なる" class="headerlink" title="データ保有期間の設定場所が異なる"></a>データ保有期間の設定場所が異なる</h2><p>前述のとおり、クラシック版とワークスペース版と比較するとデータ保存先が異なります。<br>データ保有期間は保存先に依存しておりますので、設定場所が異なる点注意が必要です。</p><p>クラシック版の場合は、下図のように Application Insights リソース ページからデータ保有期間の変更が可能です。</p><p><img src="https://user-images.githubusercontent.com/25476639/126421433-3e4872d9-f9b0-43cb-92a0-8a6650ca72b9.png"></p><p>一方でワークスペース版の場合は、Application Insights リソース ページからは変更出来ません。<br>Application Insights リソースに紐付いている Log Analytics ワークスペースにて変更する必要があります。</p><p><img src="https://user-images.githubusercontent.com/25476639/126421328-301f8c10-5039-432d-9fcc-22d148c22b0a.png"></p><h2 id="その他-よくあるご質問"><a href="#その他-よくあるご質問" class="headerlink" title="その他 よくあるご質問"></a>その他 よくあるご質問</h2><h3 id="Q-1-料金は変わりますか"><a href="#Q-1-料金は変わりますか" class="headerlink" title="Q 1 料金は変わりますか"></a>Q 1 料金は変わりますか</h3><p>料金は変わりません。<br>また、ワークスペース版の場合に、Application Insights リソースと Log Analytics ワークスペースとで 2 重に費用が発生するのでは? というご質問をよくいただきますが、2 重に費用が発生しませんのでご安心ください。</p><p>1 つ注意事項といたしましては、連続エクスポートでは発生していなかったコストが、診断設定の場合は追加で費用が発生します。<br>ただ現時点では、下記のドキュメントに記載があるとおり、診断設定によるデータのエクスポートに対する費用は発生しません。<br>しかし、将来的に費用が発生する点ご留意願います。</p><p><img src="https://user-images.githubusercontent.com/25476639/126422733-b6eaddf4-f2aa-4a9c-8a9e-281005a0f04f.png"></p><ul><li><a href="https://azure.microsoft.com/ja-jp/pricing/details/monitor/">Azure Monitor の価格</a></li></ul><h3 id="Q-2-ログ-アラート-ルールで使用していた今までのクエリは使えなくなりますか"><a href="#Q-2-ログ-アラート-ルールで使用していた今までのクエリは使えなくなりますか" class="headerlink" title="Q 2 ログ アラート ルールで使用していた今までのクエリは使えなくなりますか"></a>Q 2 ログ アラート ルールで使用していた今までのクエリは使えなくなりますか</h3><p>ログベースのアラートについては、引き続き完全な下位互換性を提供します。<br>そのため、既存のログ アラート ルールに対してクエリの内容をご変更いただく必要はありません。</p><p>詳細は下記のドキュメントに記載があります。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/convert-classic-resource#understanding-log-queries">ログ クエリについて</a></li></ul><h3 id="Q-3-どうやってクラシック版かワークスペース版かを確認すればよいですか"><a href="#Q-3-どうやってクラシック版かワークスペース版かを確認すればよいですか" class="headerlink" title="Q 3 どうやってクラシック版かワークスペース版かを確認すればよいですか"></a>Q 3 どうやってクラシック版かワークスペース版かを確認すればよいですか</h3><p>Azure potal にて、当該 Application Insights リソース ページへ移動し、概要ページを参照していただければご確認いただけます。</p><p>下図のように Log Analytics ワークスペースのリンクが存在する場合は、ワークスペース版 Application Insights リソースです。</p><p><img src="https://user-images.githubusercontent.com/25476639/126263222-b890c59b-b672-4ff1-9c1e-4e25e1820c4a.png"></p><p>下図のようにワークスペースのリンクがない場合は、クラシック版 Application Insights リソースです。</p><p><img src="https://user-images.githubusercontent.com/25476639/126263264-379cafa3-9ea1-49f5-8e4c-efdf20812b45.png"></p><p>大量に Application Insights リソースが存在して Azure potal から確認するのが大変な場合は、下記のような PowerShell スクリプトを実行いただく事でまとめて確認することが可能です。</p><h4 id="PowerShell-スクリプト"><a href="#PowerShell-スクリプト" class="headerlink" title="PowerShell スクリプト"></a>PowerShell スクリプト</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Connect-AzAccount</span><br><span class="line">Set-AzContext -SubscriptionID &quot;サブスクリプションID&quot;</span><br><span class="line"></span><br><span class="line">$Sub = (Get-AzContext).Subscription.Id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$Token = (Get-AzAccessToken).Token</span><br><span class="line">$AuthHeader = &quot;Bearer &quot; + $Token</span><br><span class="line">$ReqHeader = @&#123;&quot;Authorization&quot; = $AuthHeader; &quot;Accept&quot; = &quot;application/json&quot;&#125;</span><br><span class="line">$ContType = &quot;application/json&quot;</span><br><span class="line"></span><br><span class="line">$AIs = Get-AzApplicationInsights</span><br><span class="line">foreach($AI in $AIs)&#123;</span><br><span class="line"> $AIName = $AI.Name</span><br><span class="line"> $AIRG = $AI.ResourceGroupName</span><br><span class="line"> $Uri = &quot;https://management.azure.com/subscriptions/&quot; + $Sub + &quot;/resourcegroups/&quot; + $AIRG + &quot;/providers/microsoft.insights/components/&quot; + $AIName + &quot;?api-version=2018-05-01-preview&quot;</span><br><span class="line"> $ReqResult = Invoke-WebRequest -Uri $Uri -Headers $ReqHeader -Method GET -ContentType $ContType</span><br><span class="line"> $Cont = $ReqResult.Content | ConvertFrom-Json</span><br><span class="line"> $Workspace = $Cont.properties.WorkspaceResourceId</span><br><span class="line"> Write-Output(&quot;`nAI Name:&quot; + $AI.Name)</span><br><span class="line"> Write-Output(&quot;Workspace Id:&quot; + $Workspace)</span><br><span class="line"> $Workspace = $null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="実行結果"><a href="#実行結果" class="headerlink" title="実行結果"></a>実行結果</h4><p>Workspace Id: に Log Analytics ワークスペースのリソース ID が記述されている場合は、ワークスペース版 Application Insights リソースとなります。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">AI Name:dasasaki-appservice-aspnet48-ampls</span><br><span class="line">Workspace Id:/subscriptions/11b4afdb-3329-42f2-b8dc-b26c5ac19146/resourcegroups/defaultresourcegroup-ejp/providers/microsoft.operationalinsights/workspaces/defaultworkspace-11b4afdb-3329-42f2-b8dc-b26c5ac19146-ejp</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-sparkapp</span><br><span class="line">Workspace Id:</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-csnetcore31</span><br><span class="line">Workspace Id:</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-wsai-jpeast</span><br><span class="line">Workspace Id:/subscriptions/11b4afdb-3329-42f2-b8dc-b26c5ac19146/resourcegroups/dasasaki_rg/providers/microsoft.operationalinsights/workspaces/dasasaki-test</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-aiws-jpeast2</span><br><span class="line">Workspace Id:/subscriptions/11b4afdb-3329-42f2-b8dc-b26c5ac19146/resourcegroups/dasasaki_rg/providers/microsoft.operationalinsights/workspaces/dasasaki-ws-jpeast</span><br><span class="line"></span><br><span class="line">AI Name:dasaski-nodejs14-basic-auth</span><br><span class="line">Workspace Id:</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-appservice-aspnet48-ampls-linux</span><br><span class="line">Workspace Id:/subscriptions/11b4afdb-3329-42f2-b8dc-b26c5ac19146/resourcegroups/defaultresourcegroup-ejp/providers/microsoft.operationalinsights/workspaces/defaultworkspace-11b4afdb-3329-42f2-b8dc-b26c5ac19146-ejp</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-netsdk</span><br><span class="line">Workspace Id:</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="Q-4-ワークスペース版へ移行すると、使えなくなる機能はありますか"><a href="#Q-4-ワークスペース版へ移行すると、使えなくなる機能はありますか" class="headerlink" title="Q 4 ワークスペース版へ移行すると、使えなくなる機能はありますか"></a>Q 4 ワークスペース版へ移行すると、使えなくなる機能はありますか</h3><p>連続エクスポートがご利用いただけなくなります。<br>連続エクスポートの代わりに、診断設定を用いてストレージ アカウントへテレメトリ データを転送する事になる点、ご留意願います。</p><p>アプリケーション マップや可用性テスト、トランザクションの検索などといったそれ以外の機能に関しましては、問題なくご利用いただけますのでご安心ください。</p><h3 id="Q-5-ワークスペース版への移行作業中は、テレメトリ-データは欠落しますか"><a href="#Q-5-ワークスペース版への移行作業中は、テレメトリ-データは欠落しますか" class="headerlink" title="Q 5 ワークスペース版への移行作業中は、テレメトリ データは欠落しますか"></a>Q 5 ワークスペース版への移行作業中は、テレメトリ データは欠落しますか</h3><p>テレメトリ データは欠落しませんので、ご安心して移行作業を実施してください。<br>ただし、その他に注意点がございますので、移行作業は必ず下記のドキュメントを読みながら実施してください。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/convert-classic-resource">ワークスペースベースの Application Insights リソースに移行する</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring &amp;amp; Integration サポート チームの北山です。&lt;br&gt;今回の記事では、Application Insights リソースのクラシック版とワークスペース版との違いについて説明します。&lt;/p&gt;
&lt;h2 id=&quot;目次</summary>
      
    
    
    
    
    <category term="Tips" scheme="https://jpazmon-integ.github.io/blog/tags/Tips/"/>
    
    <category term="Application Insights" scheme="https://jpazmon-integ.github.io/blog/tags/Application-Insights/"/>
    
    <category term="FAQ" scheme="https://jpazmon-integ.github.io/blog/tags/FAQ/"/>
    
  </entry>
  
  <entry>
    <title>Azure Automation の実行アカウントの管理方法の tips と FAQ</title>
    <link href="https://jpazmon-integ.github.io/blog/automation/HowToManageRunAsAccount/"/>
    <id>https://jpazmon-integ.github.io/blog/automation/HowToManageRunAsAccount/</id>
    <published>2021-06-25T03:00:00.000Z</published>
    <updated>2021-09-21T12:18:55.366Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring &amp; Integration サポート チームの伊東です。<br>本日は、Azure Automation の実行アカウントについて、サポート チームによくお問い合わせいただく質問を例に挙げ、実行アカウントをどのように管理していくのか tips をご紹介していきます。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li>Azure Automation の実行アカウントとは</li><li>FAQ<ul><li>Q1: 実行アカウントを作成するためにどのような権限が必要ですか？</li><li>Q2: 実行アカウントの有効期限が切れました。どのような影響がありますか？どう対処すれば良いですか？</li><li>Q3: 実行アカウントの更新に失敗します。実行アカウントの有効期限の更新に必要な権限が知りたいです。</li><li>Q4: 実行アカウントの有効期限が 1 年なのですが、より長い期間に設定したいです。</li><li>Q5: 実行アカウントの有効期限が切れる前に通知を行いたいです。</li></ul></li><li>References</li></ul><h2 id="Azure-Automation-の実行アカウントとは"><a href="#Azure-Automation-の実行アカウントとは" class="headerlink" title="Azure Automation の実行アカウントとは"></a>Azure Automation の実行アカウントとは</h2><p>Azure Automation を利用する多くのユーザー様は、Azure への認証に実行アカウントを利用しています。<br>以下のスクリプトでは、実行アカウントを呼び出してAzure にログインし、Get-AzVM で Azure VM の情報を取得しています。<br>既定では、Azure サブスクリプションの共同作成者ロールが実行アカウントに割り当てられているため、VM の起動停止など、Azure リソースの操作を行うことが可能です。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$connectionName = &quot;AzureRunAsConnection&quot;</span><br><span class="line">$Conn = Get-AutomationConnection -Name $connectionName         </span><br><span class="line"></span><br><span class="line"># Logging in to Azure...</span><br><span class="line">Connect-AzAccount -ServicePrincipal -Tenant $Conn.TenantID -ApplicationId $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint</span><br><span class="line"></span><br><span class="line"># Get the info of Azure VMs</span><br><span class="line">Get-AzVM</span><br></pre></td></tr></table></figure><p>本スクリプト内 “Connect-AzAccount” コマンドで -ServicePrincipal オプションを指定していますね。<br>これは、実行アカウントの実態が Azure Active Directory のサービス プリンシパルであるためです。<br>ユーザー アカウントと同様に、サービス プリンシパルに Azure リソースへの権限を割り当てて、リソースへアクセスすることが可能になります。<br>自動化のシナリオなどで、ユーザー アカウントの資格情報を利用する際に不都合などが発生する場合にサービス プリンシパルを使います。</p><p>本題から少し逸れてしまいますので、ここではサービス プリンシパルの詳しい説明を省きます。<br>もっと詳しい情報を知りたい方は以下の公開情報を参考にしてみてください。</p><ul><li>参考<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/app-objects-and-service-principals">Azure Active Directory のアプリケーション オブジェクトとサービス プリンシパル オブジェクト</a></li></ul><hr><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="Q1-実行アカウントを作成するためにどのような権限が必要ですか？"><a href="#Q1-実行アカウントを作成するためにどのような権限が必要ですか？" class="headerlink" title="Q1: 実行アカウントを作成するためにどのような権限が必要ですか？"></a>Q1: 実行アカウントを作成するためにどのような権限が必要ですか？</h3><p>実行アカウントを作成するために必要な権限は、ユーザー アカウントの種類および Azure AD の設定により異なります。<br>設定のパターンごとに必要な権限を記載しますので、まずは自分がどのパターンに当てはまるか確認していただき、必要な権限をご確認ください。</p><p> <strong>パターン 1</strong><br>&lt;条件&gt;<br>・ユーザー アカウントの種類: Azure AD の “Member”<br>・[Azure ポータル] - [Azure Active Directory] - [ユーザー設定] - [アプリの登録] が “はい” に設定されている。<br>&lt;必要な権限&gt;<br>・サブスクリプションの “所有者” ロール  </p><p><strong>パターン 2</strong><br>&lt;条件&gt;<br>・ユーザー アカウントの種類: Azure AD の “Member”<br>・[Azure ポータル] - [Azure Active Directory] - [ユーザー設定] - [アプリの登録] が “いいえ” に設定されている。<br>&lt;必要な権限&gt;<br>・サブスクリプションの “所有者” ロール<br>・Azure AD の “アプリケーション管理者” ロール  </p><p><strong>パターン 3</strong><br>&lt;条件&gt;<br>・ユーザー アカウントの種類: Azure AD の “Guest”<br>&lt;必要な権限&gt;<br>・サブスクリプションの “所有者” ロール<br>・Azure AD の “アプリケーション管理者” ロール  </p><h3 id="Q2-実行アカウントの有効期限が切れました。どのような影響がありますか？どう対処すれば良いですか？"><a href="#Q2-実行アカウントの有効期限が切れました。どのような影響がありますか？どう対処すれば良いですか？" class="headerlink" title="Q2: 実行アカウントの有効期限が切れました。どのような影響がありますか？どう対処すれば良いですか？"></a>Q2: 実行アカウントの有効期限が切れました。どのような影響がありますか？どう対処すれば良いですか？</h3><p>実行アカウントの有効期限が切れると、以下のようなエラーでAzure へのログインが失敗します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The Run-as certificate might have expired or invalid. Please check &amp; renew the certificate as mentioned here : https://docs.microsoft.com/en-us/azure/automation/manage-runas-account#cert-renewal</span><br><span class="line">Method &#x27;get_SerializationSettings&#x27; in type &#x27;Microsoft.Azure.Management.Internal.Resources.ResourceManagementClient&#x27; from assembly &#x27;Microsoft.Azure.Commands.ResourceManager.Common, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35&#x27; does not have an implementation.</span><br></pre></td></tr></table></figure><p>スクリプトで Azure リソースへの処理を実装していた場合、その処理が失敗することなどが考えられます。<br>そのため、有効期限が切れる前に、以下の手順で実行アカウントの証明書の有効期限を更新する必要があります。<br>実行アカウントの証明書の有効期限は既定では 1 年ですので、更新を忘れないよう注意してください。</p><p><strong>証明書の更新手順</strong></p><ol><li>Azure ポータルにログインします。</li><li>すべてのサービスから [Automation アカウント] を選択し、対象の Automation アカウント名をクリックします。</li><li>[実行アカウント] のブレードを表示し、右側に表示される画面から “Azure 実行アカウント” をクリックします。<br><img src="/blog/automation/HowToManageRunAsAccount/A2Step3.png" alt="A2Step3"></li><li>画面上部から [証明書の更新] - [はい] の順にクリックし、証明書の更新を実行します。<br><img src="/blog/automation/HowToManageRunAsAccount/A2Step4.png" alt="A2Step4"></li></ol><h3 id="Q3-実行アカウントの更新に失敗します。実行アカウントの有効期限の更新に必要な権限が知りたいです。"><a href="#Q3-実行アカウントの更新に失敗します。実行アカウントの有効期限の更新に必要な権限が知りたいです。" class="headerlink" title="Q3: 実行アカウントの更新に失敗します。実行アカウントの有効期限の更新に必要な権限が知りたいです。"></a>Q3: 実行アカウントの更新に失敗します。実行アカウントの有効期限の更新に必要な権限が知りたいです。</h3><p>実行アカウントの更新を行うためには、そのユーザーが十分な権限を有している必要があります。<br>証明書の更新を行うには、以下のどちらからの条件を満たすように権限を割り当ててください。</p><p><strong>条件 1</strong><br>・Azure AD の “アプリケーション管理者” ロール<br>・サブスクリプションの “所有者” ロール  </p><p><strong>条件 2</strong><br>・実行アカウント作成時に作成されるサービス プリンシパルの “所有者”<br>・サブスクリプションの “所有者” ロール  </p><p>※ サービス プリンシパルの所有者の一覧は以下の手順で確認することができます。</p><p><strong>サービス プリンシパルの所有者 確認手順</strong></p><ol><li>Azure ポータルにログインします。</li><li>すべてのサービスから [Automation アカウント] を選択し、対象のアカウント名をクリックします。</li><li>[実行アカウント] のブレードを表示し、右側に表示される画面から “Azure 実行アカウント” をクリックします。</li><li>実行アカウントの詳細な情報が記載された画面が表示されますので、Azure AD アプリケーションの [表示名] をコピーします。<br><img src="/blog/automation/HowToManageRunAsAccount/A3Step4.png" alt="A3Step4"></li><li>次に、すべてのサービスから [Azure AD] を選択します。</li><li>画面左端から [アプリの登録] のブレードを表示します。</li><li>手順 4 にてコピーした “表示名” を検索ボックスに入力します。<br><img src="/blog/automation/HowToManageRunAsAccount/A3Step7.png" alt="A3Step7"></li><li>表示されたアプリケーションをクリックし、[所有者] のブレードを表示します。</li></ol><h3 id="Q4-実行アカウントの有効期限が-1-年なのですが、より長い期間に設定したいです。"><a href="#Q4-実行アカウントの有効期限が-1-年なのですが、より長い期間に設定したいです。" class="headerlink" title="Q4: 実行アカウントの有効期限が 1 年なのですが、より長い期間に設定したいです。"></a>Q4: 実行アカウントの有効期限が 1 年なのですが、より長い期間に設定したいです。</h3><p>Azure ポータルから実行アカウントを作成すると有効期限は既定では 1 年ですが、Azure PowerShell を利用することで任意の有効期限を設定できます。<br>以下の公開情報にて、PowerShell にて実行アカウントを作成する手順をご案内していますので、こちらの手順を実施してください。</p><ul><li>公開情報<br><a href="https://docs.microsoft.com/ja-jp/azure/automation/create-run-as-account#powershell-script-to-create-a-run-as-account">実行アカウントを作成する PowerShell スクリプト</a></li></ul><p>※ 補足<br>以下サンプル コマンドのように SelfSignedCertNoOfMonthsUntilExpired を引数に指定することで有効期限を月単位で指定できます。<br>下記の例の場合には、100 年 (1200 ヶ月) の有効期限をもつ証明書を作成します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\Create-RunAsAccount.ps1 -ResourceGroup &lt;Automation アカウントのリソース グループ名&gt; -AutomationAccountName &lt;Automation アカウント名&gt; -SubscriptionId &lt;サブスクリプション ID&gt; -ApplicationDisplayName &lt;実行アカウントの表示名&gt; -SelfSignedCertPlainPassword &lt;任意のパスワード&gt; -CreateClassicRunAsAccount $false -SelfSignedCertNoOfMonthsUntilExpired 1200</span><br></pre></td></tr></table></figure><h3 id="Q5-実行アカウントの有効期限が切れる前に通知を行いたいです。"><a href="#Q5-実行アカウントの有効期限が切れる前に通知を行いたいです。" class="headerlink" title="Q5: 実行アカウントの有効期限が切れる前に通知を行いたいです。"></a>Q5: 実行アカウントの有効期限が切れる前に通知を行いたいです。</h3><p>既定では、証明書の有効期限を検知して通知を行う機能はありません。<br>なお、Get-AzAutomationCertificate コマンドで実行アカウントの証明書の有効期限を取得できます。<br>こちらのコマンドレットを利用して有効期限を取得し、メール通知を行うサンプル スクリプトをご案内します。<br>タスクスケジューラや Azure Automation などの自動化ツールでスクリプトをスケジュール実行するよう設定ください。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"># パラメータ (適宜ご変更ください。)</span><br><span class="line">$RGname=&quot;リソース グループ名&quot;</span><br><span class="line">$AAname=&quot;Automation アカウント名&quot;</span><br><span class="line">$SubscriptionId=&quot;サブスクリプション ID&quot;</span><br><span class="line">$notificationtime=30 #この値より有効期限の残り日数が小さい場合に通知を行う </span><br><span class="line">$automationCertificateName=&quot;証明書の名前&quot; # [Azure ポータル - Autoamtion アカウント - 証明書 - 名前] からご確認ください。 </span><br><span class="line">$mail = @&#123;</span><br><span class="line">    from = &quot;*********@ex***le.com&quot;;</span><br><span class="line">    to = &quot;***@ex***le.com&quot;;</span><br><span class="line">    smtp_server = &quot;smtp.*****.com&quot;;</span><br><span class="line">    smtp_port = ***;</span><br><span class="line">    user = &quot;**************@*****.com&quot;;</span><br><span class="line">    password = &quot;********&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 認証情報生成</span><br><span class="line">$password = ConvertTo-SecureString $mail[&quot;password&quot;] -AsPlainText -Force</span><br><span class="line">$credential = New-Object System.Management.Automation.PSCredential $mail[&quot;user&quot;], $password</span><br><span class="line"></span><br><span class="line"># ログイン</span><br><span class="line">Connect-AzAccount</span><br><span class="line">Select-AzSubscription -SubscriptionId $SubscriptionId</span><br><span class="line"></span><br><span class="line"># 有効期限の取得</span><br><span class="line">$result=Get-AzAutomationCertificate -ResourceGroupName $RGname -AutomationAccountName $AAname | Where-Object&#123;$_.Name -match $automationCertificateName&#125;</span><br><span class="line">$result</span><br><span class="line">if (!$result) &#123;</span><br><span class="line">    # 実行アカウントが見つからなかった場合</span><br><span class="line">    throw &quot;Automation Account に実行アカウントが存在しません。&quot;    </span><br><span class="line">&#125;</span><br><span class="line">$ExpireDate=$result.ExpiryTime.Date</span><br><span class="line"></span><br><span class="line"># 本日の日付を取得</span><br><span class="line">$today=Get-Date</span><br><span class="line"></span><br><span class="line"># 残り日数を計算</span><br><span class="line">$diff=$ExpireDate - $today</span><br><span class="line"></span><br><span class="line">if ($diff.Days -lt 0)&#123;</span><br><span class="line">    # 既に有効期限切れをしていればメールを送信</span><br><span class="line">    Send-MailMessage -To $mail[&quot;to&quot;] `</span><br><span class="line">                 -From $mail[&quot;from&quot;] `</span><br><span class="line">                 -SmtpServer $mail[&quot;smtp_server&quot;] `</span><br><span class="line">                 -Credential $credential `</span><br><span class="line">                 -Port $mail[&quot;smtp_port&quot;] `</span><br><span class="line">                 -Subject &quot;[Urgent] The certificate has already been expired.&quot; `</span><br><span class="line">                 -Body &quot;証明書は既に有効期限が切れています。更新を行ってください。&quot; `</span><br><span class="line">                 -Encoding UTF8 `</span><br><span class="line">                 -UseSsl</span><br><span class="line">&#125; elseif ($notificationtime -gt $diff.Days)&#123;</span><br><span class="line">    # 指定した期間より有効期限が短ければメールを送信</span><br><span class="line">    Send-MailMessage -To $mail[&quot;to&quot;] `</span><br><span class="line">                 -From $mail[&quot;from&quot;] `</span><br><span class="line">                 -SmtpServer $mail[&quot;smtp_server&quot;] `</span><br><span class="line">                 -Credential $credential `</span><br><span class="line">                 -Port $mail[&quot;smtp_port&quot;] `</span><br><span class="line">                 -Subject &quot;[Urgent] The certificate will be expired.&quot; `</span><br><span class="line">                 -Body &quot;証明書の有効期限は残り $($diff.Days) 日です。&quot; `</span><br><span class="line">                 -Encoding UTF8 `</span><br><span class="line">                 -UseSsl</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="alert is-warning"><p class="alert-title">警告</p><p>本サンプル スクリプトは、サンプルとして提供されるものであり、製品の実運用環境で使用されることを前提に提供されるものではありません。</p><p>本サンプルコードおよびそれに関連するあらゆる情報は、「現状のまま」で提供されるものであり、明示・黙示を問わずいかなる保証も付されるものではありません。</p><p>こちらのサンプルを利用される際には、検証環境などで動作を十分にご確認の上、ご利用ください。</p></div><hr><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://docs.microsoft.com/ja-jp/azure/automation/create-run-as-account">Azure Automation の実行アカウントを作成する方法</a><br><a href="https://docs.microsoft.com/ja-jp/azure/automation/manage-runas-account">Azure Automation の実行アカウントを管理する</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring &amp;amp; Integration サポート チームの伊東です。&lt;br&gt;本日は、Azure Automation の実行アカウントについて、サポート チームによくお問い合わせいただく質問を例に挙げ、実行アカウントをどのように管理していくのか tips をご紹介していきます。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Tips" scheme="https://jpazmon-integ.github.io/blog/tags/Tips/"/>
    
    <category term="FAQ" scheme="https://jpazmon-integ.github.io/blog/tags/FAQ/"/>
    
    <category term="Automation" scheme="https://jpazmon-integ.github.io/blog/tags/Automation/"/>
    
    <category term="RunAs Account" scheme="https://jpazmon-integ.github.io/blog/tags/RunAs-Account/"/>
    
  </entry>
  
  <entry>
    <title>Azure Monitoring &amp; Integration チームの Blog リニューアルのお知らせ</title>
    <link href="https://jpazmon-integ.github.io/blog/general/IntroduceOurBlog/"/>
    <id>https://jpazmon-integ.github.io/blog/general/IntroduceOurBlog/</id>
    <published>2021-06-16T03:00:00.000Z</published>
    <updated>2021-09-21T12:18:55.398Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Blog-リニューアルのお知らせ"><a href="#Blog-リニューアルのお知らせ" class="headerlink" title="Blog リニューアルのお知らせ"></a>Blog リニューアルのお知らせ</h2><p>こんにちは、Azure Monitoring &amp; Integration サポート チームです。<br>この度、Monitoring &amp; Integration サポート チームのブログをリニューアルいたしましたのでお知らせします！</p><span id="more"></span><p>こちらのブログでは、Monitoring や Integration 製品のテクノロジーに関する話題を中心に情報を発信していきます。<br>開発部門などからも多くの公式な公開情報を提供しておりますが、私たちのブログでは、新機能に関してのご紹介だけでなく、日本の多くの Azure ご利用者からサポートの依頼を直接受けているサポート エンジニアという立場から、時には私どもの視点を交えて、皆様のお役に立つ情報をご案内したいと思います。<br>これから本ブログで公開していく情報の一例を以下に記載しました。</p><h3 id="公開する情報の例"><a href="#公開する情報の例" class="headerlink" title="公開する情報の例"></a>公開する情報の例</h3><ul><li>リリースされたばかりの新機能に関する情報</li><li>よくサポート チームにお問い合わせいただく “あるある” な問題への対処方法</li><li>Azure を利用するユーザーの方に是非お伝えしたい情報 </li><li>ある問題についてサポートにお問い合わせいただく際、スムーズに調査を進めるために事前に採取いただきたい情報</li></ul><h3 id="本ブログで扱うテクノロジーの例"><a href="#本ブログで扱うテクノロジーの例" class="headerlink" title="本ブログで扱うテクノロジーの例"></a>本ブログで扱うテクノロジーの例</h3><ul><li>Azure Monitor</li><li>Azure Log Analytics</li><li>Azure Automation</li><li>Azure Application Insights</li><li>Azure Logic Apps</li><li>BizTalk Server</li><li>Host Integration Server</li><li>Microsoft Message Queue (MSMQ) Serve</li></ul><p>これから様々な情報を発信しますので、こちらのブログが皆さまのお役に立てれば幸いです。<br>また、実際のサポート サービスでは、製品動作に関する正式な見解のご提供、そして問題解決のサポートを行っていますので、こちらも併せてよろしくお願いいたします！</p><p>※ これまで公開していたフォーラムは以下のリンクからアクセスできますので、過去の情報はこちらからご確認ください。<br><a href="https://social.technet.microsoft.com/Forums/ja-JP/home?forum=jpama">以前のフォーラム (アーカイブ) はこちら</a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Blog-リニューアルのお知らせ&quot;&gt;&lt;a href=&quot;#Blog-リニューアルのお知らせ&quot; class=&quot;headerlink&quot; title=&quot;Blog リニューアルのお知らせ&quot;&gt;&lt;/a&gt;Blog リニューアルのお知らせ&lt;/h2&gt;&lt;p&gt;こんにちは、Azure Monitoring &amp;amp; Integration サポート チームです。&lt;br&gt;この度、Monitoring &amp;amp; Integration サポート チームのブログをリニューアルいたしましたのでお知らせします！&lt;/p&gt;</summary>
    
    
    
    
    <category term="General" scheme="https://jpazmon-integ.github.io/blog/tags/General/"/>
    
  </entry>
  
  <entry>
    <title>Webhook の実行が ”(404) 見つかりません” で失敗する</title>
    <link href="https://jpazmon-integ.github.io/blog/automation/404ErrorOccurrWhenRunningWebhook/"/>
    <id>https://jpazmon-integ.github.io/blog/automation/404ErrorOccurrWhenRunningWebhook/</id>
    <published>2019-04-02T17:27:00.000Z</published>
    <updated>2021-09-21T12:18:55.362Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure サポート チームの世古です。<br>今回は Azure Automation で Webhook を実行する際に記録されるエラー ”(404) 見つかりません” の原因および対処方法についてご案内させていただきます。</p><p>記録されるエラーについては以下の通りです。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR [TID:*] [] System.Net.WebException: リモート サーバーがエラーを返しました: (404) 見つかりません</span><br></pre></td></tr></table></figure><p>上記内容にあります通り、Runbook を実行しようとしたが実行する URL が見つからない為、404 のエラーを記録して、Runbook の実行に失敗します。</p><h1 id="対処方法について"><a href="#対処方法について" class="headerlink" title="対処方法について"></a>対処方法について</h1><p>URL が見つからない要因としては、一般的に Webhook 作成時に指定した URL の有効期限が影響している可能性がございます。<br>その為、まずは同様のエラーで失敗する場合には Webhook の有効期限をご確認ください。<br>有効期限が既に切れている場合には、Runbook で実行する事は出来ませんので、再度 Webhook を再作成くださいますようお願いします。<br>以下確認方法についてご紹介します。</p><p><img src="/blog/automation/404ErrorOccurrWhenRunningWebhook/SpecifyExpireOfWebhook.png" alt="Webhook での有効期限の指定" title="Webhook での有効期限の指定"></p><p><img src="/blog/automation/404ErrorOccurrWhenRunningWebhook/CheckExpirationDateWebhook.png" alt="Webhook の有効期限確認方法" title="Webhook の有効期限確認方法"></p><h1 id="参考-有効期限の指定について"><a href="#参考-有効期限の指定について" class="headerlink" title="参考 有効期限の指定について"></a>参考 有効期限の指定について</h1><p>Webhook で URL を指定して実行するのは簡単で便利ですが、URL の有効期限についてはセキュリティ面の観点でも非常に大事な項目となります。<br>例えば、外部トークンの URL が外部に漏れた場合には、誰でも Runbook が実行出来るようになるためです。<br>詳細は<a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-webhooks">公開情報</a>を確認いただければと存じますが、ただ長期の期間を指定するのではなく、適切な有効期限を指定する事を推奨しております。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure サポート チームの世古です。&lt;br&gt;今回は Azure Automation で Webhook を実行する際に記録されるエラー ”(404) 見つかりません” の原因および対処方法についてご案内させていただきます。&lt;/p&gt;
&lt;p&gt;記録されるエラーに</summary>
      
    
    
    
    
    <category term="Automation" scheme="https://jpazmon-integ.github.io/blog/tags/Automation/"/>
    
    <category term="Troubleshooting" scheme="https://jpazmon-integ.github.io/blog/tags/Troubleshooting/"/>
    
    <category term="Webhook" scheme="https://jpazmon-integ.github.io/blog/tags/Webhook/"/>
    
  </entry>
  
  <entry>
    <title>Runbook の Update-AzureRmVM コマンドが &#39;Vhd&#39; cannot be null. で失敗する</title>
    <link href="https://jpazmon-integ.github.io/blog/automation/update-AzureRmVmCommandFailesWithVhdCannotBeNull/"/>
    <id>https://jpazmon-integ.github.io/blog/automation/update-AzureRmVmCommandFailesWithVhdCannotBeNull/</id>
    <published>2019-04-02T17:26:00.000Z</published>
    <updated>2021-09-21T12:18:55.370Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Windows プラットフォーム サポートの世古です。<br>今回は Azure  Automation の Runbook 実行でよくお問い合わせいただく内容についてご紹介させていただきます。</p><p>Runbook の実行で Update-AzureRmVM が ‘Vhd’ cannot be null. で失敗する事象がございます。<br>この問題は以下の条件で発生します。</p><ul><li>対象の VM が管理ディスクを持つ</li><li>モジュールのバージョンが最新でない</li></ul><p>この問題はモジュールのバージョンを最新に更新いただく事で回避されますので、以下の公開情報の手順を実施下さい。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-update-azure-modules">Azure Automation の Azure PowerShell モジュールを更新する方法</a></li></ul><p>以前の Powershell モジュールにおいては、管理ディスクを操作可能な実装が含まれていなかった為、VM の情報を正常に取得出来なかった為、本問題が発生いたします。その為、モジュールのアップデートをご検討ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Windows プラットフォーム サポートの世古です。&lt;br&gt;今回は Azure  Automation の Runbook 実行でよくお問い合わせいただく内容についてご紹介させていただきます。&lt;/p&gt;
&lt;p&gt;Runbook の実行で Update-AzureR</summary>
      
    
    
    
    
    <category term="Automation" scheme="https://jpazmon-integ.github.io/blog/tags/Automation/"/>
    
    <category term="Troubleshooting" scheme="https://jpazmon-integ.github.io/blog/tags/Troubleshooting/"/>
    
    <category term="Runbook" scheme="https://jpazmon-integ.github.io/blog/tags/Runbook/"/>
    
  </entry>
  
  <entry>
    <title>Azure Automation にて特定期間のジョブの実行時間を取得する</title>
    <link href="https://jpazmon-integ.github.io/blog/automation/gettingExeTimeOfJobForSpecificPeriodAutomation/"/>
    <id>https://jpazmon-integ.github.io/blog/automation/gettingExeTimeOfJobForSpecificPeriodAutomation/</id>
    <published>2019-04-02T17:15:00.000Z</published>
    <updated>2021-09-21T12:18:55.370Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは Azure サポート チームの村田です。<br>Azure Automation においては昨年価格体系が変更されました</p><p>具体的には以下のように以前の Free、Basic という概念がなくなり、以下のように統合された価格体系となっております。</p><ul><li>以前の価格料金<ul><li>Free - 月あたり 500 分の無料時間が付与され、超過した場合はジョブが実行されなくなります。</li><li>Basic - 従量課金として、0.23円 / 分 で課金が発生します。</li></ul></li><li>変更後の価格体系<ul><li>無償の500分のジョブ実行時間が付与され、超過した分に関しましては、0.23円 / 分 で課金が発生します。</li></ul></li></ul><h2 id="参照情報"><a href="#参照情報" class="headerlink" title="参照情報"></a>参照情報</h2><ul><li>Automation の価格<ul><li><a href="https://azure.microsoft.com/ja-jp/pricing/details/automation/">https://azure.microsoft.com/ja-jp/pricing/details/automation/</a></li></ul></li></ul><p>以前は Basic プランの場合、最初の1分から課金対象となっていましたが、新しいプランでは、必ず 月あたり 500 分の無料ジョブ実行時間がつくのでプラン的にはお得になってますね。</p><p>しかし、この価格体系の変更に伴い、Automation アカウントの画面内から、月のジョブの実行時間の累計を表示する項目が消えてしまいました。</p><p>したがいまして、今どの程度ジョブの実行時間を消費しているのかわからないとご質問をいただく場合がございます。</p><p>そんな場合に備え、今回はローカルから PowerShell を実行する事で、特定の期間のジョブの実行時間を取得するスクリプトをご案内します。</p><p>日別にジョブ実行時間が取得できるため、特定の日時のみジョブの実行時間がとても長い際などには、トラブルシューティングにも便利ですので是非ご利用ください。</p><h3 id="スクリプトの実行環境要件"><a href="#スクリプトの実行環境要件" class="headerlink" title="スクリプトの実行環境要件"></a>スクリプトの実行環境要件</h3><p>Windows 10またはWindows Server 2016でコンピュータを実行している場合は、すでにPowerShell 5以降がインストールされているため、この手順は必要ありません。</p><p>今回の場合、PowerShell のバージョンは 3.0 とのことですので、PowerShellを含むWindows Management Framework（WMF）の最新バージョンに更新する必要がございます。</p><ul><li>WMFの最新バージョンを入手するには、次のURLにアクセスしてください。<ul><li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=54616">https://www.microsoft.com/en-us/download/details.aspx?id=54616</a></li></ul></li><li>WMFとパッケージ管理へのリンクを含むPowerShell Galleryの使用に関する詳細は、下記を参照してください。<ul><li><a href="https://www.powershellgallery.com/">https://www.powershellgallery.com/</a></li></ul></li></ul><h2 id="Azure-RM-モジュールのインストール"><a href="#Azure-RM-モジュールのインストール" class="headerlink" title="Azure RM モジュールのインストール"></a>Azure RM モジュールのインストール</h2><p>AzureからPowerShell経由で情報を照会できるようにするには、Azure Resource Management（AzureRM）モジュールをインストールする必要があります。</p><p>先に進む前に、お使いのコンピュータがパッケージ管理の要件を満たしていることを確認してください。</p><p>AzureRMモジュールをインストールするには、以下の手順に従います。</p><ol><li>[管理者として実行]オプションを使用してPowerShellセッションを開きます。</li><li>Install-Module -Name AzureRM -Force -Verboseと入力し、Enterキーを押します。</li><li>インストールが完了するまで待ち、PowerShellのプロンプトに戻ります。</li><li>モジュールがインストールされたことを確認するために、Get-Module -Name AzureRM -ListAvailableと入力し、Enterキーを押します。</li></ol><h3 id="実行スクリプト"><a href="#実行スクリプト" class="headerlink" title="実行スクリプト"></a>実行スクリプト</h3><p>PowerShell ISE を起動し、以下のスクリプトを貼り付け、期間を指定して実行します。<br>※ブロックが複数にわかれておりますが、すべて一つのスクリプトに記載してください。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Add-AzureRMAccount | Write-Verbose</span><br><span class="line">#ジョブの実行時間を保存するディレクトリを記載します。</span><br><span class="line">$CSVFile = &quot;c:\temp\automation.csv&quot;</span><br><span class="line">#ジョブの実行時間を取得する期間の開始日時を指定します</span><br><span class="line">$StartTime = &quot;12/01/2017&quot;</span><br><span class="line">#ジョブの実行時間を取得する期間の終了日時を指定します</span><br><span class="line">$EndTime = &quot;12/08/2017&quot;</span><br><span class="line"></span><br><span class="line">#ジョブの実行時間を取得するサブスクリプションID を記載します</span><br><span class="line">$SubscriptionID = &#x27;Subscription ID&#x27;</span><br><span class="line">Set-AzureRmContext -SubscriptionId $SubscriptionID | Write-Verbose</span><br><span class="line"></span><br><span class="line">$UsageInfo = Get-UsageAggregates -ReportedStartTime $StartTime -ReportedEndTime $EndTime -AggregationGranularity Daily -ShowDetails $true</span><br><span class="line"></span><br><span class="line"> Do &#123; </span><br><span class="line">    $UsageInfo.UsageAggregations.Properties | Where-Object &#123;($_.MeterCategory -eq &#x27;Automation&#x27;) -and ($_.MeterName -eq &#x27;Basic Runtime&#x27;)&#125; | `</span><br><span class="line">            Select-Object `</span><br><span class="line">            UsageStartTime, `</span><br><span class="line">            UsageEndTime, `</span><br><span class="line">            @&#123;n=&#x27;SubscriptionId&#x27;;e=&#123;$SubscriptionId&#125;&#125;, `</span><br><span class="line">            MeterCategory, `</span><br><span class="line">            MeterId, `</span><br><span class="line">            MeterName, `</span><br><span class="line">            MeterSubCategory, `</span><br><span class="line">            MeterRegion, `</span><br><span class="line">            Unit, `</span><br><span class="line">            Quantity, `</span><br><span class="line">            @&#123;n=&#x27;Project&#x27;;e=&#123;$_.InfoFields.Project&#125;&#125;, `</span><br><span class="line">            InstanceData `</span><br><span class="line">            | Export-Csv -Append:$true -NoTypeInformation:$true -Path $CSVFile</span><br><span class="line">    if ($UsageInfo.NextLink) </span><br><span class="line">    &#123;</span><br><span class="line">        $ContinuationToken = [System.Web.HttpUtility]::UrlDecode($UsageInfo.NextLink.Split(&quot;=&quot;)[-1])</span><br><span class="line">        $UsageInfo = Get-UsageAggregates -ReportedStartTime $StartTime -ReportedEndTime $EndTime `</span><br><span class="line">                            -AggregationGranularity Daily -ShowDetails $true -ContinuationToken $ContinuationToken</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">       $ContinuationToken = &quot;&quot; </span><br><span class="line">   &#125;</span><br><span class="line"> &#125; Until (!$ContinuationToken)  </span><br></pre></td></tr></table></figure><p>なお実行時に下図のエラーが発生する場合は System.Web アセンブリがよみこまれていない可能性が高いため、以下のコマンドをローカルの環境にてご実施いただければと存じます。</p><p><img src="/blog/automation/gettingExeTimeOfJobForSpecificPeriodAutomation/ErrorMessage.jpg" alt="エラー画面" title="エラー画面"></p><p><strong>実行していただきたいコマンド</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Add-Type -AssemblyName System.Web</span><br></pre></td></tr></table></figure><p>結果として下図のように日時別のジョブの実行時間が CSV で取得できます。</p><p><img src="/blog/automation/gettingExeTimeOfJobForSpecificPeriodAutomation/CsvCreation.png"></p><p>”Quantity” 欄にて分単位でジョブの実行時間が表示されるのが確認できます。<br>この結果では 9 月で約67分のジョブ実行時間なので無償の範囲内ですね。<br>月別に出力して、管理することで、変遷を確認するなど運用にお役に立てていただければ幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは Azure サポート チームの村田です。&lt;br&gt;Azure Automation においては昨年価格体系が変更されました&lt;/p&gt;
&lt;p&gt;具体的には以下のように以前の Free、Basic という概念がなくなり、以下のように統合された価格体系となっております。&lt;/</summary>
      
    
    
    
    
    <category term="Automation" scheme="https://jpazmon-integ.github.io/blog/tags/Automation/"/>
    
    <category term="Job" scheme="https://jpazmon-integ.github.io/blog/tags/Job/"/>
    
    <category term="Howto" scheme="https://jpazmon-integ.github.io/blog/tags/Howto/"/>
    
    <category term="Runbook" scheme="https://jpazmon-integ.github.io/blog/tags/Runbook/"/>
    
  </entry>
  
</feed>
