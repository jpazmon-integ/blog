<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Monitoring Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Monitoring に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazmon-integ.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazmon-integ.github.io/blog/"/>
  <updated>2022-07-01T00:33:54.106Z</updated>
  <id>https://jpazmon-integ.github.io/blog/</id>
  
  <author>
    <name>Japan Azure Monitoring Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Automation アカウントの実行アカウントを作成するスクリプトにてエラーが発生して失敗する</title>
    <link href="https://jpazmon-integ.github.io/blog/automation/Automation-Update-AutomationRunAsCredential/"/>
    <id>https://jpazmon-integ.github.io/blog/automation/Automation-Update-AutomationRunAsCredential/</id>
    <published>2022-07-01T00:33:58.862Z</published>
    <updated>2022-07-01T00:33:54.106Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitor サポートの三輪です。<br>今回は Automation アカウントに対して実行アカウントを作成するスクリプト “Create-RunAsAccount.ps1” にて、エラーが発生する問題についてご案内させていただきます。</p><ul><li>実行アカウントを作成する PowerShell スクリプト<br><a href="https://docs.microsoft.com/ja-JP/azure/automation/create-run-as-account#powershell-script-to-create-a-run-as-account">https://docs.microsoft.com/ja-JP/azure/automation/create-run-as-account#powershell-script-to-create-a-run-as-account</a></li></ul><p>実行アカウントを作成するためにスクリプト “Create-RunAsAccount.ps1” を実行すると、以下の様なエラーが発生して失敗する場合があります。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">PS C:\temp&gt; .\Create-RunAsAccount.ps1 -ResourceGroup #### `</span><br><span class="line">&gt;&gt; -AutomationAccountName #### `</span><br><span class="line">&gt;&gt; -SubscriptionId #### `</span><br><span class="line">&gt;&gt; -ApplicationDisplayName #### `</span><br><span class="line">&gt;&gt; -SelfSignedCertPlainPassword #### `</span><br><span class="line">&gt;&gt; -CreateClassicRunAsAccount $false</span><br><span class="line"></span><br><span class="line">Account              SubscriptionName            TenantId                        Environment</span><br><span class="line">-------              ----------------            --------                        -----------</span><br><span class="line">####@contoso.com     #######                     XXXX-XXXX-XXXX-XXXX-XXXX        AzureCloud</span><br><span class="line"></span><br><span class="line">New-AzADApplication_CreateExpanded: C:\Program Files\WindowsPowerShell\Modules\Az.Resources\5.4.0\MSGraph.Autorest\custom\New-AzADApplication.ps1:702</span><br><span class="line">Line |</span><br><span class="line"> 702 |      $app = Az.MSGraph.internal\New-AzADApplication @PSBoundParameters</span><br><span class="line">     |      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">     | Values of identifierUris property must use a verified domain of the organization or its subdomain:</span><br><span class="line">     | &#x27;http://XXXX-XXXX-XXXX-XXXX-XXXX&#x27;</span><br><span class="line"></span><br><span class="line">New-AzADAppCredential: C:\temp\Create-RunAsAccount.ps1:42</span><br><span class="line">Line |</span><br><span class="line">  42 |  … w-AzADAppCredential -ApplicationId $Application.ApplicationId -CertVa …</span><br><span class="line">     |                                       ~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">     | Cannot process argument transformation on parameter &#x27;ApplicationId&#x27;. Cannot convert null to type</span><br><span class="line">     | &quot;System.Guid&quot;.</span><br><span class="line"></span><br><span class="line">New-AzADServicePrincipal: C:\temp\Create-RunAsAccount.ps1:44</span><br><span class="line">Line |</span><br><span class="line">  44 |  …  = New-AzADServicePrincipal -ApplicationId $Application.ApplicationId</span><br><span class="line">     |                                               ~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">     | Cannot process argument transformation on parameter &#x27;ApplicationId&#x27;. Cannot convert null to type</span><br><span class="line">     | &quot;System.Guid&quot;.</span><br><span class="line"></span><br><span class="line">Get-AzADServicePrincipal: C:\temp\Create-RunAsAccount.ps1:45</span><br><span class="line">Line |</span><br><span class="line">  45 |  … cePrincipal = Get-AzADServicePrincipal -ObjectId $ServicePrincipal.Id</span><br><span class="line">     |                                                     ~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">     | Cannot bind argument to parameter &#x27;ObjectId&#x27; because it is an empty string.</span><br><span class="line">:</span><br><span class="line">:</span><br></pre></td></tr></table></figure><p>上記エラーの原因は、Create-RunAsAccount.ps1 にて利用している New-AzADApplication コマンドが 古い identifierUris 形式になっているためです。<br>2021 年 10 月 15 日より、Azure AD に登録されるシングルテナント アプリケーションの AppId URI (identifierUris) には、<br>デフォルトのスキーム (api://{appId}) または検証済みドメインのいずれかが要求されるようになりましたが、現在公開されている Create-RunAsAccount.ps1 にはまだその内容が反映されておりません。</p><p>※ Azure AD 側の変更につきまして、以下の公開情報をご参照ください。</p><ul><li>Values of identifierUris property must use a verified domain of the organization or its subdomain エラーの対処法<br><a href="https://jpazureid.github.io/blog/azure-active-directory/aad-changes-impacting-azurecli-azureps/">https://jpazureid.github.io/blog/azure-active-directory/aad-changes-impacting-azurecli-azureps/</a></li></ul><p>また、スクリプトでは New-AzADApplication にて AAD アプリを作成し、そのアプリのアプリケーション ID を $Application.ApplicationId にて取得しております。<br>これも誤った記述となっており、アプリケーション ID を取得するためには、$Application.AppId と記述する必要があります。<br>この記述の間違いにより、New-AzADAppCredential 等のコマンドにおいてエラーが発生している状況です。</p><p>これらの問題に対応するため、変更を行ったスクリプトを以下にご案内いたします。<br>お手数をおかけしますが、上記エラーが発生する場合は、以下のスクリプトに置き換えて実行いただければと存じます。</p><p><a href="./Create-RunAsAccount_new.zip">Create-RunAsAccount_new.zip</a></p><p>なお、現時点では Automation アカウントの認証では実行アカウントではなく、マネージド ID を推奨しております。<br>マネージド ID の利点としては、実行アカウントの様に証明書を更新する必要がないこと、実行アカウントよりセキュアな認証であることがあげられます。</p><p>マネージド ID については、以下の Blog にてご案内しております。こちらも是非ご覧下さい。</p><ul><li>実行アカウントとマネージド ID の違いについて<br><a href="https://jpazmon-integ.github.io/blog/automation/DifferenceRunAsAccountAndManagedID/">https://jpazmon-integ.github.io/blog/automation/DifferenceRunAsAccountAndManagedID/</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitor サポートの三輪です。&lt;br&gt;今回は Automation アカウントに対して実行アカウントを作成するスクリプト “Create-RunAsAccount.ps1” にて、エラーが発生する問題についてご案内させていただきます。&lt;/p&gt;
</summary>
      
    
    
    
    
    <category term="Automation" scheme="https://jpazmon-integ.github.io/blog/tags/Automation/"/>
    
    <category term="RunAs Account" scheme="https://jpazmon-integ.github.io/blog/tags/RunAs-Account/"/>
    
  </entry>
  
  <entry>
    <title>実行アカウントとマネージド ID の違いについて</title>
    <link href="https://jpazmon-integ.github.io/blog/automation/DifferenceRunAsAccountAndManagedID/"/>
    <id>https://jpazmon-integ.github.io/blog/automation/DifferenceRunAsAccountAndManagedID/</id>
    <published>2022-06-09T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.106Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring サポート チームの六浦です。<br>今回は Automation アカウントの実行アカウントとマネージド ID の違いについてご紹介いたします。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E7%9B%AE%E6%AC%A1">目次</a></li><li><a href="#%E5%AE%9F%E8%A1%8C%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">実行アカウントについて</a><ul><li><a href="#%E5%8F%82%E8%80%83%E6%83%85%E5%A0%B1">参考情報</a></li></ul></li><li><a href="#%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%89-id-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">マネージド ID について</a><ul><li><a href="#%E5%8F%82%E8%80%83%E6%83%85%E5%A0%B1-1">参考情報</a></li></ul></li><li><a href="#%E5%AE%9F%E8%A1%8C%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%A8%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%89-id-%E3%81%AE%E5%85%B1%E9%80%9A%E7%82%B9">実行アカウントとマネージド ID の共通点</a></li><li><a href="#%E5%AE%9F%E8%A1%8C%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%A8%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%89-id-%E3%81%AE%E7%9B%B8%E9%81%95%E7%82%B9">実行アカウントとマネージド ID の相違点</a></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="実行アカウントについて"><a href="#実行アカウントについて" class="headerlink" title="実行アカウントについて"></a>実行アカウントについて</h2><p>実行アカウントは、Automation アカウントに利用される Azure AD のサービス プリンシパルです。<br>通常、以下のコマンドで実行アカウントを使って Azure へ認証するように Runbook を構成できます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#Get the connection &quot;AzureRunAsConnection&quot;</span><br><span class="line">$Conn=Get-AutomationConnection -Name $connectionName         </span><br><span class="line"></span><br><span class="line">&quot;Logging in to Azure...&quot;</span><br><span class="line">Connect-AzAccount -ServicePrincipal -Tenant $Conn.TenantID -ApplicationId $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint</span><br></pre></td></tr></table></figure><h3 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h3><p><a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-security-overview#run-as-account">Azure Automation アカウントの認証の概要 - 実行アカウント| Microsoft Docs</a><br><a href="https://docs.microsoft.com/ja-jp/azure/automation/manage-runas-account">Azure Automation の実行アカウントを管理する | Microsoft Docs</a></p><h2 id="マネージド-ID-について"><a href="#マネージド-ID-について" class="headerlink" title="マネージド ID について"></a>マネージド ID について</h2><p>マネージド ID は、Azure Active Directory (Azure AD) 認証をサポートするリソースに接続するときに使用する ID をアプリケーションに提供します。<br>アプリケーションは、マネージド ID を使用して Azure AD トークンを取得できます。<br>マネージド ID にはシステム割り当てマネージド ID とユーザー割り当てマネージド ID があります。</p><p>以下のコマンドでシステム割り当てマネージド ID を使って Azure へ認証するように Runbook を構成します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Disable-AzContextAutosave -Scope Process</span><br><span class="line"></span><br><span class="line"># Connect to Azure with system-assigned managed identity</span><br><span class="line">$AzureContext = (Connect-AzAccount -Identity).context</span><br><span class="line"></span><br><span class="line"># set and store context</span><br><span class="line">$AzureContext = Set-AzContext -SubscriptionName $AzureContext.Subscription -DefaultProfile $AzureContext</span><br></pre></td></tr></table></figure><p>また、ユーザー割り当てマネージド ID では、以下のコマンドとなります。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Ensures you do not inherit an AzContext in your runbook</span><br><span class="line">Disable-AzContextAutosave -Scope Process</span><br><span class="line"></span><br><span class="line"># Connect to Azure with user-assigned managed identity</span><br><span class="line">$AzureContext = (Connect-AzAccount -Identity -AccountId &lt;user-assigned-identity-ClientId&gt;).context</span><br><span class="line"></span><br><span class="line"># set and store context</span><br><span class="line">$AzureContext = Set-AzContext -SubscriptionName $AzureContext.Subscription -DefaultProfile $AzureContext</span><br></pre></td></tr></table></figure><p>マネージド ID は、Runbook で認証を行うための推奨される方法であり、現時点で Automation アカウントの既定の認証方法です。</p><h3 id="参考情報-1"><a href="#参考情報-1" class="headerlink" title="参考情報"></a>参考情報</h3><p><a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-security-overview#managed-identities">Azure Automation アカウントの認証の概要 -マネージド ID | Microsoft Docs</a><br><a href="https://docs.microsoft.com/ja-jp/azure/automation/enable-managed-identity-for-automation">Azure Automation アカウントのシステム割り当てマネージド ID を使用する</a><br><a href="https://docs.microsoft.com/ja-jp/azure/automation/add-user-assigned-identity">Azure Automation アカウントのユーザー割り当てマネージド ID を使用する</a></p><h2 id="実行アカウントとマネージド-ID-の共通点"><a href="#実行アカウントとマネージド-ID-の共通点" class="headerlink" title="実行アカウントとマネージド ID の共通点"></a>実行アカウントとマネージド ID の共通点</h2><ul><li>Azure へ認証する役割を果たします。</li><li>Runbook に上述の認証用コマンドを記載する必要があります。</li><li>Azure Active Directory にアプリケーションとして登録されています。</li></ul><h2 id="実行アカウントとマネージド-ID-の相違点"><a href="#実行アカウントとマネージド-ID-の相違点" class="headerlink" title="実行アカウントとマネージド ID の相違点"></a>実行アカウントとマネージド ID の相違点</h2><p>実行アカウントの実体はサービス プリンシパルでございます。<br>そのため、サービス プリンシパルとマネージド ID の違いから、実行アカウントとマネージド ID の相違点をより深く理解できます。</p><p>サービス プリンシパルとマネージド ID の大きな違いは、マネージド ID は「割り当てられたリソースからしか使用できない」という点でございます。<br>サービス プリンシパルは、クライアント シークレットや証明書などを任意のクライアントに格納して使用できますが、マネージド ID は割り当てられたリソースからしか使用できません。つまり、マネージド ID はクライアント シークレットや証明書の流出による不正アクセスのリスクがございません。</p><p>この 2 つは以下のように使い分けいただけます。</p><ul><li>任意のクライアント (Azure 上に存在しないものを含む) で使用したい場合はサービス プリンシパルを使用</li><li>Azure 上に存在する特定のリソースでのみ使用したい場合はマネージド IDを使用</li></ul><p>Azure 上に存在する Automation アカウントでは、マネージド ID のご使用を推奨しております。</p><p>最後に、実行アカウントとマネージド ID の相違点をまとめると以下になります。これらの相違点より、マネージド ID が推奨される認証方法です。</p><ul><li>実行アカウントは、証明書を更新する必要があります。</li><li>マネージド ID は、証明書を更新する必要がないです。</li><li>特定のリソース (Autoamtion アカウント) からアクセスできるという観点から、実行アカウントより、マネージド ID がセキュアです。</li></ul><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事では、実行アカウントとマネージド ID の共通点と相違点ついてご案内いたしましたが、ご理解いただけましたでしょうか。</p><p>本記事が少しでもお役に立ちましたら幸いです。<br>最後までお読みいただきありがとうございました！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring サポート チームの六浦です。&lt;br&gt;今回は Automation アカウントの実行アカウントとマネージド ID の違いについてご紹介いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Automation" scheme="https://jpazmon-integ.github.io/blog/tags/Automation/"/>
    
    <category term="RunAs Account" scheme="https://jpazmon-integ.github.io/blog/tags/RunAs-Account/"/>
    
    <category term="マネージド ID" scheme="https://jpazmon-integ.github.io/blog/tags/%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%89-ID/"/>
    
  </entry>
  
  <entry>
    <title>アクティビティ ログの分析情報（プレビュー）</title>
    <link href="https://jpazmon-integ.github.io/blog/LogAnalytics/ActivityLogsInsights/"/>
    <id>https://jpazmon-integ.github.io/blog/LogAnalytics/ActivityLogsInsights/</id>
    <published>2022-05-22T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.014Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring チームの 北村 です。</p><p>本記事は、2022 年 4 月 24 日に Azure Monitor Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-observability-blog/activity-logs-insights-preview/ba-p/3291892">Activity Logs Insights (Preview)</a> を翻訳したものになります。<br>プレビューとして提供されているアクティビティ ログの分析情報に関する記事をお届けいたします。</p><p>==========================================================================================</p><span id="more"></span><p>この記事では、アクティビティ ログの分析情報の概要、またその有効化および設定手順をご説明いたします。</p><ul><li><a href="#%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%93%E3%83%86%E3%82%A3-%E3%83%AD%E3%82%B0%E3%81%AE%E5%88%86%E6%9E%90%E6%83%85%E5%A0%B1%E3%81%AE%E6%A6%82%E8%A6%81">アクティビティ ログの分析情報の概要</a></li><li><a href="#%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%93%E3%83%86%E3%82%A3-%E3%83%AD%E3%82%B0%E3%81%AE%E5%88%86%E6%9E%90%E6%83%85%E5%A0%B1%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E8%A8%AD%E5%AE%9A%E6%89%8B%E9%A0%86">アクティビティ ログの分析情報に必要な設定手順</a></li><li><a href="#%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%93%E3%83%86%E3%82%A3-%E3%83%AD%E3%82%B0%E3%81%AE%E5%88%86%E6%9E%90%E6%83%85%E5%A0%B1%E3%81%AE%E9%96%B2%E8%A6%A7%E6%96%B9%E6%B3%95">アクティビティ ログの分析情報の閲覧方法</a></li></ul><h2 id="アクティビティ-ログの分析情報の概要"><a href="#アクティビティ-ログの分析情報の概要" class="headerlink" title="アクティビティ ログの分析情報の概要"></a>アクティビティ ログの分析情報の概要</h2><p>“アクティビティ ログの分析情報” は、Azure Monitor の Workbook 機能を利用したアクティビティ ログの分析機能です。<br>診断設定により Log Analytics ワークスペースに収集されたアクティビティ ログをもとに、<br>アクティビティ ログをカテゴリごとに表示したグラフや、リソース プロバイダーごとに表示したグラフなどが表示されます。<br>そのため、ユーザー様がクエリを構成することや、アクティビティ ログの一覧から必要な情報を苦労して抽出することなく、<br>アクティビティ ログを視覚的かつ容易に分析することが可能です。</p><p><strong>注意</strong> 現在、”アクティビティ ログの分析情報” の機能はプレビューとして提供しています。<br>そのため現時点では一部の基本的な機能が実装されており、今後さらに新たな分析項目を追加する予定です。</p><h2 id="アクティビティ-ログの分析情報に必要な設定手順"><a href="#アクティビティ-ログの分析情報に必要な設定手順" class="headerlink" title="アクティビティ ログの分析情報に必要な設定手順"></a>アクティビティ ログの分析情報に必要な設定手順</h2><p>アクティビティ ログの分析情報を有効化するには、アクティビティ ログを Log Analytics ワークスペースに<br>エクスポートするように設定するだけです。<br>– Log Analytics ワークスペースに送信する<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/essentials/activity-log#send-to-log-analytics-workspace">https://docs.microsoft.com/ja-jp/azure/azure-monitor/essentials/activity-log#send-to-log-analytics-workspace</a></p><h2 id="アクティビティ-ログの分析情報の閲覧方法"><a href="#アクティビティ-ログの分析情報の閲覧方法" class="headerlink" title="アクティビティ ログの分析情報の閲覧方法"></a>アクティビティ ログの分析情報の閲覧方法</h2><p>アクティビティ ログの分析を行うスコープ (リソース、リソース グループ、サブスクリプション) によって表示手順が異なります。<br>それぞれ手順を説明します。</p><ul><li>リソース グループまたはサブスクリプション レベル</li><li>リソース レベル</li></ul><p><strong>リソース グループまたはサブスクリプション レベル</strong><br>リソース グループまたはサブスクリプション レベルでアクティビティ ログの分析情報を表示するための手順は以下のとおりです。</p><ol><li><p>Azure ポータル で [<strong>モニター</strong>] - [<strong>ブック</strong>] を選択します。</p></li><li><p><strong>分析情報</strong> セクションで <strong>アクティビティ ログの分析情報</strong> を選択します。<br><img src="/blog/LogAnalytics/ActivityLogsInsights/image01.png"></p></li><li><p>アクティビティ ログの分析情報ページの上部で以下のとおり選択します。</p><ol><li><strong>サブスクリプション</strong> メニューで 1 つもしくは複数のサブスクリプションを選択します。</li><li><strong>ResourceGroup</strong> メニューでリソース グループを選択します。</li><li><strong>TimeRange</strong> メニューでデータを表示する時間の範囲を選択します。<br>以下のとおり選択したリソース グループに関するアクティビティ ログの状態や、アクティビティ ログのカテゴリを確認できます。<br><img src="/blog/LogAnalytics/ActivityLogsInsights/image02.png"></li></ol></li></ol><p><strong>リソース レベル</strong><br>リソース レベルでアクティビティ ログの分析情報を表示するための手順は以下のとおりです。</p><ol><li><p>まず、アクティビティ ログの分析情報を確認したいリソースを選択します。<br>下図は、Azure portal から仮想マシンを選択し、 [ブック] を選択した例です。</p></li><li><p><strong>アクティビティ ログの分析情報</strong> を選択します。<br><img src="/blog/LogAnalytics/ActivityLogsInsights/image03.png"></p></li><li><p>アクティビティ ログの分析情報ページの上部で以下のとおり選択します。</p><ol><li>TimeRange メニューでデータを表示する時間の範囲を選択します。<br>以下のとおりアクティビティ ログの状態や、リソース プロバイダーごとのアクティビティ ログを視覚的に確認することができます。<br><img src="/blog/LogAnalytics/ActivityLogsInsights/image04.png"></li></ol></li></ol><p>アクティビティログ の分析情報の詳細につきましては、以下記事をご覧ください。<br>– アクティビティ ログの分析情報<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/essentials/activity-log#activity-log-insights">https://docs.microsoft.com/ja-jp/azure/azure-monitor/essentials/activity-log#activity-log-insights</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring チームの 北村 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 4 月 24 日に Azure Monitor Blog で公開された &lt;a href=&quot;https://techcommunity.microsoft.com/t5/azure-observability-blog/activity-logs-insights-preview/ba-p/3291892&quot;&gt;Activity Logs Insights (Preview)&lt;/a&gt; を翻訳したものになります。&lt;br&gt;プレビューとして提供されているアクティビティ ログの分析情報に関する記事をお届けいたします。&lt;/p&gt;
&lt;p&gt;==========================================================================================&lt;/p&gt;</summary>
    
    
    
    
    <category term="Log Analytics" scheme="https://jpazmon-integ.github.io/blog/tags/Log-Analytics/"/>
    
  </entry>
  
  <entry>
    <title>死活監視のクエリについて</title>
    <link href="https://jpazmon-integ.github.io/blog/LogAnalytics/MonitorVM/"/>
    <id>https://jpazmon-integ.github.io/blog/LogAnalytics/MonitorVM/</id>
    <published>2022-05-22T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.086Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！ Azure Monitoring サポート チームの北村です。<br>今回は死活監視のクエリをご案内します。死活監視クエリは監視要件に応じて設定されているかと思いますが、<br>今回はお問い合わせの多い死活監視クエリを 3 つご紹介いたします。</p><p>==========================================================================================</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li>Heartbeat を使用した死活監視を行うために</li><li>Heartbeat を使用した死活監視</li><li>Heartbeat の収集が遅延していることを確認する</li><li>まとめ</li></ul><h2 id="Heartbeat-を使用した死活監視を行うために"><a href="#Heartbeat-を使用した死活監視を行うために" class="headerlink" title="Heartbeat を使用した死活監視を行うために"></a>Heartbeat を使用した死活監視を行うために</h2><p>死活監視のクエリをご紹介する前に、Azure VM における死活監視設定の基本的な流れを簡単にご説明します。<br>※ Log Analytics エージェントは 2024 年 8 月 31 日に廃止が予定されておりますのでご留意ください。</p><ol><li>Log Analytics ワークスペースの作成</li><li>Log Analytics エージェントの接続</li><li>アラート設定</li></ol><p><strong>1. Log Analytics ワークスペースの作成</strong><br>Azure portal にログインし、以下のように Log Analytics ワークスペースを作成します。<br><img src="/blog/LogAnalytics/MonitorVM/image01.png"><br><img src="/blog/LogAnalytics/MonitorVM/image02.png"></p><p>– Azure ポータルで Log Analytics ワークスペースを作成する<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/learn/quick-create-workspace">https://docs.microsoft.com/ja-jp/azure/azure-monitor/learn/quick-create-workspace</a></p><p><strong>2. Log Analytics エージェントの接続</strong><br>作成した Log Analytics ワークスペースのリソース メニューにある [仮想マシン] をクリックし、監視対象の VM を選択します。<br><img src="/blog/LogAnalytics/MonitorVM/image03.png"></p><p>画面上部の [接続] をクリックし、VM にエージェントをインストールします。<br><img src="/blog/LogAnalytics/MonitorVM/image04.png"></p><p>– Log Analytics エージェントの概要 - インストール オプション<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/agents/log-analytics-agent#installation-options">https://docs.microsoft.com/ja-jp/azure/azure-monitor/agents/log-analytics-agent#installation-options</a></p><p><strong>3. アラート設定</strong><br>作成した Log Analytics ワークスペース の [全般] - [ログ] をクリックします。<br>[ログ] 検索フィールドでクエリを実行し、アラートの設定を行います。アラートの評価期間や設定したクエリを実行する頻度、<br>アラートの通知方法等を設定します。詳細は下記弊社公開情報をご覧ください。<br><img src="/blog/LogAnalytics/MonitorVM/image05.png"></p><p>&lt;ご参考&gt;<br>– Azure Monitor を使用してログ アラートを作成、表示、管理する<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-log">https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-log</a><br>– Azure Portal でのアクション グループの作成および管理<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/action-groups">https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/action-groups</a><br><br></p><h2 id="Heartbeat-を使用した死活監視"><a href="#Heartbeat-を使用した死活監視" class="headerlink" title="Heartbeat を使用した死活監視"></a>Heartbeat を使用した死活監視</h2><p>Heartbeat は Log Analytics エージェントや Azure Monitor エージェントによって Log Analytics ワークスペースに<br>既定で収集されます。Log Analytics ワークスペースで Heartbeat のレコードを確認すると、<br>1 分間に 1 回レコードが生成されていることがわかります。この Heartbeat を使用した死活監視の例をご紹介します。<br><img src="/blog/LogAnalytics/MonitorVM/image06.png"></p><p><strong>例 1. 直近 5 分以内に Heartbeat が収集されていることを確認する</strong><br>下記クエリでは、過去 5 分間における 指定した VM の Heartbeat を返します。<br>下記クエリを実行して結果が返されなかった場合、アラートが実行された時点から 過去 5 分以内に Heartbeat が途絶えたことが<br>わかります。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Heartbeat</span><br><span class="line">| where Computer == &#x27;computer-name&#x27;</span><br><span class="line">| where TimeGenerated &gt; ago(5m)</span><br></pre></td></tr></table></figure><p>上記クエリを利用したアラート ルールの設定例を示します。まず、アラート ルールの主な設定項目をご説明します。</p><ul><li>集計の粒度 (赤枠線部分)<br>アラートの検索クエリが 1 回の評価を行う際に評価の対象とする期間です。<br>以下のように 5 分と設定した場合は 5 分間隔でグループ化され、検索クエリが実行されます。</li><li>演算子としきい値 (緑枠線部分)<br>上記クエリは、直近 5 分以内の Heartbeat を返しますので、当該クエリの実行結果が 0 件の場合は直近 5 分間 Heartbeat が<br>収集されていないことを意味します。そのため、演算子は 「等しい」、しきい値は 「0」 としています。</li><li>評価の頻度 (青枠線部分)<br>アラートの検索クエリが実行される間隔です。この例では、5 分ごとにクエリが実行されます。</li></ul><p><img src="/blog/LogAnalytics/MonitorVM/image07.jpg"></p><p>上記のとおり、アラートの [集計の粒度] を 5 分、 [評価の頻度] を 5 分としたアラート ルールを設定したとします (下表参照)。<br>[集計の粒度] は下表の「アラート実行」、[評価の頻度] は「評価期間」に依存します。<br>以下の例では、 00:00 ～ 00:10 の間は、アラートが実行されたタイミングにおいて、<br>最新の Heartbeat の時刻が 直近 5 分以内であるため、アラートは発報しません。<br>しかし、00:15 では、最新の Heartbeat の時刻 00:08 となっており、当該アラートの検索クエリの実行結果が 0 件となるため、<br>アラートが発報します。</p><p><img src="/blog/LogAnalytics/MonitorVM/image08.png"></p><p>&lt;ご参考&gt;<br>アラートの設定項目は下記弊社公開情報にも記載しております。<br>– Azure Monitor でのログ アラート<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-unified-log">https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-unified-log</a><br><br></p><p><strong>例 2. 直近 15 分間に Heartbeat が途絶えた VM を確認する</strong><br>下記クエリでは、直近 15 分間、VM の Heartbeat が送信されなかった場合に検知します。<br>LastCall は 各コンピューターの Heartbeat が生成された最新の時刻です。<br>Heartbeat の最新時刻が 15 分より前の場合、実行結果が返されます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Heartbeat</span><br><span class="line">| summarize LastCall = max(TimeGenerated) by Computer </span><br><span class="line">| where LastCall &lt; ago(15m)</span><br></pre></td></tr></table></figure><br><p><strong>例 3. 過去 24 時間以内に Heartbeat が収集された VM における最新の Heartbeat を確認する</strong><br>過去 24 時間以内に Heartbeat が収集された VM における 最新の Heartbeat を返します。<br>クエリの 2 行目で、Log Analytics ワークスペース上の Heartbeat ログを過去 24 時間以内に収集されたレコードに絞り込み、<br>3 行目で送信元の Computer ごとに最新の Heartbeat の時刻を検索します。<br>つまり、下記クエリでは、”過去 24 時間以内における Computer ごとの 最新の Heartbeat の時刻” を検索することが可能です。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Heartbeat</span><br><span class="line">| where TimeGenerated &gt; ago(24h)</span><br><span class="line">| summarize LastCall = max(TimeGenerated) by Computer</span><br></pre></td></tr></table></figure><p>&lt;ご参考&gt;<br>Heartbeat を使用したサンプル クエリにつきましては、<br>下記弊社公開情報にも掲載しておりますのでご確認いただけると幸いです。<br>– Azure Monitor での Agent Health ソリューション - サンプル ログ<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/insights/solution-agenthealth#sample-log-searches">https://docs.microsoft.com/ja-jp/azure/azure-monitor/insights/solution-agenthealth#sample-log-searches</a><br><br></p><h2 id="Heartbeat-の収集が遅延していることを確認するとき"><a href="#Heartbeat-の収集が遅延していることを確認するとき" class="headerlink" title="Heartbeat の収集が遅延していることを確認するとき"></a>Heartbeat の収集が遅延していることを確認するとき</h2><p>死活監視のアラートを検知したにもかかわらず、監視対象の VM は正常に動作している…<br>このようなときは、Heartbeat の収集遅延が発生している可能性がございます。</p><p>– Azure Monitor でのログ データ インジェスト時間<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/logs/data-ingestion-time">https://docs.microsoft.com/ja-jp/azure/azure-monitor/logs/data-ingestion-time</a><br>※ ログ データを取り込むための一般的な待ち時間は 20 秒から 3 分です。ただしシステムの負荷状況によりさらに遅延が発生する<br>可能性がございます。</p><p>Heartbeat の収集遅延には、様々な理由が考えられますが、以下のクエリを実行していただきますと、<br>“Log Analytics エージェントがデータを生成してから Azure 側でデータを受信するまで” の間に遅延が発生していたことを<br>確認できます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Heartbeat </span><br><span class="line">| where Computer == &quot;Computer Name&quot;</span><br><span class="line">| extend E2EIngestionLatency = ingestion_time() - TimeGenerated</span><br><span class="line">| project Computer, TimeGenerated, _TimeReceived, ingestion_time(), E2EIngestionLatency</span><br><span class="line">| order by TimeGenerated desc</span><br></pre></td></tr></table></figure><p>※ TimeGenerated : データ ソースが生成された時刻<br>※ _TimeReceived : Azure Monitor のインジェスト エンドポイントによって受信される時刻<br>※ $ingestion_time : Log Analytics ワークスペースに保存され、クエリ検索が可能となる時刻<br>※ E2EIngestionLatency : ログが生成されてから Log Analytics ワークスペースにログが送信されるまでに要した時間</p><p>下記画像は上記クエリを実行した例です。赤線で囲んだ部分が<br>「ログが生成されてから Log Analytics ワークスペースにログが送信されるまでに要した時間」です。<br><img src="/blog/LogAnalytics/MonitorVM/image09.png"></p><p>&lt;ご参考&gt;<br>下記弊社公開情報にも参考クエリを掲載しておりますのでご覧ください。<br>– Azure Monitor でのログ データ インジェスト時間 - インジェスト時間のチェック<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/logs/data-ingestion-time#checking-ingestion-time">https://docs.microsoft.com/ja-jp/azure/azure-monitor/logs/data-ingestion-time#checking-ingestion-time</a></p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事では、以下についてご案内いたしましたが、ご理解いただけましたでしょうか。</p><ul><li>Heartbeat を使用した死活監視を行うために</li><li>Heartbeat を使用した死活監視</li><li>Heartbeat の収集が遅延していることを確認する</li></ul><p>本記事がご理解の助けとして、お役立ていただければ幸いです。以上、死活監視に関する基本事項についてお伝えしました。<br>最後までお読みいただきありがとうございました！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは！ Azure Monitoring サポート チームの北村です。&lt;br&gt;今回は死活監視のクエリをご案内します。死活監視クエリは監視要件に応じて設定されているかと思いますが、&lt;br&gt;今回はお問い合わせの多い死活監視クエリを 3 つご紹介いたします。&lt;/p&gt;
&lt;p&gt;==========================================================================================&lt;/p&gt;</summary>
    
    
    
    
    <category term="How-To" scheme="https://jpazmon-integ.github.io/blog/tags/How-To/"/>
    
    <category term="Tips" scheme="https://jpazmon-integ.github.io/blog/tags/Tips/"/>
    
    <category term="Log Analytics" scheme="https://jpazmon-integ.github.io/blog/tags/Log-Analytics/"/>
    
  </entry>
  
  <entry>
    <title>プライベート環境への可用性テスト</title>
    <link href="https://jpazmon-integ.github.io/blog/applicationInsights/aboutPrivateAvailabilityTest/"/>
    <id>https://jpazmon-integ.github.io/blog/applicationInsights/aboutPrivateAvailabilityTest/</id>
    <published>2022-05-17T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.102Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring サポート チームの六浦です。</p><p>今回は、以下のようなパブリックからのアクセスを許可していない環境に対して Application Insights の可用性テストを行う方法をご案内いたします。</p><ul><li>ファイアウォールを設定している</li><li>パブリック IP アドレスが設定されていない etc.</li></ul><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E7%9B%AE%E6%AC%A1">目次</a></li><li><a href="#%E3%83%91%E3%83%96%E3%83%AA%E3%83%83%E3%82%AF%E3%81%8B%E3%82%89%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E7%92%B0%E5%A2%83%E3%81%B8%E3%81%AE%E5%8F%AF%E7%94%A8%E6%80%A7%E3%83%86%E3%82%B9%E3%83%88">パブリックからのアクセスを許可していない環境への可用性テスト①</a></li><li><a href="#%E3%83%91%E3%83%96%E3%83%AA%E3%83%83%E3%82%AF%E3%81%8B%E3%82%89%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E7%92%B0%E5%A2%83%E3%81%B8%E3%81%AE%E5%8F%AF%E7%94%A8%E6%80%A7%E3%83%86%E3%82%B9%E3%83%88-1">パブリックからのアクセスを許可していない環境への可用性テスト②</a></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="パブリックからのアクセスを許可していない環境への可用性テスト①"><a href="#パブリックからのアクセスを許可していない環境への可用性テスト①" class="headerlink" title="パブリックからのアクセスを許可していない環境への可用性テスト①"></a>パブリックからのアクセスを許可していない環境への可用性テスト①</h2><p>パブリック DNS レコードが存在し、ファイアウォールなどを使用してパブリックからのアクセスを制限した環境に対しては、サービス タグまたはテストの送信元のサーバーの IP アドレスを許可してテストを行うことができます。</p><p>可用性テストの送信元のサーバーの IP アドレスはサービス タグ “ApplicationInsightsAvailability” にて定義しております。このサービス タグをネットワーク セキュリティ グループなどで受信の許可を設定して、可用性テストを実施できます。<br><img src="/blog/applicationInsights/aboutPrivateAvailabilityTest/1.png"></p><p>または、リクエストを送信するテストの場所ごとの IP アドレスに対して受信の許可を設定し、テストを行うことも可能でございます。<br>テストの場所ごとの IP アドレスは以下の弊社公開情報にて提供しております。<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/ip-addresses#addresses-grouped-by-location-azure-public-cloud">場所ごとにグループ化されたアドレス (Azure パブリック クラウド)</a></p><p>[参考情報]<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/availability-private-test">プライベート可用性テスト - Azure Monitor Application Insights - Azure Monitor | Microsoft Docs</a></p><h2 id="パブリックからのアクセスを許可していない環境への可用性テスト②"><a href="#パブリックからのアクセスを許可していない環境への可用性テスト②" class="headerlink" title="パブリックからのアクセスを許可していない環境への可用性テスト②"></a>パブリックからのアクセスを許可していない環境への可用性テスト②</h2><p>パブリック DNS レコードが存在せず仮想ネットワーク内からのみアクセスできる環境やサービス タグを許可できない環境に対しては、Azure Functions を使用して可用性テストを行います。</p><ol><li><p>Application Insights を有効化した Azure Functions を用意します。<br>Application Insights が有効になっているかは、Azure Functions の以下の画面からご確認いただけます。<br><img src="/blog/applicationInsights/aboutPrivateAvailabilityTest/2.png"></p><div class="alert is-info"><p class="alert-title">Note</p><p>仮想ネットワーク内で可用性テストを行う場合は、Azure Functions をテスト対象のサーバーと同じ仮想ネットワークに対して VNET 統合を設定する必要がございます。</p><p>Azure Functions で VNET 統合を利用するには、従量課金の代わりに Premium プランを使用します。</p><p>また、仮想ネットワークを使用して Azure Functions からストレージ アカウントへアクセスする場合は、以下の弊社公開情報を参考に、Azure Functions とストレージ アカウントを構成ください。</p><p><a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/configure-networking-how-to#restrict-your-storage-account-to-a-virtual-network">仮想ネットワークで Azure Functions を構成する方法</a></p></div></li><li><p>タイマー トリガー関数を作成します。<br>以下の弊社公開情報にて、可用性テストを行うためのソース コードの実装例を提供しております。<br> <a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/availability-azure-functions#add-and-edit-code-in-the-app-service-editor">App Service Editor でコードを追加して編集する</a></p><p> runAvailabilityTest.csx で、テスト先の URL を指定します。<br><img src="/blog/applicationInsights/aboutPrivateAvailabilityTest/3.png"></p></li><li><p>Application Insights の [可用性] を開き、可用性テストが動いていることを確認します。<br>Azure Functions で作成した可用性テストは、[CUSTOM] と表示されます。<br><img src="/blog/applicationInsights/aboutPrivateAvailabilityTest/4.png"></p></li></ol><p>[参考情報]<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/availability-azure-functions">Azure Functions を使用してカスタム可用性テストを作成して実行する - Azure Monitor | Microsoft Docs</a></p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事では、パブリックからのアクセスを許可していない環境への可用性テストの方法ついてご案内いたしましたが、ご理解いただけましたでしょうか。</p><p>本記事が少しでもお役に立ちましたら幸いです。<br>最後までお読みいただきありがとうございました！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring サポート チームの六浦です。&lt;/p&gt;
&lt;p&gt;今回は、以下のようなパブリックからのアクセスを許可していない環境に対して Application Insights の可用性テストを行う方法をご案内いたします。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ファイアウォールを設定している&lt;/li&gt;
&lt;li&gt;パブリック IP アドレスが設定されていない etc.&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="Tips" scheme="https://jpazmon-integ.github.io/blog/tags/Tips/"/>
    
    <category term="Application Insights" scheme="https://jpazmon-integ.github.io/blog/tags/Application-Insights/"/>
    
    <category term="可用性テスト" scheme="https://jpazmon-integ.github.io/blog/tags/%E5%8F%AF%E7%94%A8%E6%80%A7%E3%83%86%E3%82%B9%E3%83%88/"/>
    
  </entry>
  
  <entry>
    <title>Application Insights のログの料金について</title>
    <link href="https://jpazmon-integ.github.io/blog/applicationInsights/aboutCostOfAi/"/>
    <id>https://jpazmon-integ.github.io/blog/applicationInsights/aboutCostOfAi/</id>
    <published>2022-05-10T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.098Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring サポート チームの六浦です。</p><p>今回は Application Insights のログに関する料金についてご案内いたします。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E7%9B%AE%E6%AC%A1">目次</a></li><li><a href="#application-insights-%E3%81%AE%E3%83%AD%E3%82%B0%E3%81%AE%E6%96%99%E9%87%91">Application Insights のログの料金</a><ul><li><a href="#%E3%83%AD%E3%82%B0-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BF%9D%E6%8C%81%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E3%82%B3%E3%82%B9%E3%83%88">ログ データの保持に対するコスト</a></li><li><a href="#%E3%83%AD%E3%82%B0-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B8%E3%82%A7%E3%82%B9%E3%83%88%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E3%82%B3%E3%82%B9%E3%83%88">ログ データのインジェストに対するコスト</a></li></ul></li><li><a href="#%E7%8F%BE%E5%9C%A8%E3%81%AE%E6%96%99%E9%87%91%E3%82%92%E8%A6%8B%E7%A9%8D%E3%82%82%E3%82%8B%E6%96%B9%E6%B3%95">現在の料金を見積もる方法</a><ul><li><a href="#%E3%82%AF%E3%83%A9%E3%82%B7%E3%83%83%E3%82%AF%E7%89%88">クラシック版</a><ul><li><a href="#%E3%83%AD%E3%82%B0-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B8%E3%82%A7%E3%82%B9%E3%83%88%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E3%82%B3%E3%82%B9%E3%83%88-1">ログ データのインジェストに対するコスト</a></li><li><a href="#%E3%83%AD%E3%82%B0-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BF%9D%E6%8C%81%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E3%82%B3%E3%82%B9%E3%83%88-1">ログ データの保持に対するコスト</a></li></ul></li><li><a href="#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E7%89%88">ワークスペース版</a><ul><li><a href="#%E3%83%AD%E3%82%B0-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B8%E3%82%A7%E3%82%B9%E3%83%88%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E3%82%B3%E3%82%B9%E3%83%88-2">ログ データのインジェストに対するコスト</a></li><li><a href="#%E3%83%AD%E3%82%B0-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BF%9D%E6%8C%81%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E3%82%B3%E3%82%B9%E3%83%88-2">ログ データの保持に対するコスト</a></li></ul></li></ul></li><li><a href="#%E3%82%AF%E3%82%A8%E3%83%AA%E3%82%92%E7%94%A8%E3%81%84%E3%81%A6%E3%82%B3%E3%82%B9%E3%83%88%E3%82%92%E7%A2%BA%E8%AA%8D">クエリを用いてコストを確認</a></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="Application-Insights-のログの料金"><a href="#Application-Insights-のログの料金" class="headerlink" title="Application Insights のログの料金"></a>Application Insights のログの料金</h2><p>Application Insights のログに対して発生する料金は下記の 2 つがございます。</p><ol><li>ログ データの保持に対するコスト</li><li>ログ データのインジェストに対するコスト</li></ol><p>2 つの料金の課金方法の仕組みついてご案内いたします。</p><h3 id="ログ-データの保持に対するコスト"><a href="#ログ-データの保持に対するコスト" class="headerlink" title="ログ データの保持に対するコスト"></a>ログ データの保持に対するコスト</h3><p>Application Insights に取り込まれたデータは 90 日間無料で保持されます。<br>Application Insights のデータ保持期間を 90 日にご設定いただければ費用は発生いたしません。<br>つまり、保持期間が 90 日を超えなければ、ログ データの保持に対するコストは 0 円です。<br>※ Application Insights のデフォルト保持期間は 90 日間でございます。</p><p>たとえば、データを 365 日間保持する設定で、毎月 11 GB ずつデータを取り込んだ場合、<br>1 年分のデータがたまった状態になると、以下の図のようにおよそ 9 ヶ月分のデータに対して課金が発生いたします。<br><img src="/blog/applicationInsights/aboutCostOfAi/1.png"></p><h3 id="ログ-データのインジェストに対するコスト"><a href="#ログ-データのインジェストに対するコスト" class="headerlink" title="ログ データのインジェストに対するコスト"></a>ログ データのインジェストに対するコスト</h3><p>従量課金制の価格レベルをご使用の場合は、1 か月あたり課金アカウントごとに 5 GB まで無料でございます。<br>以下のように毎月 5 GB を超えたデータに、料金が発生いたします。<br><img src="/blog/applicationInsights/aboutCostOfAi/2.png"></p><p>Application Insights の課金について詳しくは、以下の弊社公開情報からご確認いただけます。<br><a href="https://azure.microsoft.com/ja-jp/pricing/details/monitor/">価格 - Azure Monitor | Microsoft Azure</a></p><h2 id="現在の料金を見積もる方法"><a href="#現在の料金を見積もる方法" class="headerlink" title="現在の料金を見積もる方法"></a>現在の料金を見積もる方法</h2><h3 id="クラシック版"><a href="#クラシック版" class="headerlink" title="クラシック版"></a>クラシック版</h3><p>Application Insights の [構成] &gt; [使用とコストの見積もり] から現在の料金の見積もりをご確認いただけます。</p><h4 id="ログ-データのインジェストに対するコスト-1"><a href="#ログ-データのインジェストに対するコスト-1" class="headerlink" title="ログ データのインジェストに対するコスト"></a>ログ データのインジェストに対するコスト</h4><p>データのインジェストは以下の表から確認できます。<br>ここで表示されるデータ インジェスト量は 5 GB の無料枠は考慮されておりませんので、ご注意くださいませ。<br><img src="/blog/applicationInsights/aboutCostOfAi/3.png"></p><h4 id="ログ-データの保持に対するコスト-1"><a href="#ログ-データの保持に対するコスト-1" class="headerlink" title="ログ データの保持に対するコスト"></a>ログ データの保持に対するコスト</h4><p>保有期間を確認して、Application Insights のログ データにコストが発生しているか確認できます。<br>データ保有期間は、[データ保有期間] を選択して、画面右側に表示されるメニューから確認いただけます。<br>保有期間が 90 日以内に設定されていれば、データの保持の料金は発生しません。<br><img src="/blog/applicationInsights/aboutCostOfAi/4.png"></p><h3 id="ワークスペース版"><a href="#ワークスペース版" class="headerlink" title="ワークスペース版"></a>ワークスペース版</h3><p>ワークスペース版の Application Insights は Log Analytics ワークスペースにログ データを保持しているため、Log Analytics ワークスペースにてデータ保有期間とデータのインジェストの料金を確認します。</p><h4 id="ログ-データのインジェストに対するコスト-2"><a href="#ログ-データのインジェストに対するコスト-2" class="headerlink" title="ログ データのインジェストに対するコスト"></a>ログ データのインジェストに対するコスト</h4><p>Application Insights が接続している Log Analytics ワークスペースから確認する必要がございます。<br>Application Insights が接続している Log Analytics ワークスペースは [概要] のワークスペースからご確認いただけます。<br><img src="/blog/applicationInsights/aboutCostOfAi/5.png"></p><p>Application Insights が接続している Log Analytics ワークスペースの [全般] &gt; [使用量と推定コスト] からログ データ インジェスト量を確認いただけます。<br>ここで表示されるデータ インジェスト量も 5 GB の無料枠は考慮されておりませんので、ご注意くださいませ。<br><img src="/blog/applicationInsights/aboutCostOfAi/6.png"></p><p>上記の画面で表示されているログ データ インジェスト量は、Log Analytics ワークスペース全体のインジェスト量でございます。<br>複数の Application Insights が 1 つの Log Analytics ワークスペースに接続している場合や、他のリソースのログを Log Analytics ワークスペースに収集している場合は、それらのログの合計のインジェスト量が表示されます。<br>リソースごとのインジェスト量を調べるには、Log Analytics ワークスペースで以下のクエリを実行してご確認いただけます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">union AppAvailabilityResults, AppBrowserTimings, AppDependencies, AppExceptions, AppEvents, AppMetrics, AppPageViews, AppPerformanceCounters, AppRequests, AppSystemEvents, AppTraces</span><br><span class="line">| where TimeGenerated &gt;= startofday(ago(30d)) and TimeGenerated &lt; startofday(now())</span><br><span class="line">| summarize sum(_BilledSize) by _ResourceId</span><br></pre></td></tr></table></figure><h4 id="ログ-データの保持に対するコスト-2"><a href="#ログ-データの保持に対するコスト-2" class="headerlink" title="ログ データの保持に対するコスト"></a>ログ データの保持に対するコスト</h4><p>Log Analytics ワークスペースのデータの保持期間は[全般] &gt; [使用量と推定コスト] の [データ保持期間] から確認いただけます。<br><img src="/blog/applicationInsights/aboutCostOfAi/7.png"><br>ただし、ここで表示されるデータの保持期間は、以下のデータ以外の保持期間を示します。<br>※ これらのデータの保持期間は既定では 90 日間に設定されております。</p><ul><li>Usage</li><li>AzureActivity</li><li>Application Insights のデータ</li></ul><p>そのため、Application Insightsのデータの保持期間は REST API を使用して確認する必要がございます。<br>以下の PowerShell スクリプトを実行すると、Log Analytics ワークスペースの Application Insights で使用されるテーブルのデータの保持期間を確認できます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$azContext = Get-AzContext</span><br><span class="line">$azProfile = [Microsoft.Azure.Commands.Common.Authentication.Abstractions.AzureRmProfileProvider]::Instance.Profile</span><br><span class="line">$profileClient = New-Object -TypeName Microsoft.Azure.Commands.ResourceManager.Common.RMProfileClient -ArgumentList ($azProfile)</span><br><span class="line">$token = $profileClient.AcquireAccessToken($azContext.Subscription.TenantId)</span><br><span class="line">$authHeader = @&#123;</span><br><span class="line">    &#x27;Content-Type&#x27;=&#x27;application/json&#x27;</span><br><span class="line">    &#x27;Authorization&#x27;=&#x27;Bearer &#x27; + $token.AccessToken</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$subscriptionId = &quot;&lt;サブスクリプション ID&gt;&quot;</span><br><span class="line">$workspaceRgName = &quot;&lt;リソース グループ名&gt;&quot;</span><br><span class="line">$workspaceName = &quot;&lt;Log Analytics ワークスペース名&gt;&quot;</span><br><span class="line"> </span><br><span class="line">$url = &quot;https://management.azure.com/subscriptions/$subscriptionId/resourceGroups/$workspaceRgName/providers/Microsoft.OperationalInsights/workspaces/$workspaceName/Tables?api-version=2021-12-01-preview&quot;</span><br><span class="line"></span><br><span class="line">$response = Invoke-RestMethod $url -Method GET -Headers $authHeader</span><br><span class="line">$response.value `</span><br><span class="line">| Where-Object &#123;$_.name -match &quot;AppAvailabilityResults|AppBrowserTimings|AppDependencies|AppExceptions|AppEvents|AppMetrics|AppPageViews|AppPerformanceCounters|AppRequests|AppSystemEvents|AppTraces&quot;&#125; `</span><br><span class="line">| Select-Object -Property name -ExpandProperty properties `</span><br><span class="line">| Select-Object -Property name, retentionInDays</span><br></pre></td></tr></table></figure><h2 id="クエリを用いてコストを確認"><a href="#クエリを用いてコストを確認" class="headerlink" title="クエリを用いてコストを確認"></a>クエリを用いてコストを確認</h2><p>課金の対象となるログ データのサイズは _BilledSize 列で定義されます。<br>そのため、_BilledSize 列を使用することで、現在取り込まれている課金の対象のログのサイズを確認することができます。</p><p>弊社公開情報にて、コストの確認に使用するクエリの例を紹介しております。<br>クラシック版の Application Insights の場合は、こちらの弊社公開情報をご参照ください。<br>クエリは Application Insights で実行します。<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/logs/analyze-usage#application-insights-data">Applicationインサイトデータ</a></p><p>ワークスペース版の Application Insights の場合は、こちらの弊社公開情報をご参照ください。<br>以下の弊社公開情報のクエリは Application Insights が接続している Log Analytics ワークスペースで実行します。<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/logs/analyze-usage#data-volume-trends-for-workspace-based-resources">ワークスペースベースのリソースのデータボリュームの傾向</a></p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事では、以下についてご案内いたしましたが、ご理解いただけましたでしょうか。</p><ul><li>Application Insights のログの料金</li><li>現在の料金を見積もる方法</li><li>クエリを用いてコストを確認</li></ul><p>本記事が少しでもお役に立ちましたら幸いです。<br>最後までお読みいただきありがとうございました！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring サポート チームの六浦です。&lt;/p&gt;
&lt;p&gt;今回は Application Insights のログに関する料金についてご案内いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Application Insights" scheme="https://jpazmon-integ.github.io/blog/tags/Application-Insights/"/>
    
    <category term="コスト" scheme="https://jpazmon-integ.github.io/blog/tags/%E3%82%B3%E3%82%B9%E3%83%88/"/>
    
  </entry>
  
  <entry>
    <title>Log Analytics ワークスペースの保有期間の変更</title>
    <link href="https://jpazmon-integ.github.io/blog/LogAnalytics/HowToChangeLAWSDataRetentionPeriod/"/>
    <id>https://jpazmon-integ.github.io/blog/LogAnalytics/HowToChangeLAWSDataRetentionPeriod/</id>
    <published>2022-04-03T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.022Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！ Azure Monitoring &amp; Integration サポート チームの北村です。</p><p>今回は Log Analytics ワークスペースのデータ保有期間の変更方法をご案内いたします。<br>Azure portal では ワークスペースの保有期間は、30、31、60、90、120、180、270、365、550、および 730 日 しか設定できません。そのため、前述した日数以外の値を設定する場合は、Azure PowerShell や Azure CLI で設定する必要があります。<br>今回は、Azure portal 以外での設定変更方法として、Azure PowerShell と Azure CLI コマンドの例をご紹介します。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li>Log Analytics ワークスペースの保有期間</li><li>Azure CLI コマンドを利用した設定</li><li>Azure PowerShell を利用した設定</li><li>まとめ</li></ul><h2 id="Log-Analytics-ワークスペースの保有期間"><a href="#Log-Analytics-ワークスペースの保有期間" class="headerlink" title="Log Analytics ワークスペースの保有期間"></a>Log Analytics ワークスペースの保有期間</h2><p>まず、Log Analytics ワークスペースの保有期間は、30 日から 730 日まで設定できます。<br>730 日間を超えてログ データを保持する場合は、Azure ストーレジ アカウントや Azure イベント ハブにエクスポートすることを<br>ご検討ください。</p><p>– Azure Monitor ログで使用量とコストを管理する - [データ保持期間の変更]<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/logs/manage-cost-storage#change-the-data-retention-period">https://docs.microsoft.com/ja-jp/azure/azure-monitor/logs/manage-cost-storage#change-the-data-retention-period</a></p><h2 id="Azure-CLI-コマンドを利用した設定"><a href="#Azure-CLI-コマンドを利用した設定" class="headerlink" title="Azure CLI コマンドを利用した設定"></a>Azure CLI コマンドを利用した設定</h2><p><code>az monitor log-analytics workspace update</code> コマンドは、Log Analytics ワークスペースの設定を更新するコマンドです。<br>Log Analytics ワークスペース名、ワークスペースが属するリソース グループ名、retention-time に 30 ～ 730 の範囲で<br>任意の保持期間日数を指定します。</p><p><code>az monitor log-analytics workspace update --resource-group &lt;リソースグループ名&gt; --workspace-name &lt;ワークスペース名&gt; --retention-time &lt;保有期間&gt;</code><br><img src="/blog/LogAnalytics/HowToChangeLAWSDataRetentionPeriod/image01.png"></p><p>上記コマンドで変更した内容は、Azure portal から確認することもできます。<br>Log Analytics ワークスペース - [使用量と推定コスト] - [データ保有期間] をご覧ください。<br><img src="/blog/LogAnalytics/HowToChangeLAWSDataRetentionPeriod/image02.png"></p><p>&lt;ご参考&gt;<br>– az monitor log-analytics workspace update<br><a href="https://docs.microsoft.com/ja-jp/cli/azure/monitor/log-analytics/workspace?view=azure-cli-latest#az-monitor-log-analytics-workspace-update">https://docs.microsoft.com/ja-jp/cli/azure/monitor/log-analytics/workspace?view=azure-cli-latest#az-monitor-log-analytics-workspace-update</a><br>– az monitor log-analytics workspace show<br><a href="https://docs.microsoft.com/ja-jp/cli/azure/monitor/log-analytics/workspace?view=azure-cli-latest#az-monitor-log-analytics-workspace-show">https://docs.microsoft.com/ja-jp/cli/azure/monitor/log-analytics/workspace?view=azure-cli-latest#az-monitor-log-analytics-workspace-show</a><br>※ 上記コマンドでは、Log Analytics ワークスペースの設定値を確認することができます。</p><h2 id="Azure-PowerShell-を使用した設定"><a href="#Azure-PowerShell-を使用した設定" class="headerlink" title="Azure PowerShell を使用した設定"></a>Azure PowerShell を使用した設定</h2><p>前述の Azure CLI コマンドと同様、Log Analytics ワークスペースの設定を更新するコマンドを使用します。<br>Log Analytics ワークスペース名、ワークスペースが属するリソース グループ名、RetentionInDays に 30 ～ 730 の範囲で<br>任意の保持期間日数を指定します。<br><code>Set-AzOperationalInsightsWorkspace -ResourceGroupName &quot;&lt;リソースグループ名&gt;&quot; -Name &quot;&lt;ワークスペース名&gt;&quot; -RetentionInDays &lt;保有期間&gt;</code><br><img src="/blog/LogAnalytics/HowToChangeLAWSDataRetentionPeriod/image03.png"></p><p>&lt;ご参考&gt;<br>下記弊社公開情報は、Az PowerShell 7.2.0 の情報でございます。お客様がご利用されているバージョンに沿った公開情報を<br>ご覧ください。<br>– Set-AzOperationalInsightsWorkspace<br><a href="https://docs.microsoft.com/en-us/powershell/module/az.operationalinsights/set-azoperationalinsightsworkspace?view=azps-7.2.0">https://docs.microsoft.com/en-us/powershell/module/az.operationalinsights/set-azoperationalinsightsworkspace?view=azps-7.2.0</a><br>– Get-AzOperationalInsightsWorkspace<br><a href="https://docs.microsoft.com/en-us/powershell/module/az.operationalinsights/get-azoperationalinsightsworkspace?view=azps-7.2.0">https://docs.microsoft.com/en-us/powershell/module/az.operationalinsights/get-azoperationalinsightsworkspace?view=azps-7.2.0</a><br>※ 上記コマンドでは、Log Analytics  ワークスペースの設定値を確認することができます。</p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事では、以下についてご案内いたしましたが、ご理解いただけましたでしょうか。</p><ul><li>Log Analytics ワークスペースの保有期間</li><li>Azure CLI コマンドを利用した設定</li><li>Azure PowerShellを利用した設定</li></ul><p>本記事が少しでもお役に立ちましたら幸いです。<br>以上、Log Analytics  ワークスペース の保有期間の変更方法についてお伝えしました。<br>最後までお読みいただきありがとうございました！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは！ Azure Monitoring &amp;amp; Integration サポート チームの北村です。&lt;/p&gt;
&lt;p&gt;今回は Log Analytics ワークスペースのデータ保有期間の変更方法をご案内いたします。&lt;br&gt;Azure portal では ワークスペースの保有期間は、30、31、60、90、120、180、270、365、550、および 730 日 しか設定できません。そのため、前述した日数以外の値を設定する場合は、Azure PowerShell や Azure CLI で設定する必要があります。&lt;br&gt;今回は、Azure portal 以外での設定変更方法として、Azure PowerShell と Azure CLI コマンドの例をご紹介します。&lt;/p&gt;</summary>
    
    
    
    
    <category term="How-To" scheme="https://jpazmon-integ.github.io/blog/tags/How-To/"/>
    
    <category term="Tips" scheme="https://jpazmon-integ.github.io/blog/tags/Tips/"/>
    
    <category term="Log Analytics" scheme="https://jpazmon-integ.github.io/blog/tags/Log-Analytics/"/>
    
  </entry>
  
  <entry>
    <title>Windows セキュリティ イベントログの収集</title>
    <link href="https://jpazmon-integ.github.io/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/"/>
    <id>https://jpazmon-integ.github.io/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/</id>
    <published>2022-04-03T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.042Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！ Azure Monitoring &amp; Integration サポート チームの北村です。</p><p>今回は Log Analytics ワークスペースにセキュリティ イベント ログを収集する方法をご案内いたします。<br>ご利用されているエージェントによってログ収集方法が異なりますので、エージェントごとに設定方法をご紹介いたします。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li>Log Analytics エージェントと Azure Monitor エージェントにおける収集方法の違い</li><li>Log Analytics エージェントによるセキュリティ イベント ログ収集の設定</li><li>Azure Monitor エージェントによるセキュリティ イベント ログ収集の設定</li><li>まとめ</li></ul><h2 id="Log-Analytics-エージェントと-Azure-Monitor-エージェントにおける収集方法の違い"><a href="#Log-Analytics-エージェントと-Azure-Monitor-エージェントにおける収集方法の違い" class="headerlink" title="Log Analytics エージェントと Azure Monitor エージェントにおける収集方法の違い"></a>Log Analytics エージェントと Azure Monitor エージェントにおける収集方法の違い</h2><p>Azure Monitor でセキュリティ イベント ログを収集する場合、<br>Azure Monitor エージェント または Log Analytics エージェントを使用します。<br>冒頭でも申し上げたとおり、エージェントによって収集方法が異なります (下表参照)。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/image01.png"></p><h3 id="Log-Analytics-エージェントによるログ収集"><a href="#Log-Analytics-エージェントによるログ収集" class="headerlink" title="Log Analytics エージェントによるログ収集"></a>Log Analytics エージェントによるログ収集</h3><p>Log Analytics エージェントは、他の Windows イベント ログとは異なり、<br>Log Analytics ワークスペースの [エージェント構成] からセキュリティ イベント ログの収集を設定することができません。<br>Microsoft Defender for Cloud または Microsoft Sentinel を使用する必要があり、ログは SecurityEvent テーブルに送信されます。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/image02.png"></p><p>&lt;参考&gt;<br>– Log Analytics エージェントを使用して Windows イベント ログのデータ ソースを収集する - [Windows イベント ログの構成] を<br>ご参照ください。<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/agents/data-sources-windows-events#configuring-windows-event-logs">https://docs.microsoft.com/ja-jp/azure/azure-monitor/agents/data-sources-windows-events#configuring-windows-event-logs</a><br>– Microsoft Sentinel に送信できるセキュリティ イベント ログは下記弊社公開情報をご覧ください。<br><a href="https://docs.microsoft.com/ja-jp/azure/sentinel/windows-security-event-id-reference">https://docs.microsoft.com/ja-jp/azure/sentinel/windows-security-event-id-reference</a></p><h3 id="Azure-Monitor-エージェントによるログ収集"><a href="#Azure-Monitor-エージェントによるログ収集" class="headerlink" title="Azure Monitor エージェントによるログ収集"></a>Azure Monitor エージェントによるログ収集</h3><p>Azure Monitor エージェントでは、他の Windows イベント ログと同様に、<br>データ収集ルール (DCR) でセキュリティ イベント ログを収集することができます。ログは、Event テーブルに送信されます。<br>また、Microsoft Sentinel を使用して Azure Monitor エージェント経由でログを収集することもできますが、<br>その場合は SecurityEvent テーブルに送信されます (Log Analytics エージェントを使用する場合と同様です)。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/image03.png"></p><p>&lt;参考&gt;<br>– 新しい Azure Monitor エージェントを使用して Windows セキュリティ イベントを収集する方法はありますか?<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/faq#----azure-monitor-------------windows--------------------------">https://docs.microsoft.com/ja-jp/azure/azure-monitor/faq#----azure-monitor-------------windows--------------------------</a></p><h2 id="Log-Analytics-エージェントによるセキュリティ-イベント-ログ収集の設定"><a href="#Log-Analytics-エージェントによるセキュリティ-イベント-ログ収集の設定" class="headerlink" title="Log Analytics エージェントによるセキュリティ イベント ログ収集の設定"></a>Log Analytics エージェントによるセキュリティ イベント ログ収集の設定</h2><p>ここでは、Microsoft Sentinel を使用した Log Analytics エージェントによる セキュリティ イベント ログの収集手順をご紹介します。<br>下記手順は Azure VM を使用することを前提としております。</p><ol><li><p>Azure portal から Microsoft Sentinel を選択します。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/LA/step01.png"></p></li><li><p>Microsoft Sentinel の画面上部の [+ 作成] をクリックします。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/LA/step02.png"></p></li><li><p>新しい Log Analytics ワークスペースを作成する場合は、<br>画面上部の [+ 新しいワークスペースの作成] をクリックしてください。本手順では既に作成済みのワークスペースを選択します。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/LA/step03.png"></p></li><li><p>リソース メニュー の [データ コネクタ] から [レガシ エージェントを使用したセキュリティ イベント] のコネクタを選択し、<br>画面左下部の [コネクタ ページを開く] をクリックします。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/LA/step04.png"></p></li><li><p>Log Analytics エージェントをダウンロードします。<br>[Azure Windows 仮想マシンのエージェントをダウンロードしてインストールする] をクリックします。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/LA/step05.png"></p></li><li><p>セキュリティ イベント ログを収集する仮想マシンを選択し、Log Analytics ワークスペースに接続します。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/LA/step06.png"></p></li><li><p>収集するイベントを選択し、[変更の適用] を選択します。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/LA/step07.png"></p></li><li><p>Microsoft Sentinel のリソース メニューの [ログ] から SecurityEvent テーブルにログが収集されていることが分かります。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/LA/step08.png"></p></li></ol><p>&lt;参考&gt;<br>– 使用した Microsoft Sentinel のコネクタは [レガシ エージェントを使用したセキュリティ イベント (Windows)] です。<br><a href="https://docs.microsoft.com/ja-jp/azure/sentinel/data-connectors-reference#security-events-via-legacy-agent-windows">https://docs.microsoft.com/ja-jp/azure/sentinel/data-connectors-reference#security-events-via-legacy-agent-windows</a><br>– 上記手順は、下記弊社公開情報にも掲載しております。<br><a href="https://docs.microsoft.com/ja-jp/azure/sentinel/connect-azure-windows-microsoft-services?tabs=SA,LAA#windows-agent-based-connections">https://docs.microsoft.com/ja-jp/azure/sentinel/connect-azure-windows-microsoft-services?tabs=SA%2CLAA#windows-agent-based-connections</a></p><h3 id="Azure-Monitor-エージェントによるセキュリティ-イベント-ログ収集の設定"><a href="#Azure-Monitor-エージェントによるセキュリティ-イベント-ログ収集の設定" class="headerlink" title="Azure Monitor エージェントによるセキュリティ イベント ログ収集の設定"></a>Azure Monitor エージェントによるセキュリティ イベント ログ収集の設定</h3><p>次に、Azure VM で データ収集ルール (DCR) を使用したセキュリティ イベント ログの収集設定手順をご紹介します。</p><ol><li><p>Azure portal から [モニター] を開きます。左リソース メニューから [設定] - [データ収集ルール] を選択し、<br>画面左上部の [+ 作成] をクリックします。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/AMA/step01.png"></p></li><li><p>データ収集ルールを作成します。以下のとおり必要項目を入力します。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/AMA/step02.png"></p></li><li><p>[+ リソースの追加] をクリックし、セキュリティ イベント ログを収集する仮想マシンを選択します。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/AMA/step03.png"></p></li><li><p>[+ データ ソースの追加] を選択します。データ ソースの種類に [Windows event logs] の [セキュリティ] を選択します。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/AMA/step04_01.png"><br>次にログを収集する Log Analytics ワークスペースを選択します。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/AMA/step04_02.png"></p></li><li><p>最後に設定内容を確認し、[作成] をクリックします。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/AMA/step05.png"></p></li><li><p>前述 4. で指定した Log Analytics ワークスペースの [ログ] から Event テーブルにセキュリティ イベント ログが収集されていることが分かります。<br><img src="/blog/LogAnalytics/HowToCollectWindowsSecurityEvents/AMA/step06.png"></p></li></ol><p>&lt;参考&gt;<br>– データ収集ルール (DCR) につきましては、下記公開情報をご覧ください。<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/agents/data-collection-rule-azure-monitor-agent">https://docs.microsoft.com/ja-jp/azure/azure-monitor/agents/data-collection-rule-azure-monitor-agent</a><br>– Azure Monitor エージェントでも、Microsoft Sentinel にセキュリティ イベント ログを収集することは可能です。<br>使用するコネクタは下記弊社公開情報をご覧ください。<br><a href="https://docs.microsoft.com/ja-jp/azure/sentinel/data-connectors-reference#windows-security-events-via-ama">https://docs.microsoft.com/ja-jp/azure/sentinel/data-connectors-reference#windows-security-events-via-ama</a></p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事では、以下についてご案内いたしましたが、ご理解いただけましたでしょうか。</p><ul><li>Log Analytics エージェントと Azure Monitor エージェントにおける収集方法の違い</li><li>Log Analytics エージェントによるセキュリティ イベント ログ収集の設定</li><li>Azure Monitor エージェントによるセキュリティ イベント ログ収集の設定</li></ul><p>本記事がご理解の助けとして、お役立ていただければ幸いです。<br>以上、Windows セキュリティ イベント ログの収集設定についてお伝えしました。</p><p>最後までお読みいただきありがとうございました！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは！ Azure Monitoring &amp;amp; Integration サポート チームの北村です。&lt;/p&gt;
&lt;p&gt;今回は Log Analytics ワークスペースにセキュリティ イベント ログを収集する方法をご案内いたします。&lt;br&gt;ご利用されているエージェントによってログ収集方法が異なりますので、エージェントごとに設定方法をご紹介いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="How-To" scheme="https://jpazmon-integ.github.io/blog/tags/How-To/"/>
    
    <category term="Tips" scheme="https://jpazmon-integ.github.io/blog/tags/Tips/"/>
    
    <category term="Log Analytics" scheme="https://jpazmon-integ.github.io/blog/tags/Log-Analytics/"/>
    
  </entry>
  
  <entry>
    <title>アラート通知メールのカスタマイズについて</title>
    <link href="https://jpazmon-integ.github.io/blog/AzureMonitorEssential/AboutCustomizingAlertNotificationEmail/"/>
    <id>https://jpazmon-integ.github.io/blog/AzureMonitorEssential/AboutCustomizingAlertNotificationEmail/</id>
    <published>2022-03-24T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.006Z</updated>
    
    <content type="html"><![CDATA[<p>2022/03/25 : 旧 UI と現 UI での対応表/図について、詳細設定オプションを考慮する内容に更新いたしました。<br>2022/07/01 : ロジック アプリから Log Analytics API を実行する記事について追記しました。</p><hr><p>こんにちは！Azure Monitoring &amp; Integration サポート チームの花房です。<br>「アラート通知メールを日本語にしたい」、「最近ログ アラート ルール作成画面が変わった？」 というお問い合わせを最近よくいただきます。<br>今回はアラート通知メールのカスタマイズに関連した以下の点についてご案内いたします。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li>アラート通知メールはカスタマイズできない</li><li>新しい API バージョン (API バージョン 2021-08-01) のログ アラート ルール作成画面</li><li>まとめ</li></ul><h2 id="アラート通知メールはカスタマイズできない"><a href="#アラート通知メールはカスタマイズできない" class="headerlink" title="アラート通知メールはカスタマイズできない"></a>アラート通知メールはカスタマイズできない</h2><p>Azure Monitor のアラート機能では、メトリックやログをトリガーにアラート通知メールを発報することができます。</p><p>このアラート通知メールは基本的にカスタマイズすることはできません。<br>このため、「日本語の通知メールにする」 や 「メールのフォーマットをカスタマイズする」、「メールのタイトルを任意の値にする」 ということはできません。</p><p>ただ、どうしてもカスタマイズしたメールを送る必要がある場合には、Logic Apps や Azure Function 等を用いてお客様側でアラート通知を実装するという代替案もございます。<br>お客様のご利用目的に合わせて実装することで、適切な通知方法や通知内容を構成することが可能です。<br>一方で、お客様にてスクリプトなどの作り込みが必要となるため、既定で用意されているメール通知と比較して実装に要する工数が増大する点はご留意ください。<br>今回はこの代替案の詳細は割愛いたしますが、一例として以下の &lt;Logic Apps の参考サイト&gt; をご参照いただき、詳しくお知りになりたい点はお気軽に私たちサポートにお問い合わせください！</p><p>&lt;Logic Apps の参考サイト&gt;<br>– 概要 - Azure Logic Apps とは<br><a href="https://docs.microsoft.com/ja-jp/azure/logic-apps/logic-apps-overview">https://docs.microsoft.com/ja-jp/azure/logic-apps/logic-apps-overview</a><br>Logic App とは、ロジック アプリ デザイナーでフロー チャートを用いて作成したワークフローを自動実行するソリューションです。<br>Logic App では、条件分岐などを実装することができ、ワークフローの実行状況に応じて実行する処理を分岐することが可能です。</p><p>メールの通知内容をカスタマイズする際の詳細な手順につきましては、下記弊社公開情報をご覧ください。<br>– Azure Monitor アラートによって複雑なアクションをトリガーする方法<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/platform/action-groups-logic-app">https://docs.microsoft.com/ja-jp/azure/azure-monitor/platform/action-groups-logic-app</a><br>※ アラート ルールの種類により設定手順は異なります。<br>&nbsp;&nbsp;&nbsp;アクティビティ ログ アラートの手順を進めていただき、手順 4 のペイロードは以下公開情報に記載のあるサンプル ペイロードをご使用ください。<br>&nbsp;&nbsp;&nbsp;– ログ アラート ルールの webhook アクション<br>&nbsp;&nbsp;&nbsp;<a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-log-webhook#sample-payloads">https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-log-webhook#sample-payloads</a></p><p>※ 上記ドキュメント内の、<br>&nbsp;&nbsp;&nbsp;Teams へのメッセージ送信である箇所 「7. Microsoft Teams コネクタを検索して選択します。 [Microsoft Teams – メッセージの投稿] アクションを選択します。」 を、以下のアクションに置き換えていただくことで、お客様にて件名等のメールの内容をカスタマイズ可能です。<br>&nbsp;&nbsp;&nbsp;– Microsoft 365 Outlook<br>&nbsp;&nbsp;&nbsp;<a href="https://docs.microsoft.com/en-us/connectors/office365/#send-an-email-[deprecated]">https://docs.microsoft.com/en-us/connectors/office365/#send-an-email-[deprecated]</a><br>&nbsp;&nbsp;&nbsp;※ 「Send an email [DEPRECATED]」 をご参照ください。</p><p>また、弊社 Integration Support Blog にロジック アプリからログ アラート発報時に出力されたデータに含まれている Log Analytics API を実行する方法に関する記事が投稿されております。<br>カスタマイズされたメールをロジック アプリから通知する方法をご検討の場合、下記の記事をご参考いただけますと幸いです。<br>&nbsp;&nbsp;&nbsp;– ログ アラート ルールの発報時に出力されたデータからクエリの検索結果を取得する<br>&nbsp;&nbsp;&nbsp;<a href="https://jpazinteg.github.io/blog/LogicApps/Integration-logAlertRule/">https://jpazinteg.github.io/blog/LogicApps/Integration-logAlertRule/</a></p><h2 id="新しい-API-バージョン-API-バージョン-2021-08-01-のログ-アラート-ルール作成画面"><a href="#新しい-API-バージョン-API-バージョン-2021-08-01-のログ-アラート-ルール作成画面" class="headerlink" title="新しい API バージョン (API バージョン 2021-08-01) のログ アラート ルール作成画面"></a>新しい API バージョン (API バージョン 2021-08-01) のログ アラート ルール作成画面</h2><p>ここまでお読みいただいて 「ログ アラート ルールであれば、メールのタイトルは任意の値にできるのでは？」 と思われた方もいるかもしれません。<br>はい、以前の API (バージョン 2018-04-16 以前) であれば、ログ アラート ルールのタイトルのカスタマイズが可能でした。<br>ただ、2021 年 12 月下旬より新しい API (バージョン 2021-08-01) の UI のリリースが開始され、現在の Azure ポータルはアラート ルール作成における動作の一部に変更がなされています。<br>このリリースにより、現在はタイトルを含めアラート通知メールのカスタマイズはできなくなりました。<br>※ 詳細は、後述の &lt;参考サイト&gt; もご参照ください。<br>なお、以前の UI で作成されたアラート ルールは、今後も以前の UI で表示されます。</p><h4 id="■-相違点-■"><a href="#■-相違点-■" class="headerlink" title="■ 相違点 ■"></a>■ 相違点 ■</h4><p>このリリースによる変更でお問い合わせいただくことが多い相違点 2 点について、以下にご案内します。</p><p><strong>相違点 1. [アクションのカスタマイズ] は使用できない</strong><br>以前は可能だった [メールの件名] 、および [Webhook 用のカスタム Json ペイロード] の項目は使用できなくなりました。<br>具体的には以下の項目となります。<br><img src="/blog/AzureMonitorEssential/AboutCustomizingAlertNotificationEmail/image01.png"></p><p><strong>相違点 2. [シグナル ロジックの構成] の項目が変更された</strong><br>アラート ルールの条件で指定する、[シグナル ロジックの構成] の項目が変更されました。<br>ただ、項目は変更されましたが、以前と同じ条件の設定をすることは可能です。<br>新旧で対応している項目については、以下となります。</p><p>&lt;対応表 / 図&gt;<br><img src="/blog/AzureMonitorEssential/AboutCustomizingAlertNotificationEmail/image02.png"><br><img src="/blog/AzureMonitorEssential/AboutCustomizingAlertNotificationEmail/image03.png"><br>例えば、旧 UI で [基準 : 結果の数] と選択していたら、新 UI では [メジャー : テーブルの行] / [集計の種類 : カウント] と設定すると同じ意味の構成になります。</p><p>※ 旧 UI [期間 (分単位)] について ※<br>-1. [クエリの時間の範囲のオーバーライド] が明示的に指定されている場合、この値が [期間 (分単位)] に相当します。<br>-2. [クエリの時間の範囲のオーバーライド] が明示的に指定されていない場合、[評価期間] が [期間 (分単位)] に相当します。<br>-3. [クエリの時間の範囲のオーバーライド] 及び [評価期間] が指定されていない場合、[評価の粒度] が [期間 (分単位)] に相当します。</p><h4 id="■-代替案-■"><a href="#■-代替案-■" class="headerlink" title="■ 代替案 ■"></a>■ 代替案 ■</h4><p>前述の通り、新しいアラート ルール作成画面から以前と同様のアラート メールを設定することはできません。<br>ただ、旧 API バージョンの ARM テンプレートや REST APIを使用してアラートをデプロイすることで、以前と同様のカスタマイズをすることが可能です。</p><p>以下の弊社サイトの 「(バージョン 2018-04-16 以前) 」 と記載されたテンプレートは旧 API バージョンの ARM テンプレートになります。<br>– Azure Monitor のログ アラート ルール用の Resource Manager テンプレートのサンプル<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/resource-manager-alerts-log">https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/resource-manager-alerts-log</a></p><p>こちらの ARM テンプレートにて以前の API を指定することで通知されるメール タイトルをカスタマイズしてアラート ルールを作成することが可能です。</p><p>&lt;参考サイト&gt;<br>このリリースによる仕様変更は、以下の弊社サイトもご参照ください。<br>– Azure Monitor を使用してログ アラートを作成、表示、管理する<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-log#create-a-log-alert-rule-in-the-azure-portal">https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-log#create-a-log-alert-rule-in-the-azure-portal</a><br><img src="/blog/AzureMonitorEssential/AboutCustomizingAlertNotificationEmail/image04.png"></p><p>【概要】<br>この記事では、新しいログ アラート ルールの変更についてご案内しており、概要としては以下となります。<br>・ 検索結果は、トリガーされたアラートとそれに関連する通知には含まれません。アラートには、ログの検索結果へのリンクが含まれています。<br>・ 新しいアラート ルール ウィザードには、トリガーされたアラートの電子メールをカスタマイズしたり、カスタム JSON ペイロードを含めたりするオプションは含まれていません。<br>・ 新しいアラート ルール ウィザードは現在 1 分の頻度をサポートしていません。1 分間のアラート頻度はまもなくサポートされます。</p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>本記事では、以下についてご案内いたしましたが、ご理解いただけましたでしょうか。</p><ul><li>アラート通知メールをカスタマイズすることはできない<br>  – 代替案は、Logic Apps や Azure Functions 等を用いてアラート通知を実装する</li><li>2021 年 12 月から新しい API  (バージョン 2021-08-01)  のアラート ルール作成画面のリリースが開始された<br>  – 代替案は、旧 API バージョンの ARM テンプレートや REST APIを使用してアラートをデプロイ</li></ul><p>以上、アラート通知メールのカスタマイズについてご案内いたしました。</p><p>本記事が少しでもお役に立ちましたら幸いです。<br>最後までお読みいただき、ありがとうございました！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;2022/03/25 : 旧 UI と現 UI での対応表/図について、詳細設定オプションを考慮する内容に更新いたしました。&lt;br&gt;2022/07/01 : ロジック アプリから Log Analytics API を実行する記事について追記しました。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;こんにちは！Azure Monitoring &amp;amp; Integration サポート チームの花房です。&lt;br&gt;「アラート通知メールを日本語にしたい」、「最近ログ アラート ルール作成画面が変わった？」 というお問い合わせを最近よくいただきます。&lt;br&gt;今回はアラート通知メールのカスタマイズに関連した以下の点についてご案内いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="How-To" scheme="https://jpazmon-integ.github.io/blog/tags/How-To/"/>
    
    <category term="Tips" scheme="https://jpazmon-integ.github.io/blog/tags/Tips/"/>
    
    <category term="Azure Monitor Essentials" scheme="https://jpazmon-integ.github.io/blog/tags/Azure-Monitor-Essentials/"/>
    
  </entry>
  
  <entry>
    <title>システム言語が日本語の Linux マシンにて発生する Log Analytics エージェントの不具合について</title>
    <link href="https://jpazmon-integ.github.io/blog/LogAnalytics/SystemLanguageNotEnglishNoPython2Bug/"/>
    <id>https://jpazmon-integ.github.io/blog/LogAnalytics/SystemLanguageNotEnglishNoPython2Bug/</id>
    <published>2022-02-27T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.094Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Monitoring &amp; Integration チームの Austin です。</p><p>最近よくお問い合わせをいただいております、Log Analytics エージェントの既知の不具合の影響・原因・回避策についてご紹介いたします。</p><span id="more"></span><h2 id="本不具合の内容およびその影響"><a href="#本不具合の内容およびその影響" class="headerlink" title="本不具合の内容およびその影響"></a>本不具合の内容およびその影響</h2><ul><li>Log Analytics エージェントのインストールに失敗する</li><li>Log Analytics エージェントからデータが正常に収集されない</li><li>Log Analytics ワークスペースの「エージェント構成」画面より収集設定を変更したが、変更が適用されない<br>＊ 例えば収集する Syslog のファシリティを追加して、OS 上にログが出力されていることを確認したのに、Log Analytics ワークスペースへ収集されない</li></ul><h2 id="不具合が発生する原因"><a href="#不具合が発生する原因" class="headerlink" title="不具合が発生する原因"></a>不具合が発生する原因</h2><p>以下 2 つの条件で不具合が発生します。</p><ol><li>システム言語 (ロケール) が英語以外に設定されている<br>＊ 「localectl」または「echo $LANG」で現在のロケールを確認できます。</li><li>python2 がインストールされていない<br>＊ RHEL 8 や CentOS 8、Ubuntu 20.04 等のマシンには python2 が規定では入っていないため、本不具合の影響を受けることが多い</li></ol><p>以下の Log Analytics の公開情報にインストール時にシステム言語が英語でないとインストールが失敗する問題について記載しておりますが、<strong>一度システム言語が英語の状態でインストールをして、その後システム言語を日本語等に変更した場合にも不具合が発生する事例を確認しております。そのため、新規 VM に Log Analytics エージェントを正常にインストールできた場合にも、その後システム言語を変更すると不具合が発生します。</strong></p><p><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/agents/agent-linux-troubleshoot#issue-installation-is-failing-saying-python2-cannot-support-ctypes-even-though-python3-is-being-used">問題: Python 3 を使用しているのに、Python 2 では Ctype をサポートしていない、というエラーが出てインストールに失敗する</a></p><h2 id="回避策について"><a href="#回避策について" class="headerlink" title="回避策について"></a>回避策について</h2><p>本不具合が発生する条件をいずれか修正することで不具合を回避いただけます。</p><ol><li><p> システム言語を英語に戻す<br>＊ RHEL 8 の場合は以下のコマンドで設定できます。<br><code>$ sudo localectl set-locale en_US.UTF-8</code></p></li><li><p>python2 をインストールする<br>＊ RHEL 8 の場合は以下のコマンドで設定できます。<br><code>$ sudo dnf install python2 -y</code><br><code>$ sudo alternatives --set python /usr/bin/python2</code></p></li></ol><p>以上、Log Analytics エージェントで発生している既知の問題と回避策をご案内いたしました。<br>弊社製品の不具合によりご不便ご迷惑おかけし申し訳ございません。<br>本不具合については、弊社開発部門にて修正作業を進めております。<br>本不具合の修正がリリースされた際には本記事を更新いたします。<br>2022 年 2 月 28 日の最新の情報です。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは。Azure Monitoring &amp;amp; Integration チームの Austin です。&lt;/p&gt;
&lt;p&gt;最近よくお問い合わせをいただいております、Log Analytics エージェントの既知の不具合の影響・原因・回避策についてご紹介いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="FAQ" scheme="https://jpazmon-integ.github.io/blog/tags/FAQ/"/>
    
    <category term="Log Analytics" scheme="https://jpazmon-integ.github.io/blog/tags/Log-Analytics/"/>
    
    <category term="Troubleshooting" scheme="https://jpazmon-integ.github.io/blog/tags/Troubleshooting/"/>
    
  </entry>
  
  <entry>
    <title>Azure Monitor 新着情報 @ Ignite 2021</title>
    <link href="https://jpazmon-integ.github.io/blog/AzureMonitorEssential/Ignite2021/"/>
    <id>https://jpazmon-integ.github.io/blog/AzureMonitorEssential/Ignite2021/</id>
    <published>2021-11-29T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.010Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring &amp; Integration チームの 鄭 です。</p><p>本記事は、2021 年 11 月 2 日に米国の Azure Monitor Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-monitor-blog/what-s-new-in-azure-monitor-ignite-2021/ba-p/2912049">What’s new in Azure Monitor @ Ignite 2021</a> を翻訳したものになります。Azure Monitor に関する最新情報をお届けいたします。</p><p>==========================================================================================</p><p>Azure Monitor は、ハイブリッド環境を完全に監視できるようにするエンタープライズ対応の豊富な機能を提供し、常に利用可能で、信頼性が高く、パフォーマンスを維持できるようにしています。 そして、Microsoft Ignite 2021で多数の新機能を発表しました。これにより、アプリとインフラストラクチャからより多くの洞察を得ることができ、Log Analytics workspace とアラートを簡単に管理できます。</p><p><strong>OpenTelemetry エクスポーターを使用して Application Insights にテレメトリを送信します。</strong></p><ol><li>OpenTelemetry のベンダーに依存しない一貫性のある API / SDK を使用して、 <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/opentelemetry-enable?tabs=net">.NET、 Node.JS、 Python</a>アプリをインストルメント化し、 Application Insights にデータを送信できるようになりました。 これらの AzureMonitor OpenTelemetry エクスポーターはプレビュー機能で、昨年リリースされた <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/java-in-process-agent">Java auto-instrumentation</a>に追加されています。</li></ol><p><strong>Container Insights を使用して Azure Arc 対応 Kubernetes クラスターを監視します。</strong></p><ol><li><a href="https://docs.microsoft.com/en-us/azure/azure-monitor/containers/container-insights-enable-arc-enabled-clusters">Azure Arc 対応 Kubernetes クラスターのサポート</a>が一般提供され、Container Insights を通じて、すべての Kubernetes、 AKS、 または非 AKS クラスターを監視できるようになりました。 Azure ポータルからの1-click onboarding を利用して、包括的な視覚化と推奨アラートを使用してクラスターのパフォーマンスを可視化できます。<br><img src="/blog/AzureMonitorEssential/Ignite2021/image01.png"></li></ol><p><strong>Network Insights を使用して VPN ゲートウェイと Azure ファイアウォールのトラブルシューティングを行います。</strong></p><ol><li>VPN ゲートウェイおよび Azure ファイアウォールリソースの <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/insights/network-insights-overview">Network Insights </a> で、豊富な insights と新しいトラブルシューティング機能を利用できるようになりました。 リソースの状態と接続されたリソースを示すリソース トポロジを視覚化し、厳選された監視ワークブックを開始できます。<br><img src="/blog/AzureMonitorEssential/Ignite2021/image02.png"></li></ol><p><strong>新しい機能を使用し、Log Analytics workspace の管理および監視を行います。</strong></p><ol><li><p><a href="https://docs.microsoft.com/en-us/azure/azure-monitor/logs/log-analytics-workspace-insights-overview">Log Analytics Workspace Insights</a>が一般提供になりました。これを使用すると、ワークスペースの使用状況、パフォーマンス、ヘルス、エージェント、クエリ、および変更ログの統合ビューを通じて、ワークスペースの包括的なビューを取得できます。<br><img src="/blog/AzureMonitorEssential/Ignite2021/image03.png"></p></li><li><p>Azureポータル内で直接 Log Analytics <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/logs/logs-data-export?tabs=portal">workspace からデータエクスポート ルールを簡単に管理できるようになりました</a>（プレビュー中）。 新しい機能は、ワークスペース内の既存のルールが有効な状態か無効な状態かに関係なく、明確に表示されます。 いくつかの簡単な手順で、既存のルールを編集して新しいルールを作成することもできます。</p></li></ol><p><strong>Azure Monitor Alerts から EventHub アクションをトリガーします。</strong></p><ol><li>Azure Monitor Alerts の新しい <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/alerts/action-groups">EventHub アクション</a>を使用すると、信頼性が高くスケーラブルなキューイングテクノロジを利用してアラートを取り込むことができます。 プライベートリンクを使用して EventHub にサブスクライブすることで、ネットワークの分離を実現することもできます。</li></ol><p>Azure Monitor とモニタリングのベストプラクティスの詳細については、<a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/">ドキュメント</a>と <a href="https://www.youtube.com/playlist?list=PLLasX02E8BPCCsHzNLJjcElCwF52rnh6t">how-to videos</a> をご覧ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring &amp;amp; Integration チームの 鄭 です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 11 月 2 日に米国の Azure Monitor Blog で公開された &lt;a href=&quot;https://techcommun</summary>
      
    
    
    
    
    <category term="Azure Monitor" scheme="https://jpazmon-integ.github.io/blog/tags/Azure-Monitor/"/>
    
  </entry>
  
  <entry>
    <title>メトリック アラートの発報タイミングについて</title>
    <link href="https://jpazmon-integ.github.io/blog/AzureMonitorEssential/HowMetricAlertisFired/"/>
    <id>https://jpazmon-integ.github.io/blog/AzureMonitorEssential/HowMetricAlertisFired/</id>
    <published>2021-09-29T16:30:00.000Z</published>
    <updated>2022-07-01T00:33:54.006Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！ Azure Monitoring &amp; Integration チームでサマー インターンシップをしている、中条 夢佳 (チュウジョウ ユメカ) です。<br>「Azure Monitor で VM の監視ができるのか、よし、じゃあ実際にメトリック アラートを設定してみよう！ ・・・あれ? なんか思っていた動作と違うような?」<br>こんな方に読んでいただきたい記事です！</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E3%83%A1%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF-%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%88%E3%81%8C%E7%99%BA%E5%A0%B1%E3%81%95%E3%82%8C%E3%82%8B%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0">メトリック アラートが発報されるタイミング</a></li><li><a href="#%E9%9B%86%E7%B4%84%E7%B2%92%E5%BA%A6%E3%81%A8%E8%A9%95%E4%BE%A1%E3%81%AE%E9%A0%BB%E5%BA%A6%E3%81%A3%E3%81%A6%E4%BD%95">集約粒度と評価の頻度って何?</a></li><li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li></ul><h2 id="メトリック-アラートが発報されるタイミング"><a href="#メトリック-アラートが発報されるタイミング" class="headerlink" title="メトリック アラートが発報されるタイミング"></a>メトリック アラートが発報されるタイミング</h2><p>メトリック アラートは既定でステートフルとなっています。ステートフルとは状態が変化した場合のみ通知するということです。  </p><p>まず、条件を満たした場合にはアラート (Fired / Triggered 等) を発報します。その後の評価で、同様に条件を満たしていても、アラートは発報しません。次に、条件を満たさなくなった場合には再びアラート (Resolved) が発報しますが、これは 1 回条件を満たさなくなった場合ではなく、3 回連続で条件を満たさなくなった場合に発報します。  </p><p>なお、 既定ではステートフルと設定されていますが、これをステートレスに変更することも可能です。こちらの設定方法については、下記の弊社公開情報をご覧ください。</p><blockquote><p>Azure Monitor のメトリック警告に関する問題のトラブルシューティング - 条件が満たされるたびにメトリック警告が発生するようにする<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-troubleshoot-metric#make-metric-alerts-occur-every-time-my-condition-is-met">https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-troubleshoot-metric#make-metric-alerts-occur-every-time-my-condition-is-met</a></p></blockquote><h2 id="集約粒度と評価の頻度って何"><a href="#集約粒度と評価の頻度って何" class="headerlink" title="集約粒度と評価の頻度って何?"></a>集約粒度と評価の頻度って何?</h2><p>メトリック アラートのアラート ルールを設定する際に、集約粒度 (期間) と評価の頻度という評価基準の値を設定しますが、これって何が違うの? 何で 2 つも時間を設定しなきゃいけないの? と感じた方もいらっしゃるかと思います。<br>言葉の定義としては “集約粒度” は「1 回の評価を行う際に評価の対象となる期間」を表し、”評価の頻度” は「何分おきに評価を行うか」を表します。  </p><p>ここで、メトリック アラートを使用した場合の動作の例を示します。<br>「集約粒度を 5 分、評価の頻度を 1 分、 CPU の使用率の最大値が閾値 70% 以上」 というアラート ルールを設定した場合、直近 5 分間における CPU の使用率のデータを、1 分おきに評価します。Azure Portal でアラート ルールの条件を設定する場合は以下のような画面になります。    </p><p><img src="/blog/AzureMonitorEssential/HowMetricAlertisFired/image01.png"></p><p>アラートの動作としては、1 度でも直近 5 分間における CPU 使用率の最大値が 70% 以上になった場合に、アラート (Fired / Triggered 等) を発報します。引き続き、1 分おきに評価を続け、3 回連続で直近 5 分間における CPU 使用率の最大値が 70% を下回った場合に、アラート (Resolved) を発報します。  </p><p>下記に示すのがアラートの動作の例です。<br><img src="/blog/AzureMonitorEssential/HowMetricAlertisFired/image02.png"></p><p>0:06 時点で CPU 使用率の最大値が 70% を超えたため、0:06 にアラート (Fired) が発報されます。次に 0:10 時点で CPU 使用率の最大値は 70% を下回りましたが、この時点ではアラートは発報しません。その後も評価を続け、3 回連続で直近 5 分間の CPU 使用率の最大値が 70% を下回った 0:16 時点で、アラート (Resolved) を発報します。</p><p>メトリック アラートの詳細につきましては、下記の弊社公開情報をご覧ください。  </p><blockquote><p>Azure Monitor でのメトリック アラートの機能<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-metric-overview">https://docs.microsoft.com/ja-jp/azure/azure-monitor/alerts/alerts-metric-overview</a></p></blockquote><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>以下の 3 点についてご理解いただけたでしょうか。</p><ul><li>メトリック アラートは状態が変化した場合のみに発報すること</li><li>条件を満たすとアラート (Fired / Triggered等) を発報し、3 回連続で条件を満たさなくなった場合に、アラート (Resolved) を発報すること</li><li>“集約粒度” と “評価の頻度” が表す意味</li></ul><p>本記事がご理解の助けとして、お役立ていただければ幸いです。</p><p>以上、メトリック アラートの発報タイミングに関する詳細についてお伝えしました。<br>最後までお読みいただきありがとうございました！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは！ Azure Monitoring &amp;amp; Integration チームでサマー インターンシップをしている、中条 夢佳 (チュウジョウ ユメカ) です。&lt;br&gt;「Azure Monitor で VM の監視ができるのか、よし、じゃあ実際にメトリック アラートを設定してみよう！ ・・・あれ? なんか思っていた動作と違うような?」&lt;br&gt;こんな方に読んでいただきたい記事です！&lt;/p&gt;</summary>
    
    
    
    
    <category term="Azure Monitor" scheme="https://jpazmon-integ.github.io/blog/tags/Azure-Monitor/"/>
    
    <category term="FAQ" scheme="https://jpazmon-integ.github.io/blog/tags/FAQ/"/>
    
    <category term="MetricAlert" scheme="https://jpazmon-integ.github.io/blog/tags/MetricAlert/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 5 弾&gt; Azure Monitoring &amp; Integration チームについて～一緒に働く仲間を募集しています～</title>
    <link href="https://jpazmon-integ.github.io/blog/general/JoinUs/"/>
    <id>https://jpazmon-integ.github.io/blog/general/JoinUs/</id>
    <published>2021-09-21T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.138Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure Monitoring &amp; Integration チームの明渡です。現在わたしたちのチームでは、一緒に Azure サポートを盛り上げてくださるメンバーを絶賛大募集中です！今回は、どのような方に活躍いただけるかや実際の選考についてをチーム メンバーにアンケートしたのでご紹介します。当てはまる、共感できる、と思われた方は是非採用ページよりご応募ください！<br><img src="/blog/general/JoinUs/Satya.png"></p><p>*「もしあなた自身がかっこよくなりたいのであれば、マイクロソフトはあなたの働く場所ではない。もしあなたが誰かをかっこよくしたいのであればぜひマイクロソフトで一緒に働きましょう」 とのサティアからのメッセージです。他者や社会に貢献・奉仕することでやりがいを感じる方に是非ご応募いただけたらと思います。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E3%81%93%E3%82%93%E3%81%AA%E6%96%B9%E5%A4%A7%E6%AD%93%E8%BF%8E%EF%BC%81">こんな方大歓迎！</a></li><li><a href="#%E5%90%91%E4%B8%8A%E5%BF%83%E3%81%8C%E3%81%82%E3%82%8C%E3%81%B0%E5%A4%A7%E4%B8%88%E5%A4%AB%E3%81%A7%E3%81%99%EF%BC%81">向上心があれば大丈夫です！</a></li><li><a href="#%E9%9D%A2%E6%8E%A5%E3%81%AB%E5%90%91%E3%81%91%E3%81%9F%E6%BA%96%E5%82%99%E3%82%84%E3%80%81%E9%9D%A2%E6%8E%A5%E3%82%92%E6%8C%AF%E3%82%8A%E8%BF%94%E3%81%A3%E3%81%9F%E6%84%9F%E6%83%B3%E3%81%AF%EF%BC%9F">面接に向けた準備や、面接を振り返った感想は？</a></li><li><a href="#%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AE%E9%AD%85%E5%8A%9B%E3%82%84%E3%82%A2%E3%83%94%E3%83%BC%E3%83%AB%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">チームの魅力やアピールポイント</a></li><li><a href="#%E3%83%AA%E3%83%B3%E3%82%AF%E9%9B%86">リンク集</a></li></ul><h2 id="こんな方大歓迎！"><a href="#こんな方大歓迎！" class="headerlink" title="こんな方大歓迎！"></a>こんな方大歓迎！</h2><p>まずは、チーム メンバーにどのような方と一緒に働きたいかを聞いてみました。</p><h3 id="Voices-from-our-team"><a href="#Voices-from-our-team" class="headerlink" title="Voices from our team"></a><em><strong>Voices from our team</strong></em></h3><p><img src="/blog/general/JoinUs/yuisan.png">&gt; いろいろな技術を手を動かして触ることが好きな方。未経験なエリアでも挑戦することに楽しさを感じられる方。</p><p><img src="/blog/general/JoinUs/kentoyosan.png">&gt; 何にでも興味を持てる方。技術の使われ方よりも仕組みに興味を持てる方。</p><p><img src="/blog/general/JoinUs/masushiosan.png">&gt; 協力的な方、チャレンジングな方。</p><p><img src="/blog/general/JoinUs/dasasakisan.png">&gt; ジャンル問わず技術に興味のある方。他の仲間の役に立ちたいと思う方。</p><p><img src="/blog/general/JoinUs/chosan.png">&gt; ログやスクリプトが読めなくてもとりあえず読もうとする方。検証好きな方。</p><p><img src="/blog/general/JoinUs/dainomatsan.png">&gt; 好奇心旺盛な方、テック大好きな方、ドキュメント読むのが苦でない方。 (わたしはたまに苦戦します)</p><p><img src="/blog/general/JoinUs/junsan.png">&gt; 自分で積極的に手を動かせる方。(あのリソース作ってみよう、このアーキテクチャを試してみよう、など) また、今まで色々な修羅場 ・ 炎上案件を乗り越えてきた方。</p><p><img src="/blog/general/JoinUs/horisan.png">&gt; フル リモートで働いているので、チーム メンバーに積極的にコミュニケーション取れる方。わからないことがあれば、質問できる方。</p><h2 id="向上心があれば大丈夫です！"><a href="#向上心があれば大丈夫です！" class="headerlink" title="向上心があれば大丈夫です！"></a>向上心があれば大丈夫です！</h2><p>興味はあるけど監視製品は携わったことないな、と思われる方もいらっしゃるかもしれません。しかし我々のチームでは、過半数のメンバーは前職で Azure Monitoring &amp; Integration に関する技術を経験しておりません。様々なバックグラウンドをもった方が集結し、日々勉強しながら技術をキャッチアップしています。そこで、 Microsoft に入社する前にどのような経験をされたことがあるか、またどのような経験が役立っているかを聞いてみました。</p><h3 id="Voices-from-our-team-1"><a href="#Voices-from-our-team-1" class="headerlink" title="Voices from our team"></a><em><strong>Voices from our team</strong></em></h3><p>“前職というか、大学での経験になりますが、総合的な Computer Science の知識を学べたこと、学会発表などを通して英語を学べたことが役に立っているかなと思います。”</p><p>“前職では未経験です。前職の技術では Linux OS に関するものが役に立っています。”</p><p>“ 11年間の開発経験が役に立っています。お客様は開発者であることがほとんどなので、何に困っているか ・ 何がしたいかなどがなんとなく分かります。”</p><p>“前職では特に Monitoring &amp; Integration に関する技術は経験してません。ただ、様々な環境でのデバッグやトラブルシューティングは経験していたので、すぐに業務に着手できました。”</p><p>“前職では Azure について特に経験しておらず、某クラウド製品 の EC2 を使用していた程度です。私は特に Web アプリケーションや Windows のクライアント アプリケーションを開発する事が多かったのですが、 Application Insights について対応する時にはどちらの経験も役立っています。 Azure Montor と関連し使用される製品は多いので、どんな経験も役に立つのではないかと思います。”</p><p>“前職では O365 運用をしていましたが、Automation で O365 関連ケースが来たら前職で触れていた内容を応用して対応したりします。”</p><h2 id="面接に向けた準備や、面接を振り返った感想は？"><a href="#面接に向けた準備や、面接を振り返った感想は？" class="headerlink" title="面接に向けた準備や、面接を振り返った感想は？"></a>面接に向けた準備や、面接を振り返った感想は？</h2><p>では実際に Azure Monitoring &amp; Integration エリアにて選考を進めるにあたり、どのような準備をしたか、また当時の面接を振り返ってどのような受け答えが評価されたと思うかを聞いてみました。</p><h3 id="Voices-from-our-team-2"><a href="#Voices-from-our-team-2" class="headerlink" title="Voices from our team"></a><em><strong>Voices from our team</strong></em></h3><p>“面接では事前にプレワーク (Azure Monitor に関する簡単な課題) が用意されており、そちらをしっかりこなしていました。また面接対策というわけではないですが、CSS (Customer Service ＆ Support) が発信しているものはなるべく目を通しました。後はいつも通りの生活をし、美味しいものを食べて、心身共に充実した状態で臨めるように意識しました。”</p><p>“面接ではいわゆる behavior question、行動面接と呼ばれるような形の質問が印象的でした。その質問を受けた際に自分が普段どう考えてどうするかを “飾らず” に受け答えできたのがよかったのではないかと思っています。”</p><p>“Azure MonitorとLog Analyticsを触ったことがなかったので、時間をとってじっくり触りました。 (背景 : 面接前に課題を提示されたので内容を充実させたかった) この製品が出るまでの技術的背景などは昔から製品を触っていてよく知っている有識者に話を聞きました。”</p><p>“Azure および Azure Monitor に関する業務経験はほぼないですが、監視製品 (他社製品) およびインフラに関する基本的な知識と運用経験や、周りへの知識の伝搬 (OJTなど) を継続して行ってきた経験、お客様環境の社内マニュアル作成(数万人が見るもの)や問い合わせ対応など、お客様へのサポートを行った経験をアピールしました。”</p><p>“技術面では、失敗談を改善点含めて話せた点が良かったと思います。また 1 人で仕事をするわけではないので、何かできないことや困ったことがあった場合にチームに頼る、という受け答えをしました。あとは 「非技術領域を含め知っていることや勉強したことを何とかして周りに発信したい」という思いが強いため、こちらを上手く面接で伝えられたのが良かったのではないかと思います。”</p><p>“一次面接では実際にお客様の対応を行っている方が面談していただけるということだったので、製品を使用する上でわからない箇所や疑問に思った部分などをまとめて、当日に確認できるようにしていました。その後も継続して製品を触って技術を高めていこうという気持ちになりました。”</p><p>“二次面接ではマネージャー クラスとの面接でしたので、一次面接で緊張して聞きそびれたことと会社の評価基準やチームとしての考え方を質問として準備していました。 「この会社で働けたら、技術的成長だけではなく人間的に成長できるだろう」 と感じたため、入社したい思いがより強くなりました。”</p><p>“某転職エージェントでスカウトされたのをきっかけに選考に進みました。スカウトされた理由として、他社クラウド製品の資格や Kubernetes 技術者認定、等クラウドまわりの資格を持っていたためかなと思います。なお IT 経験が2年ほどと浅かったので、Microsoft に入れるか少し不安はありましたが、挑戦する気持ちを持って面接に臨みました。”</p><p>“面接前に出題された課題について 「こういうエラーに逢いましたが、ここで調べて、これをやってみたら解消できた」 と話したのが好印象だったと思います。”</p><p>“Microsoft 社内で色々なキャリアを描くことが可能 (違う部署、または他国で働く等) であるため、3 年後、10 年後の自分がどのような仕事をしていたいかを会話すると良いかもしれません。”</p><p>“面接官が聞きたいであろうことはあまり気にせず、とにかく自分がやりたい仕事、キャリアパスについて正直にお伝えしたら合格しました。適度な緊張感を持ちつつ面接を楽しむことをお勧めします！”</p><h2 id="チームの魅力やアピールポイント"><a href="#チームの魅力やアピールポイント" class="headerlink" title="チームの魅力やアピールポイント"></a>チームの魅力やアピールポイント</h2><p>最後に、我々チームの魅力やアピール ポイントをお伝えします！</p><h3 id="Voices-from-our-team-3"><a href="#Voices-from-our-team-3" class="headerlink" title="Voices from our team"></a><em><strong>Voices from our team</strong></em></h3><p>“これから成長が期待されるエリアであり、またチームとしても色々なチャレンジができるチームであること！”</p><p>“サービスの稼働確認や障害発生時の対応と原因究明を行うにあたり欠かせないのが “監視” であり、サービスの安定稼働には欠かせない存在と思います。他製品とも多く携われるポジションであり、縁の下の力持ち的な存在である Monitoring ＆ Integration 製品でお客様のサービスに貢献できます。”</p><p>“Azure イチ活気ある &amp; 面白いメンバーが揃っているチームだと思っています！楽しく Azure の仕事がしたい人は是非。”</p><p>“約 11 年間勤めた会社を辞めて、しかもフルリモートで働くことに対してメチャクチャ不安でしたが、全く問題ありませんでした。なぜならば、Azure Monitoring &amp; Integration チームのメンバーはみんないい人だからです。何も恐れることはありません。みなさまで Azure をワイワイ盛り上げましょう！”</p><p>“Azure Monitoring &amp; Integration チームでは、メンバーの相互理解を深めるために自己紹介を定期的に行っていますが、こんなにチームの交流のために、自己紹介の時間を設けているようなチームは中々ないと思います。チーム内の雰囲気もとてもよく、何もできない新卒の私を温かく迎えてくだり手を差し伸べてくれるチームです。私はとてもお勧めします。”</p><h2 id="リンク集"><a href="#リンク集" class="headerlink" title="リンク集"></a>リンク集</h2><ul><li><p><a href="https://careers.microsoft.com/us/en/job/1066264/Azure-Monitoring-Support-Engineer">Azure Monitoring Support Engineer</a><br>※ ご応募はこちらから。</p></li><li><p><a href="https://www.microsoft.com/ja-jp/mscorp/mid-career/event.aspx">サポート エンジニア オンライン説明会</a><br>※ 定期的に説明会を開催しています。</p></li><li><p><a href="https://jpaztech.github.io/blog/other/technical_support_engineer_explained/">なぜ今サポートエンジニアが熱いか</a></p></li><li><p><a href="https://www.linkedin.com/pulse/%E5%A5%BD%E3%81%8D%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%8B%E3%82%89%E3%81%AF%E3%81%98%E3%82%81%E3%82%88%E3%81%86-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%AA%E3%82%A2%E8%A6%B3-teppei-ishii/?originalSubdomain=jp">好きになるからはじめよう サポートエンジニアのキャリア観</a></p></li><li><p><a href="https://japan.zdnet.com/extra/microsoft_support_201803/35116283/">単なる問い合わせ対応でなくお客様のパートナーになる。マイクロソフトのAzureカスタマーサービスが支持される理由 - ZDNet Japan</a></p></li></ul><h2 id="関連記事"><a href="#関連記事" class="headerlink" title="関連記事"></a>関連記事</h2><p>Azure Monitoring &amp; Integration チームの紹介記事は第 1 弾から第 5 弾まで公開しています。<br>以下のリンクから、その他の記事も是非一緒にご覧ください！</p><ul><li><a href="https://jpazmon-integ.github.io/blog/general/AboutMonandIntg/">&lt;第 1 弾&gt; Azure Monitoring &amp; Integration チームについて</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/HowWeWorkRemotely/">&lt;第 2 弾&gt; Azure Monitoring &amp; Integration チームについて リモート ワークでの働き方</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/OurTeamAtmosphere/">&lt;第 3 弾&gt; Azure Monitoring &amp; Integration チームのようす、雰囲気について</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/TeamIntroductionfromInternship/">&lt;第 4 弾&gt; インターン生から見た Azure Monitoring &amp; Integration チーム</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/JoinUs/">&lt;第 5 弾&gt; Azure Monitoring &amp; Integration チームについて～一緒に働く仲間を募集しています～</a></li></ul><p>以上、 Azure Monitoring &amp; Integration チーム紹介 Blog の第 5 弾でした！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure Monitoring &amp;amp; Integration チームの明渡です。現在わたしたちのチームでは、一緒に Azure サポートを盛り上げてくださるメンバーを絶賛大募集中です！今回は、どのような方に活躍いただけるかや実際の選考についてをチーム </summary>
      
    
    
    
    
    <category term="General" scheme="https://jpazmon-integ.github.io/blog/tags/General/"/>
    
    <category term="チーム紹介" scheme="https://jpazmon-integ.github.io/blog/tags/%E3%83%81%E3%83%BC%E3%83%A0%E7%B4%B9%E4%BB%8B/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 4 弾&gt; インターン生から見た Azure Monitoring &amp; Integration チーム</title>
    <link href="https://jpazmon-integ.github.io/blog/general/TeamIntroductionfromInternship/"/>
    <id>https://jpazmon-integ.github.io/blog/general/TeamIntroductionfromInternship/</id>
    <published>2021-09-21T08:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.146Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！Azure Monitoring &amp; Integration チームでサマー インターンシップをさせていただいております、中条 夢佳 (チュウジョウ ユメカ) です。<br>今回はインターン生として実際に働いてみて、Microsoft という会社、サポート エンジニアという仕事、チームの魅力についてお伝えしたいと思います！</p><span id="more"></span><p><img src="/blog/general/TeamIntroductionfromInternship/photo1.png"></p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#1-Microsoft-%E3%81%AE%E9%AD%85%E5%8A%9B">1. Microsoft の魅力</a></li><li><a href="#2-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88-%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%81%A8%E3%81%97%E3%81%A6%E5%83%8D%E3%81%8F%E3%81%93%E3%81%A8%E3%81%AE%E9%AD%85%E5%8A%9B">2. サポート エンジニアとして働くことの魅力</a></li><li><a href="#3-Azure-Monitoring-&%5EIntegration-%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AE%E9%AD%85%E5%8A%9B">3. Azure Monitoring &amp; Integration チームの魅力</a></li><li><a href="#4-%E3%81%BE%E3%81%A8%E3%82%81">4. まとめ</a></li></ul><h2 id="1-Microsoft-の魅力"><a href="#1-Microsoft-の魅力" class="headerlink" title="1. Microsoft の魅力"></a>1. Microsoft の魅力</h2><p>Microsoft には自分が輝くのではなく、お客様やチームの仲間を輝かせることを大切にするという考え方があります。他者への貢献が評価され、自社の利益ではなく社会への貢献を目指しているからこそ、Microsoft は長きにわたり成長し続けているのです。『地球上のすべての個人とすべての組織が、より多くのことを達成できるようにする』という Microsoft が掲げているミッションを実現しようとする本気度を感じます。このミッションの “地球上のすべての個人とすべての組織が” ということを実現させるために、Microsoft では社内の多様化が進んでおり、誰もが自己を認められ、自分らしく働くことができる環境作りに取り組んでいます。この Diversity &amp; Inclusion という考え方を知ることで、自分とは異なる価値観とお互いを尊重して認め合うことを学び、より幅広いお客様により適切なアプローチができるようになります。<br>さらに Microsoft ではサポート エンジニアだけではなく、技術的な提案をする営業など他の職種や、海外へ挑戦する機会もあり、日々過去の自分よりも成長しようとすることを歓迎し、評価する文化があります。<br>今年の新卒採用の選考過程、およびサマー インターンシップは、すべてオンラインで実施されています。Microsoft Teamsという自社のIT技術を駆使し、すべてフル リモートで参加できる仕組みが確立されています。こうした社会情勢に柔軟に対応できるというのも、Microsoft ならではの魅力ではないでしょうか。</p><p><img src="/blog/general/TeamIntroductionfromInternship/photo2.png"></p><h2 id="2-サポート-エンジニアとして働くことの魅力"><a href="#2-サポート-エンジニアとして働くことの魅力" class="headerlink" title="2. サポート エンジニアとして働くことの魅力"></a>2. サポート エンジニアとして働くことの魅力</h2><p>お客様が Microsoft の製品をお使いいただく中で、自分では解決できないお困りごとがあると、サポート チームに連絡をいただきます。<br>そして、製品のプロフェッショナルであるサポート エンジニアが、マニュアルに従って、お悩みをサクッと解決！と思いきや、実はそうではないのです。<br>お客様からご相談いただくお困りごとは、一見同じ内容のように見えても、それぞれご質問をいただいた背景が異なります。お客様のご事情を把握し、ご質問を解決した先にあるお客様が達成したいことを実現するために必要な、適切な情報を回答することを大切にしています。ご質問にお答えするだけではなく、さらにお客様にとって価値のある情報を回答するために、お客様から話を伺い、真に必要な情報を見極めることが、サポート エンジニアに求められるスキルです。<br>Microsoft のサポート エンジニアは製品技術の知識、お客様とのコミュニケーションの方法、適切な解決策を導き出す洞察力を身に付けるために最適な場所だと考えています。</p><h2 id="3-Azure-Monitoring-amp-Integration-チームの魅力"><a href="#3-Azure-Monitoring-amp-Integration-チームの魅力" class="headerlink" title="3. Azure Monitoring &amp; Integration チームの魅力"></a>3. Azure Monitoring &amp; Integration チームの魅力</h2><p>チームの皆さんとお話しさせていただく中で、私が感じた魅力をぎゅっと 3 点にまとめてご紹介します。</p><h3 id="助け合い精神"><a href="#助け合い精神" class="headerlink" title="助け合い精神"></a>助け合い精神</h3><p>外資系の会社って社内競争が厳しくて、チーム内が殺伐としていそう… というイメージとは全く逆でした。自分一人で解決できない問題にぶつかったとき、必ずチームの誰かが手を差し伸べてくれます。自分の持っている知識を共有するだけではなく、時には一緒に悩んで解決策を考えて、チームで問題を解決していくという雰囲気の中で、先輩社員の方をお手本にして成長していける環境だと思います。</p><h3 id="思いやりの心"><a href="#思いやりの心" class="headerlink" title="思いやりの心"></a>思いやりの心</h3><p>先輩社員の方は質問がしやすいように、自分がどんなに忙しくとも相談者の対応を優先するという意識を持たれていたり、失敗してしまった後輩社員の方を怒ったり責めたりせず、一緒に落ち込んで、失敗を次に活かす方法を一緒に考えたりしてくださるそうです。<br>チームでは 1 人あたり 30 分の持ち時間で自己紹介、自己開示をする時間を定期的につくっています。これは 1 人 1 回だけで終わりではありません。今までの経験、興味分野、家族、趣味などざっくばらんに、チーム メンバーそれぞれがみんなに知ってもらいたいことをシェアすることで、リモート ワークで離れていても、お互いのことをよく知ることができ、相談しやすいチームの雰囲気作りをしています。</p><h3 id="夢を叶える応援"><a href="#夢を叶える応援" class="headerlink" title="夢を叶える応援"></a>夢を叶える応援</h3><p>マネージャーはチーム ミーティングの際に、技術的な面だけではなく、精神面についてもお伝えくださいます。たとえば、『目標を叶えるための方法』について、ご自身のエピソードを交えて具体的にお話しいただきました。ほかにも『仕事の意義』『絶対不変の真理』『凡事徹底』など、働き方、生き方について、今後の指針になるようなトピックを毎回お伝えいただくことで、自分の課題や今後の目標を見つめ直す機会になります。<br>さらに、マネージャーと定期的に 1 対 1 でお話しする機会があります。自分が今後どうなりたいかをお伝えすると、目標に近づくためにはどうすればよいかを一緒に考えてくださいます。自分自身が成長したい！という想いがあれば、必ず応援してくださる強い味方となってくださるマネージャーがまとめてくださるチームというのは、とても素敵な環境だと感じています。</p><h2 id="4-まとめ"><a href="#4-まとめ" class="headerlink" title="4. まとめ"></a>4. まとめ</h2><p>このチームでのインターンシップを通して、サポート エンジニアのお仕事の魅力は、お客様とサポート エンジニアが共に、問題を解決したいという同じ方向に向かって進むことができることであるとわかりました。だからこそ、難しい問題をチームで解決できた時の達成感や、お客様からいただく “ありがとう” という言葉が、やりがいに繋がっていると感じます。<br>そして、お話しを聞く中で皆さんがおっしゃっていた、チームの皆さんは素敵な人、このチームが好きという言葉にも象徴されるように、お互いを尊重し合いながら働いていらっしゃるのが、このチームの魅力であるように感じています。<br>本当に素敵な Azure Monitoring &amp; Integration チームの皆さんと出会うことができ、インターン生として一緒に働くことができて、とても幸せに思います。<br>自分の成長を日々実感しながら、誰かのために働きたい、そんな思いをお持ちの方は、ぜひ勇気を出して一歩踏み出してみてください！</p><h2 id="関連記事"><a href="#関連記事" class="headerlink" title="関連記事"></a>関連記事</h2><p>Azure Monitoring &amp; Integration チームの紹介記事は第 1 弾から第 5 弾まで公開しています。<br>以下のリンクから、その他の記事も是非一緒にご覧ください！</p><ul><li><a href="https://jpazmon-integ.github.io/blog/general/AboutMonandIntg/">&lt;第 1 弾&gt; Azure Monitoring &amp; Integration チームについて</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/HowWeWorkRemotely/">&lt;第 2 弾&gt; Azure Monitoring &amp; Integration チームについて リモート ワークでの働き方</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/OurTeamAtmosphere/">&lt;第 3 弾&gt; Azure Monitoring &amp; Integration チームのようす、雰囲気について</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/TeamIntroductionfromInternship/">&lt;第 4 弾&gt; インターン生から見た Azure Monitoring &amp; Integration チーム</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/JoinUs/">&lt;第 5 弾&gt; Azure Monitoring &amp; Integration チームについて～一緒に働く仲間を募集しています～</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは！Azure Monitoring &amp;amp; Integration チームでサマー インターンシップをさせていただいております、中条 夢佳 (チュウジョウ ユメカ) です。&lt;br&gt;今回はインターン生として実際に働いてみて、Microsoft という会社、サポート エンジニアという仕事、チームの魅力についてお伝えしたいと思います！&lt;/p&gt;</summary>
    
    
    
    
    <category term="General" scheme="https://jpazmon-integ.github.io/blog/tags/General/"/>
    
    <category term="チーム紹介" scheme="https://jpazmon-integ.github.io/blog/tags/%E3%83%81%E3%83%BC%E3%83%A0%E7%B4%B9%E4%BB%8B/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 3 弾&gt; Azure Monitoring &amp; Integration チームのようす、雰囲気について</title>
    <link href="https://jpazmon-integ.github.io/blog/general/OurTeamAtmosphere/"/>
    <id>https://jpazmon-integ.github.io/blog/general/OurTeamAtmosphere/</id>
    <published>2021-09-04T11:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.138Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！Azure Monitoring &amp; Integration チームの猪股です。<br>現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です！！<br>今日は、私たちのチームの普段のようすや雰囲気について紹介いたします。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AE%E3%82%88%E3%81%86%E3%81%99%E3%80%81%E9%9B%B0%E5%9B%B2%E6%B0%97">チームのようす、雰囲気</a></li><li><a href="#Voices-from-our-team">Voices from our team</a></li><li><a href="#%E3%81%93%E3%81%AE%E3%83%81%E3%83%BC%E3%83%A0%E3%82%92%E9%81%B8%E3%82%93%E3%81%A0%E7%90%86%E7%94%B1%E3%81%AF%EF%BC%9F%EF%BC%9F">このチームを選んだ理由は？？</a></li><li><a href="#%EF%BD%9E-%E3%81%82%E3%82%8B%E6%97%A5%E3%81%AE%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%E3%82%88%E3%82%8A-%EF%BD%9E">～ ある日のチャットより ～</a></li><li><a href="#%E3%83%81%E3%83%BC%E3%83%A0-%E3%83%A1%E3%83%B3%E3%83%90%E3%83%BC%E3%81%AE%E6%8A%80%E8%A1%93%E5%BF%97%E5%90%91%E3%82%A8%E3%83%AA%E3%82%A2">チーム メンバーの技術志向エリア</a></li></ul><h2 id="チームのようす、雰囲気"><a href="#チームのようす、雰囲気" class="headerlink" title="チームのようす、雰囲気"></a>チームのようす、雰囲気</h2><p>現在はそれぞれ自宅からフル リモートで仕事しています。わたしも入社して 1 年 4 ヶ月経ちますが、入社してから 2 回 (入社日含む。面接ですら全部オンラインでした) しかオフィスに行ったことないです。ほとんど Teams のチャットや電話で対応できますし、そのような環境が整っており、またチームみんなからのサポートで仕事を進めることができます。</p><p><strong>お陰様で Azure 事業は好調であり、チームも今伸び盛りの状況で更に一緒に Azure Monitoring &amp; Integration サポートを盛り上げていける仲間を募集しています !!!</strong></p><h2 id="Voices-from-our-team"><a href="#Voices-from-our-team" class="headerlink" title="Voices from our team"></a><em><strong>Voices from our team</strong></em></h2><blockquote><p>和気藹々とした雰囲気。 困ったこと、相談事があれば、みんなが積極的に助けてくれる。</p></blockquote><blockquote><p>仲良く、冗談を言い合いながらチームみんなで課題に向かっていくよい雰囲気</p></blockquote><blockquote><p>入社歴が短い人が半数以上で、和気あいあいとやっている雰囲気 。冷たい感じは全くしない 。アットホームな職場です＾＾</p></blockquote><blockquote><p>みんな協力的で、困ったことがあったらすぐにアドバイスをもらえる。</p></blockquote><blockquote><p>あだ名で呼び合っていたり、業務外でのチャットなどでの交流が多かったりと、とても仲の良い雰囲気</p></blockquote><blockquote><p>お問い合わせ対応について私から相談すること、相談をチーム宛にいただく事が多いのですが、 普段から業務内外問わず会話が多く皆さん優しいのでお話しやすいです。 ワーク フロム ホームが一般的な時代になっていますが、仲がいいので疎外感等感じる事はないです。</p></blockquote><blockquote><p>オープン わきあいあい！</p></blockquote><blockquote><p>意見交換しやすい雰囲気です。さりげなく質問することができて、お互いに助け合う雰囲気です。</p></blockquote><blockquote><p>オープン、フレンドリーでカジュアル。みんなでワイワイざっくばらんに盛り上がる感じ</p></blockquote><h2 id="このチームを選んだ理由は？？"><a href="#このチームを選んだ理由は？？" class="headerlink" title="このチームを選んだ理由は？？"></a><em><strong>このチームを選んだ理由は？？</strong></em></h2><blockquote><p>Azure Autmation に興味を持ったため。</p></blockquote><blockquote><p>Monitoring では Azure の様々なサービスの監視を機能なので、Azure を総合的に学ぶのにはとてもいいポジションだと思いました。</p></blockquote><blockquote><p>ログを扱うという事でジャンル問わず様々な製品に関連した業務ができると思ったので。</p></blockquote><blockquote><p>Azure を Deep に身に着けるためです。</p></blockquote><blockquote><p>zabbix とか触っていてサーバー運用していたので、技術エリア的に近いと思ったので</p></blockquote><h2 id="～-ある日のチャットより-～"><a href="#～-ある日のチャットより-～" class="headerlink" title="～ ある日のチャットより ～"></a><em><strong>～ ある日のチャットより ～</strong></em></h2><p>Teams のチャットで困りごとや相談事項、雑談などみなそれぞれのペースで気楽にコミュニケーションとっています :-)<br><img src="/blog/general/OurTeamAtmosphere/chat.png"></p><h2 id="チーム-メンバーの技術志向エリア"><a href="#チーム-メンバーの技術志向エリア" class="headerlink" title="チーム メンバーの技術志向エリア"></a><em><strong>チーム メンバーの技術志向エリア</strong></em></h2><p>どんな Tech が好きか、チーム メンバーに聞いてみました！みんないろんな方向性に興味のベクトルがある感じです☆<br><img src="/blog/general/OurTeamAtmosphere/techarea.png"></p><!--> プログラミング。サービス、技術の動作原理を調べること。> マイコン大好き> 基本的にコンピューターを使うような技術は好き。 Azure のアーキテクチャーを紐解いていくことも好き。> 前職では Kotlin にハマってました。> 歯車が動くような、メカニックなゴツゴツした機械が動くようなハードよりの技術が好きです。 動画認識の技術に注目しています。（手話解析につながりそう）> 仮想化> Azure のサービスではアプリケーションの実装により近い Application Insights や App Service 他は PowerShell や shell などのコマンドライン操作をより快適にする記述方法やツールの使用方法> 自動化できる技術なら何でも好きです。> スクリプトのコーディング　ネットワーク関連のトラシュー--><h2 id="関連記事"><a href="#関連記事" class="headerlink" title="関連記事"></a>関連記事</h2><p>Azure Monitoring &amp; Integration チームの紹介記事は第 1 弾から第 5 弾まで公開しています。<br>以下のリンクから、その他の記事も是非一緒にご覧ください！</p><ul><li><a href="https://jpazmon-integ.github.io/blog/general/AboutMonandIntg/">&lt;第 1 弾&gt; Azure Monitoring &amp; Integration チームについて</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/HowWeWorkRemotely/">&lt;第 2 弾&gt; Azure Monitoring &amp; Integration チームについて リモート ワークでの働き方</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/OurTeamAtmosphere/">&lt;第 3 弾&gt; Azure Monitoring &amp; Integration チームのようす、雰囲気について</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/TeamIntroductionfromInternship/">&lt;第 4 弾&gt; インターン生から見た Azure Monitoring &amp; Integration チーム</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/JoinUs/">&lt;第 5 弾&gt; Azure Monitoring &amp; Integration チームについて～一緒に働く仲間を募集しています～</a></li></ul><p>以上、Monitoring &amp; Integration チーム紹介 Blog の第 3 弾でした！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは！Azure Monitoring &amp;amp; Integration チームの猪股です。&lt;br&gt;現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です！！&lt;br&gt;今日は、私たちのチームの普段のようすや雰囲気について紹介いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="General" scheme="https://jpazmon-integ.github.io/blog/tags/General/"/>
    
    <category term="チーム紹介" scheme="https://jpazmon-integ.github.io/blog/tags/%E3%83%81%E3%83%BC%E3%83%A0%E7%B4%B9%E4%BB%8B/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 2 弾&gt; Azure Monitoring &amp; Integration チームについて ~リモート ワークでの働き方~</title>
    <link href="https://jpazmon-integ.github.io/blog/general/HowWeWorkRemotely/"/>
    <id>https://jpazmon-integ.github.io/blog/general/HowWeWorkRemotely/</id>
    <published>2021-08-24T10:30:00.000Z</published>
    <updated>2022-07-01T00:33:54.110Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！Azure Monitoring &amp; Integration チームの伊東です。<br>現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です！！<br>今日は、私たちのチームがどのように働いているのか、少しでも皆さんにイメージしていただき、興味をもっていただけるよう、普段の働き方や仕事環境について紹介いたします。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E4%BB%95%E4%BA%8B%E3%81%AE%E6%B5%81%E3%82%8C">仕事の流れ</a></li><li><a href="#%E3%83%87%E3%82%B9%E3%82%AF-%E3%83%84%E3%82%A2%E3%83%BC%EF%BC%81">デスク ツアー！</a></li><li><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88-%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E9%AD%85%E5%8A%9B">リモート ワークの魅力</a></li><li><a href="#%E4%BC%91%E6%86%A9%E6%99%82%E9%96%93%E3%81%AE%E9%81%8E%E3%81%94%E3%81%97%E6%96%B9%E3%80%81%E6%B0%97%E5%88%86%E8%BB%A2%E6%8F%9B%E3%81%AE%E6%96%B9%E6%B3%95">休憩時間の過ごし方、気分転換の方法</a></li></ul><h2 id="仕事の流れ"><a href="#仕事の流れ" class="headerlink" title="仕事の流れ"></a>仕事の流れ</h2><p>Microsoft のサポート エンジニアはお客様から起票いただいたサポート リクエストを通してお客様の抱える問題を解決するための技術支援を行います。<br>案件の受付からクローズまで基本的には担当するメンバーがオーナーシップを持って対応します。<br>基本的な案件対応の流れとしては、<strong>案件の受付 → 調査方針の決定 → 発生している問題の調査 → 回答、事象の解消を確認 → クローズ</strong>、です。<br>案件の受付から、概ね 14 日程度でクローズとなります。<br>各エンジニアは 10 ~ 20 件ほどの案件を担当として受け持ち、また同時並行で案件対応を進めていきます。</p><p>このように記載すると 1 つの案件を最初から最後まで自分ひとりで対応しなければいけないように感じるかもしれません。<br>しかし、実際には同じチームのメンバーや、その他の Azure サポート チームのメンバーと非常に密に連携しながら調査を進めています。<br>クラウド サービスでは、新しい機能の追加や機能の改修が日常的に行われており、もはや一人のスーパー エンジニアが何でも知っている、という時代ではなくなっています。<br>言い換えれば、新しい機能や未知の問題に直面したとき、あなたがその問題の第一人者です。<br>このような状況から、各案件でオーナーシップをとる担当者がいるものの、実際には色々なメンバーと支援をし合いながら調査を行っています。</p><p>次に、Monitoring &amp; Integration チームのサポート エンジニアのとある 1 日について紹介いたします！</p><h3 id="とある-1-日の流れ"><a href="#とある-1-日の流れ" class="headerlink" title="とある 1 日の流れ"></a>とある 1 日の流れ</h3><p><strong>9:00 - サポート窓口が開きます。</strong><br>業務を開始！まずはメール チェックし、今日一日のタスクの洗い出し。</p><hr><p><strong>9:30 - チームの朝会に参加します！</strong><br>チーム全体への共有事項の展開や、サポート案件対応で困ったポイントを相談します。</p><hr><p><strong>10:00 - 新規案件対応。</strong><br>その日に新しくお問い合わせいただいた案件について、お客様へ電話をして対応方針をお客様と相談します。</p><hr><p><strong>12:00 - お昼休憩！</strong><br>家族と一緒にお昼ご飯を食べます！</p><hr><p><strong>13:00 - ミーティングに参加します！</strong><br>チーム ミーティングや他のサポート チームとのミーティングに参加し、打ち合わせを行います。</p><hr><p><strong>14:00 - 案件調査を行います。</strong><br>気合を入れて、時間のかかる調査 (ログの解析、再現テスト) を行います。</p><hr><p><strong>15:00 - Coffee Break ミーティングに参加。</strong><br>Coffee Break ミーティングでは、業務に関連のない雑談もしてリフレッシュ！<br>また、定期的に各メンバーが自己紹介プレゼンを行います。メンバーの新たな一面を知れて、コミュニケーションを取るきっかけになり案件対応の相談もしやすくなっているように感じます！</p><hr><p><strong>15:30 - 調査を再開します！</strong><br>サポート窓口が閉まる 17:30 までにお客様へ調査結果を報告できるようラスト スパート！</p><hr><p><strong>17:30 - サポート窓口が閉まります。</strong><br>気が済むまで、翌日報告予定の案件の調査や、他メンバーの案件の内容を勉強します。</p><h2 id="デスク-ツアー！"><a href="#デスク-ツアー！" class="headerlink" title="デスク ツアー！"></a>デスク ツアー！</h2><p>Monitoring &amp; Integration チームのメンバーのデスクの様子をご紹介いたします！<br>実際のメンバーのデスクですので、こちらからメンバーがどのような環境で働いているのか参考になれば嬉しいです！</p><ul><li><p><em>こだわりのキーボードや椅子に囲まれて業務効率 UP！</em><br><img src="/blog/general/HowWeWorkRemotely/Desk_Kitayama-san.png"></p></li><li><p><em>Simple is the best!</em><br><img src="/blog/general/HowWeWorkRemotely/Desk_Ito.png"></p></li><li><p><em>女優ライトでオンライン ミーティングも完璧！</em><br><img src="/blog/general/HowWeWorkRemotely/Desk_Hori-san.png"></p></li><li><p><em>おしゃれ &amp; 実用性のデスク！</em><br><img src="/blog/general/HowWeWorkRemotely/Desk_Kisara-san.png"></p></li><li><p><em>こだわりの自作 PC で重い作業もサクサク、快適に作業！</em><br><img src="/blog/general/HowWeWorkRemotely/Desk_Inomata-san.png"></p></li></ul><h2 id="リモート-ワークの魅力"><a href="#リモート-ワークの魅力" class="headerlink" title="リモート ワークの魅力"></a>リモート ワークの魅力</h2><p>現在、Monitoring &amp; Integration チームでは、リモート ワーク中心で業務を行っています！<br>実際にメンバーが感じているリモート ワークの魅力がこちらです！</p><ul><li>自分の時間が取りやすい (通勤なし、すぐ家族に会える) のは非常に良いポイント。</li><li>家からでも仕事が出来ました。整えるまで最初は大変ですが、一度環境を作ってしまえば大丈夫。</li><li>家族との時間が格段に増える。</li><li>出勤時間が 0 になるので、自由時間が増える。</li><li>自由なタイミングで休憩時間をとって、役所行ったり子供の面倒を見たり出来る。</li><li>通勤時間がなくなるので、その分を有意義に使えます。</li><li>自分の集中できるときに、集中できる場所で行うことができるなどある程度の自由さ。</li><li>宅配の荷物が受け取れる。</li><li>入社してからずっとフル リモート ワークですが、自分の環境でゆったり仕事できるので効率的。</li></ul><h2 id="休憩時間の過ごし方、気分転換の方法"><a href="#休憩時間の過ごし方、気分転換の方法" class="headerlink" title="休憩時間の過ごし方、気分転換の方法"></a>休憩時間の過ごし方、気分転換の方法</h2><p>このようなリモート ワークの魅力がある一方、運動不足やちょっとした雑談ができないストレスもあります。<br>このようなストレスに対して、休憩時間を使ってどのように対応、気分転換をしているかについてもメンバーに聞いてみました！</p><ul><li>コーヒーを入れる。</li><li>(すぐそこにいる) 子供に会いに行く。</li><li>チーム メンバーにくだらないチャットを投げかけて雑談する</li><li>時々部屋の外に出て猫を揉みに行きます。</li><li>ガムをかむ、目薬をさす、エナジー ドリンクを飲む、チョコレートを食べる、独り言を言う、歌を歌う。</li><li>顔を洗う、歯を磨く、手を洗う、髪の毛を櫛でとく。</li><li>音楽、漫画。</li><li>ゲームをしたり、メンバーとチャットや通話します。</li><li>作曲します。業後にお酒も飲みます。</li><li>寝る！！ あと筋トレ、散歩、おいしいもの食べる。</li></ul><h2 id="関連記事"><a href="#関連記事" class="headerlink" title="関連記事"></a>関連記事</h2><p>Azure Monitoring &amp; Integration チームの紹介記事は第 1 弾から第 5 弾まで公開しています。<br>以下のリンクから、その他の記事も是非一緒にご覧ください！</p><ul><li><a href="https://jpazmon-integ.github.io/blog/general/AboutMonandIntg/">&lt;第 1 弾&gt; Azure Monitoring &amp; Integration チームについて</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/HowWeWorkRemotely/">&lt;第 2 弾&gt; Azure Monitoring &amp; Integration チームについて リモート ワークでの働き方</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/OurTeamAtmosphere/">&lt;第 3 弾&gt; Azure Monitoring &amp; Integration チームのようす、雰囲気について</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/TeamIntroductionfromInternship/">&lt;第 4 弾&gt; インターン生から見た Azure Monitoring &amp; Integration チーム</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/JoinUs/">&lt;第 5 弾&gt; Azure Monitoring &amp; Integration チームについて～一緒に働く仲間を募集しています～</a></li></ul><p>以上、Monitoring &amp; Integration チーム紹介 Blog の第二弾でした！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは！Azure Monitoring &amp;amp; Integration チームの伊東です。&lt;br&gt;現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です！！&lt;br&gt;今日は、私たちのチームがどのように働いているのか、少しでも皆さんにイメージしていただき、興味をもっていただけるよう、普段の働き方や仕事環境について紹介いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="General" scheme="https://jpazmon-integ.github.io/blog/tags/General/"/>
    
    <category term="チーム紹介" scheme="https://jpazmon-integ.github.io/blog/tags/%E3%83%81%E3%83%BC%E3%83%A0%E7%B4%B9%E4%BB%8B/"/>
    
  </entry>
  
  <entry>
    <title>&quot;The pipeline was not run because a pipeline is already running&quot; エラー発生時の対処方法</title>
    <link href="https://jpazmon-integ.github.io/blog/automation/ThePipelineWasNotRunBecauseAPipelineIsAlreadyRunningError/"/>
    <id>https://jpazmon-integ.github.io/blog/automation/ThePipelineWasNotRunBecauseAPipelineIsAlreadyRunningError/</id>
    <published>2021-08-23T03:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.110Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring &amp; Integration サポート チームの趙です。<br>本日は、Azure Automation の Runbook 実行時、”The pipeline was not run because a pipeline is already running” のエラーでジョブが失敗する場合の対処方法をご紹介していきます。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li>事象<ul><li>この事象はどういう事象ですか？</li><li> このエラーはいつ発生しますか？</li></ul></li><li>原因<ul><li>Automation ジョブの動作</li><li>図解</li></ul></li><li>対策<ul><li>1.処理 (例えば、起動する VM) ごとに、 Automation アカウントを分ける</li><li>2.スケジュールの時間を数分ずらして実行する</li><li>3.Start/Stop VMs during off-hours ソリューションを利用する</li></ul></li></ul><h2 id="事象"><a href="#事象" class="headerlink" title="事象"></a>事象</h2><h3 id="この事象はどういう事象ですか？"><a href="#この事象はどういう事象ですか？" class="headerlink" title="この事象はどういう事象ですか？"></a>この事象はどういう事象ですか？</h3><p>以下エラーで、ジョブが失敗する事象です。</p><pre><code>  The pipeline was not run because a pipeline is already running. Pipelines cannot be run concurrently.</code></pre><h3 id="このエラーはいつ発生しますか？"><a href="#このエラーはいつ発生しますか？" class="headerlink" title="このエラーはいつ発生しますか？"></a>このエラーはいつ発生しますか？</h3><p><strong>同時に複数のジョブを実行</strong>する際に、タイミングによっては、当該エラーが表示され、ジョブが失敗する場合がございます。<br>特にグラフィック Runbook <strong>Start Azure V2 VMs</strong>、<strong>Stop Azure V2 VMs</strong> を利用しているお客様から当該エラーのお問い合わせを複数いただいております。<br>こちらの Runbook をご利用されている方は、後述する対策をご検討いただけますと幸いです。  </p><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>以下 Automation ジョブの動作により、発生する事象です。</p><h3 id="Automation-ジョブの動作"><a href="#Automation-ジョブの動作" class="headerlink" title="Automation ジョブの動作"></a>Automation ジョブの動作</h3><p>Automation では、Runbook を実行すると、 Azure 実行基盤上にワーカーというプロセスが作成されます。<br>このワーカーに Runbook のジョブが割り当てられ (ジョブ 1 : ワーカー 1) 、実行されます。<br>一方で、Runbook による複数のジョブが同一のワーカーにて (ジョブ N : ワーカー 1) 実行されてしまう場合があります。<br>このため、タイミングによっては、該当のエラー メッセージが表示され、ジョブが失敗することがございます。  </p><div class="alert is-info"><p class="alert-title">Note</p><p>お客様から、この動作が修正される予定があるかとのお問い合わせを複数いただいておりますが、</p><p>こちらの動作は、より多くのお客様が Automation サービスをご利用できるように</p><p>Azure 実行基盤上のリソースを効率良く割り当てるための仕組みであり、</p><p>今後、修正される見込みはないこと、ご了承いただければ幸いです。</p></div><div class="alert is-success"><p class="alert-title">ヒント</p><p>Azure Automation の実行基盤は、サンドボックス環境とも呼ばれます。</p><p>サンドボックス環境の実態は、弊社データセンターにあるサーバー インスタンスでございます。</p><p>Automation でジョブが実行されると、このジョブは、弊社データ センターにあるサーバー インスタンス上で、実行されます。</p><p>詳しくは、<a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-runbook-execution#runbook-execution-environment">Runbook の実行環境</a> をご参考いただければ幸いです。</p></div><h3 id="図解"><a href="#図解" class="headerlink" title="図解"></a>図解</h3><p>図で表すと以下のようになります。</p><p><img src="/blog/automation/ThePipelineWasNotRunBecauseAPipelineIsAlreadyRunningError/pipeline2.png"></p><h2 id="対策"><a href="#対策" class="headerlink" title="対策"></a>対策</h2><p>以下 3 つの対策の中でいずれかの対策のご利用をご検討いただけますと幸いです。</p><ol><li>処理 (例えば、起動する VM) ごとに、 Automation アカウントを分ける</li><li>スケジュールの時間を数分ずらして実行する</li><li>Start/Stop VMs during off-hours ソリューションを利用する</li></ol><h3 id="1-処理-例えば、起動する-VM-ごとに、-Automation-アカウントを分ける"><a href="#1-処理-例えば、起動する-VM-ごとに、-Automation-アカウントを分ける" class="headerlink" title="1. 処理 (例えば、起動する VM) ごとに、 Automation アカウントを分ける"></a>1. 処理 (例えば、起動する VM) ごとに、 Automation アカウントを分ける</h3><p>ジョブを実行した Automation アカウントが同一の場合にのみ、<br>Runbook のジョブを実行するワーカーが重複する可能性があります。<br>回避策として、Runbook で実現する処理ごとに、Automation アカウントを分ける対応をご検討いただければ幸いです。</p><p>例えば、VM を起動する Runbook にて、当該エラーが発生した場合、<br>以下例のように VM ごとに Automation アカウントを分けて Runbook を実行する案をご検討いただけますと幸いです。 </p><p>例)</p><table><thead><tr><th>対象 VM</th><th>Automation アカウント</th></tr></thead><tbody><tr><td>VM01</td><td>AutomationAccount-A</td></tr><tr><td>VM02</td><td>AutomationAccount-B</td></tr><tr><td>VM03</td><td>AutomationAccount-C</td></tr><tr><td>VM04</td><td>AutomationAccount-D</td></tr></tbody></table><h3 id="2-スケジュールの時間を数分ずらして実行する"><a href="#2-スケジュールの時間を数分ずらして実行する" class="headerlink" title="2. スケジュールの時間を数分ずらして実行する"></a>2. スケジュールの時間を数分ずらして実行する</h3><p>同時に複数のジョブを実行する場合、<br>Runbook のジョブを実行するワーカーが重複する可能性があります。<br>回避策として、ジョブの同時実行を回避する対応をご検討いただければ幸いです。  </p><p>例えば、VM を起動する Runbook にて、当該エラーが発生した場合、<br>以下例のようにスケジュールの時間をずらして、VM を起動する案をご検討いただけますと幸いです。<br>ジョブの間隔を 2 ~ 3 分程度、空けていただくことを目安と設定いただければ幸いです。</p><p>例)</p><table><thead><tr><th>対象 VM</th><th>ジョブを実行する時刻 (スケジュール)</th><th>Automation アカウント</th></tr></thead><tbody><tr><td>VM01</td><td>2021-08-20 08:00</td><td>AutomationAccount-A</td></tr><tr><td>VM02</td><td>2021-08-20 08:02</td><td>AutomationAccount-A</td></tr><tr><td>VM03</td><td>2021-08-20 08:05</td><td>AutomationAccount-A</td></tr><tr><td>VM04</td><td>2021-08-20 08:07</td><td>AutomationAccount-A</td></tr></tbody></table><h3 id="3-Start-Stop-VMs-during-off-hours-ソリューションを利用する"><a href="#3-Start-Stop-VMs-during-off-hours-ソリューションを利用する" class="headerlink" title="3. Start/Stop VMs during off-hours ソリューションを利用する"></a>3. Start/Stop VMs during off-hours ソリューションを利用する</h3><p>Runbook で VM 起動・停止時に事象が発生する場合は、こちらの策をご検討いただければ幸いです。<br><a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-solution-vm-management">Start/Stop VMs during off-hours ソリューション</a>では、上記のような動作 (一つのワーカーに複数のジョブがアサインされる動作) が回避できる仕組みがスクリプト レベルで実装されております。<br>なお、Start/Stop VMs during off-hours ソリューションをご利用いただくことで、VM の開始および停止をスケジュールで実行することができます。<br>回避策として、Start/Stop VMs during off-hours ソリューションを利用する案をご検討いただければ幸いです。</p><div class="alert is-info"><p class="alert-title">Note</p><p>Runbook <strong>Start Azure V2 VMs</strong> と <strong>Stop Azure V2 VMs</strong> は、グラフィカル Runbook の<a href="https://docs.microsoft.com/ja-jp/azure/automation/learn/automation-tutorial-runbook-graphical">チュートリアル用の Runbook</a> です。</p><p>なお、2016 年に作成された以降、更新されていない Runbook です。</p><p>また、<a href="https://docs.microsoft.com/ja-jp/powershell/azure/new-azureps-module-az?view=azps-6.3.0#supportability">2024 年 2 月 29 日にサポートが終了する AzureRM モジュール</a>を利用する Runbook です。</p><p>そのため、弊社としては、お客様の VM 停止・起動の運用、ワークロードのために利用する Runbook として、Start/Stop VMs during off-hours ソリューションの Runbook のご利用を推奨します。</p><p><img src="/blog/automation/ThePipelineWasNotRunBecauseAPipelineIsAlreadyRunningError/startazurev2vmsstopazurev2vms.png"></p></div><div class="alert is-info"><p class="alert-title">Note</p><p><a href="https://docs.microsoft.com/ja-jp/azure/automation/automation-solution-vm-management">Start/Stop VMs during off-hours ソリューション v1</a>は、2022 年 5 月 21 日に非推奨となる予定です。</p><p>そのため、長期的な観点では、<a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/start-stop-vms/overview">Start/Stop VMs during off-hours ソリューション v2</a> のご利用をご検討いただけますと幸いです。</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring &amp;amp; Integration サポート チームの趙です。&lt;br&gt;本日は、Azure Automation の Runbook 実行時、”The pipeline was not run because a pipeline is already running” のエラーでジョブが失敗する場合の対処方法をご紹介していきます。&lt;/p&gt;</summary>
    
    
    
    
    <category term="FAQ" scheme="https://jpazmon-integ.github.io/blog/tags/FAQ/"/>
    
    <category term="Troubleshooting" scheme="https://jpazmon-integ.github.io/blog/tags/Troubleshooting/"/>
    
    <category term="Automation" scheme="https://jpazmon-integ.github.io/blog/tags/Automation/"/>
    
    <category term="Job" scheme="https://jpazmon-integ.github.io/blog/tags/Job/"/>
    
    <category term="Worker" scheme="https://jpazmon-integ.github.io/blog/tags/Worker/"/>
    
    <category term="StartAzureV2VMs" scheme="https://jpazmon-integ.github.io/blog/tags/StartAzureV2VMs/"/>
    
    <category term="StopAzureV2VMs" scheme="https://jpazmon-integ.github.io/blog/tags/StopAzureV2VMs/"/>
    
    <category term="Sandbox" scheme="https://jpazmon-integ.github.io/blog/tags/Sandbox/"/>
    
  </entry>
  
  <entry>
    <title>&lt;第 1 弾&gt; Azure Monitoring &amp; Integration チームについて</title>
    <link href="https://jpazmon-integ.github.io/blog/general/AboutMonandIntg/"/>
    <id>https://jpazmon-integ.github.io/blog/general/AboutMonandIntg/</id>
    <published>2021-08-17T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.110Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！Azure Monitoring &amp; Integration チームの猪股です。<br>現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です!!<br>今日は、私たちのチームが普段 Azure のどのような製品を担当しているのかについて、簡単にご案内いたします。</p><h3 id="Azure-Monitoring-amp-Integration-チームについて"><a href="#Azure-Monitoring-amp-Integration-チームについて" class="headerlink" title="Azure Monitoring &amp; Integration チームについて"></a>Azure Monitoring &amp; Integration チームについて</h3><p>Azure Automation, Azure Monitor (Application Insights, Log Analytics), Azure Logic Apps の各製品の技術サポートをしているチームです。<br>現在は完全にフルリモートで各自家から仕事 (WfH, work from home と呼んでいます) しています。</p><ul><li><p>Azure Automation<br><a href="https://docs.microsoft.com/ja-jp/azure/automation/">https://docs.microsoft.com/ja-jp/azure/automation/</a></p></li><li><p>Azure Monitor<br><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/">https://docs.microsoft.com/ja-jp/azure/azure-monitor/</a></p></li><li><p>Azure Logic Apps<br><a href="https://docs.microsoft.com/ja-jp/azure/logic-apps/">https://docs.microsoft.com/ja-jp/azure/logic-apps/</a></p></li></ul><h3 id="Azure-Automation-ってどんな製品？"><a href="#Azure-Automation-ってどんな製品？" class="headerlink" title="Azure Automation ってどんな製品？"></a>Azure Automation ってどんな製品？</h3><p>PowerShell や Python スクリプトで定義された処理を自動実行させる Runbook、Azure やオンプレミス環境、その他のクラウド環境で、Azure での Windows と Linux VM に対する OS の更新プログラムを管理する Update Mangement、PowerShell Desired State Configuration (DSC) の構成を記述、管理、およびコンパイルできる Azure Automation State Configuration など、クラウド環境の自動化に必要な様々な機能を提供しています。<br><IMG  src="https://docs.microsoft.com/ja-jp/azure/automation/media/automation-runbook-execution/job-statuses.png"  alt="ジョブの状態 - PowerShell Workflow"/></p><h3 id="Azure-Monitor-ってどんな製品？"><a href="#Azure-Monitor-ってどんな製品？" class="headerlink" title="Azure Monitor ってどんな製品？"></a>Azure Monitor ってどんな製品？</h3><p>収集された各種ログ データを Kusto と呼ばれるクエリ言語を使って解析したり、そのクエリを利用してアラートを発報させたりする Log Analytics や、実行中のアプリケーションのパフォーマンスや使用状況を把握したり、監視する Application Insights、VM や AKS 等コンテナー関連の監視機能を提供する VM insights 及び Container insights、Azure Monitor メトリックを使ったデータ収集やアラート作成などなど、非常にバリエーションに富んだ、Azure の監視に必要な機能を提供しています。<br><IMG  src="https://docs.microsoft.com/en-us/azure/azure-monitor/media/overview/overview.png"  alt="Azure Monitor overview"/></p><h3 id="Azure-Logic-Apps-ってどんな製品？"><a href="#Azure-Logic-Apps-ってどんな製品？" class="headerlink" title="Azure Logic Apps ってどんな製品？"></a>Azure Logic Apps ってどんな製品？</h3><p>Logic Apps とは、ビジネス プロセスの実行を自動化するクラウド サービスです。<br>Microsoft が管理するあらかじめ構築された 400 を超える API コネクタと組み込み操作が提供されており、クラウド、オンプレミス、ハイブリッド環境で、レガシ、最新、および最先端システムをより簡単に接続できます。</p><p><img src="https://user-images.githubusercontent.com/76590599/129905624-ca545c60-569b-4e8b-8d0b-58f0d9902c7f.png" alt="Azure Logic Apps overview"></p><p>グラフィカル デザイン ツールを使って、ノンコーディングに必要なものを自由に組み合わせることができるため、さまざまなサービスを簡単に結合してワークフローを実装できる強みがあります。<br><img src="https://user-images.githubusercontent.com/76590599/129907012-eb7c9e68-7f15-4448-936c-a3253a459a7e.png" alt="Azure Logic Apps イメージ図"></p><h3 id="関連記事"><a href="#関連記事" class="headerlink" title="関連記事"></a>関連記事</h3><p>Azure Monitoring &amp; Integration チームの紹介記事は第 1 弾から第 5 弾まで公開しています。<br>以下のリンクから、その他の記事も是非一緒にご覧ください！</p><ul><li><a href="https://jpazmon-integ.github.io/blog/general/AboutMonandIntg/">&lt;第 1 弾&gt; Azure Monitoring &amp; Integration チームについて</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/HowWeWorkRemotely/">&lt;第 2 弾&gt; Azure Monitoring &amp; Integration チームについて リモート ワークでの働き方</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/OurTeamAtmosphere/">&lt;第 3 弾&gt; Azure Monitoring &amp; Integration チームのようす、雰囲気について</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/TeamIntroductionfromInternship/">&lt;第 4 弾&gt; インターン生から見た Azure Monitoring &amp; Integration チーム</a></li><li><a href="https://jpazmon-integ.github.io/blog/general/JoinUs/">&lt;第 5 弾&gt; Azure Monitoring &amp; Integration チームについて～一緒に働く仲間を募集しています～</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは！Azure Monitoring &amp;amp; Integration チームの猪股です。&lt;br&gt;現在わたしたちのチームでは、一緒に Azure サポートを盛り上げていってくださるメンバーを絶賛大募集中です!!&lt;br&gt;今日は、私たちのチームが普段 Azure のど</summary>
      
    
    
    
    
    <category term="General" scheme="https://jpazmon-integ.github.io/blog/tags/General/"/>
    
    <category term="チーム紹介" scheme="https://jpazmon-integ.github.io/blog/tags/%E3%83%81%E3%83%BC%E3%83%A0%E7%B4%B9%E4%BB%8B/"/>
    
  </entry>
  
  <entry>
    <title>サービス正常性アラートの設定手順と推奨設定について</title>
    <link href="https://jpazmon-integ.github.io/blog/ame/HowToSetUpServiceHealthAlertsAndRecommendedSettings/"/>
    <id>https://jpazmon-integ.github.io/blog/ame/HowToSetUpServiceHealthAlertsAndRecommendedSettings/</id>
    <published>2021-07-30T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.094Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring &amp; Integration サポート チームの堀です。<br>今回はサービス正常性アラートの設定手順と推奨設定についてご案内いたします。</p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li>サービスの正常性アラートの概要</li><li>サービス正常性アラートの設定手順</li><li>サービス正常性アラートの推奨設定</li></ul><h2 id="サービスの正常性アラートの概要"><a href="#サービスの正常性アラートの概要" class="headerlink" title="サービスの正常性アラートの概要"></a>サービスの正常性アラートの概要</h2><p>サービス正常性アラートでは、お客様環境にてご利用いただいている Azure サービスおよびリージョンを監視対象とし、Azure サービス自体の正常性を監視することが可能です。Azure サービスの障害や、計画メンテナンスの情報を監視でき、イベントが発生した際に、メールや SMS 等の方法で管理者にアラート通知できます。</p><p>サービス正常性アラートにて検知できるイベントの詳細は、下記弊社公開情報をご覧ください。<br>– Service Health の概要<br><a href="https://docs.microsoft.com/ja-jp/azure/service-health/service-health-overview#service-health-events">https://docs.microsoft.com/ja-jp/azure/service-health/service-health-overview#service-health-events</a><br>※ [Service Health のイベント] をご覧ください。</p><h2 id="サービス正常性アラートの設定手順"><a href="#サービス正常性アラートの設定手順" class="headerlink" title="サービス正常性アラートの設定手順"></a>サービス正常性アラートの設定手順</h2><p>以下に、Azure ポータルよりサービス正常性アラートを設定する方法をご案内いたします。</p><ol><li>Azureポータルにログインします。 </li><li>すべてのサービスから [サービス正常性] を開きます。</li><li>左ウィンドウの [アラート] - [正常性アラート] のブレードを開きます。<br><img src="/blog/ame/HowToSetUpServiceHealthAlertsAndRecommendedSettings/Step3.png" alt="Step3"></li><li>画面上部の [サービス正常性アラートの追加] をクリックします。<br><img src="/blog/ame/HowToSetUpServiceHealthAlertsAndRecommendedSettings/Step4.png" alt="Step4"></li><li>[アラート ルールの作成] より、アラートの対象となる [サブスクリプション] 、 [サービス] 、 [リージョン] を選択します。</li><li>監視対象の [イベントの種類] を選択します。</li><li>[アクション グループ] の [アクション グループの選択] をクリックします。任意のアクション グループを指定します。</li><li>[アラートの詳細] より [アラート ルール名] と [説明] を入力します。</li><li>[リソース グループにアラートを保存します] よりアラート ルールを作成する [リソース グループ] を選択します。</li><li>[アラート ルールの作成] をクリックします。 </li></ol><p>手順は以上です。  </p><p>手順の詳細は、下記弊社公開情報をご覧ください。<br>– Azure portal を使用してサービスの通知でアクティビティ ログ アラートを作成する<br><a href="https://docs.microsoft.com/ja-jp/azure/service-health/alerts-activity-log-service-notifications#alert-and-new-action-group-using-azure-portal">https://docs.microsoft.com/ja-jp/azure/service-health/alerts-activity-log-service-notifications#alert-and-new-action-group-using-azure-portal</a></p><h2 id="サービス正常性アラートの推奨設定"><a href="#サービス正常性アラートの推奨設定" class="headerlink" title="サービス正常性アラートの推奨設定"></a>サービス正常性アラートの推奨設定</h2><p>サービス正常性アラート設定時の “サービス” や “リージョン” はすべて選択いただくことを推奨しております。<br>サービス正常性アラートは、ご利用いただいているサービスのご利用いただいているリージョンを対象としたイベントが発生した場合にのみ通知が行われる仕組みです。<br>このため、サブスクリプション上のすべてのサービス、リージョンおよびイベントの種類を選択した場合にも、利用していないリソースに対してアラートは発生いたしません。  </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring &amp;amp; Integration サポート チームの堀です。&lt;br&gt;今回はサービス正常性アラートの設定手順と推奨設定についてご案内いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="How-To" scheme="https://jpazmon-integ.github.io/blog/tags/How-To/"/>
    
    <category term="Tips" scheme="https://jpazmon-integ.github.io/blog/tags/Tips/"/>
    
    <category term="Azure Monitor Essentials" scheme="https://jpazmon-integ.github.io/blog/tags/Azure-Monitor-Essentials/"/>
    
  </entry>
  
  <entry>
    <title>Application Insights クラシック版とワークスペース版との違いについて</title>
    <link href="https://jpazmon-integ.github.io/blog/applicationInsights/aboutDifferentTypesOfAi/"/>
    <id>https://jpazmon-integ.github.io/blog/applicationInsights/aboutDifferentTypesOfAi/</id>
    <published>2021-07-19T15:00:00.000Z</published>
    <updated>2022-07-01T00:33:54.102Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Monitoring &amp; Integration サポート チームの北山です。<br>今回の記事では、Application Insights リソースのクラシック版とワークスペース版との違いについて説明します。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E7%9B%AE%E6%AC%A1">目次</a></li><li><a href="#%E3%83%86%E3%83%AC%E3%83%A1%E3%83%88%E3%83%AA-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BF%9D%E5%AD%98%E5%85%88%E3%81%8C%E7%95%B0%E3%81%AA%E3%82%8B">テレメトリ データの保存先が異なる</a><ul><li><a href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99">参考資料</a></li></ul></li><li><a href="#%E3%83%86%E3%83%AC%E3%83%A1%E3%83%88%E3%83%AA-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E6%96%B9%E6%B3%95%E3%81%8C%E7%95%B0%E3%81%AA%E3%82%8B">テレメトリ データのエクスポート方法が異なる</a><ul><li><a href="#%E9%80%A3%E7%B6%9A%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%B3%A8%E6%84%8F%E7%82%B9">連続エクスポートに関する注意点</a></li><li><a href="#%E8%A8%BA%E6%96%AD%E8%A8%AD%E5%AE%9A%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%B3%A8%E6%84%8F%E7%82%B9">診断設定に関する注意点</a><ul><li><a href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-1">参考資料</a></li></ul></li></ul></li><li><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E4%BF%9D%E6%9C%89%E6%9C%9F%E9%96%93%E3%81%AE%E8%A8%AD%E5%AE%9A%E5%A0%B4%E6%89%80%E3%81%8C%E7%95%B0%E3%81%AA%E3%82%8B">データ保有期間の設定場所が異なる</a></li><li><a href="#%E3%81%9D%E3%81%AE%E4%BB%96-%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%81%94%E8%B3%AA%E5%95%8F">その他 よくあるご質問</a><ul><li><a href="#q-1-%E6%96%99%E9%87%91%E3%81%AF%E5%A4%89%E3%82%8F%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B">Q 1 料金は変わりますか</a></li><li><a href="#q-2-%E3%83%AD%E3%82%B0-%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%88-%E3%83%AB%E3%83%BC%E3%83%AB%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%81%9F%E4%BB%8A%E3%81%BE%E3%81%A7%E3%81%AE%E3%82%AF%E3%82%A8%E3%83%AA%E3%81%AF%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B">Q 2 ログ アラート ルールで使用していた今までのクエリは使えなくなりますか</a></li><li><a href="#q-3-%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E3%82%AF%E3%83%A9%E3%82%B7%E3%83%83%E3%82%AF%E7%89%88%E3%81%8B%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E7%89%88%E3%81%8B%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B">Q 3 どうやってクラシック版かワークスペース版かを確認すればよいですか</a><ul><li><a href="#powershell-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88">PowerShell スクリプト</a></li><li><a href="#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C">実行結果</a></li></ul></li><li><a href="#q-4-%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E7%89%88%E3%81%B8%E7%A7%BB%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%A8%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B%E6%A9%9F%E8%83%BD%E3%81%AF%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B">Q 4 ワークスペース版へ移行すると、使えなくなる機能はありますか</a></li><li><a href="#q-5-%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E7%89%88%E3%81%B8%E3%81%AE%E7%A7%BB%E8%A1%8C%E4%BD%9C%E6%A5%AD%E4%B8%AD%E3%81%AF%E3%83%86%E3%83%AC%E3%83%A1%E3%83%88%E3%83%AA-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AF%E6%AC%A0%E8%90%BD%E3%81%97%E3%81%BE%E3%81%99%E3%81%8B">Q 5 ワークスペース版への移行作業中は、テレメトリ データは欠落しますか</a></li></ul></li></ul><h2 id="テレメトリ-データの保存先が異なる"><a href="#テレメトリ-データの保存先が異なる" class="headerlink" title="テレメトリ データの保存先が異なる"></a>テレメトリ データの保存先が異なる</h2><p>クラシック版 Application Insights リソースは、下図のようにテレメトリ データを独自のワークスペースに保存していました。  </p><p><img src="https://user-images.githubusercontent.com/25476639/126289964-fd294432-a722-43f7-91d2-670b2e4a2b1c.png"></p><p>しかしワークスペース版では、Log Analytics ワークスペースに対してテレメトリ データを保存しています。<br>そのため、ワークスペース版 Application Insights リソースを作成する場合は、必ず 1 つの Log Analytics ワークスペースも一緒に作成する必要があります。<br>(既存 Log Analytics ワークスペースを利用することも可能です)</p><p><img src="https://user-images.githubusercontent.com/25476639/126290035-ee93423f-8418-4722-88fd-ddc6692c5e90.png"></p><p>Log Analytics ワークスペースを利用する事で Log Analytics の機能が使えるようになる点が、ワークスペース版のメリットとなります。</p><ul><li>Log Analytics ワークスペースの容量予約レベルが使えるようになり、従量課金制と比べて最大 30 % のコストを抑えることが可能になります。</li><li>カスタマー マネージド キー (CMK) を使って、ユーザー独自の暗号化キーでデータを暗号化が行えます。</li><li>診断設定を用いて、ストレージ アカウントやイベント ハブへの転送可能となります。</li></ul><p>Log Analytics ワークスペースは、他 Azure サービスのリソース ログの分析や Azure VM や オンプレ環境コンピューターのログ分析、Azure Sentinel などでも利用されている、開発が活発なサービスです。<br>そのため、クラシック版では体験出来ないような新機能が、これからもご利用いただけます。<br>そのポイントが主なメリットであると思っています。</p><h4 id="参考資料"><a href="#参考資料" class="headerlink" title="参考資料"></a>参考資料</h4><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/create-workspace-resource#new-capabilities">ワークスペース版の新機能</a></li></ul><h2 id="テレメトリ-データのエクスポート方法が異なる"><a href="#テレメトリ-データのエクスポート方法が異なる" class="headerlink" title="テレメトリ データのエクスポート方法が異なる"></a>テレメトリ データのエクスポート方法が異なる</h2><p>クラシック版とワークスペース版と比較して、下記のような違いがあります。</p><table><thead><tr><th></th><th>クラシック版</th><th>ワークスペース版</th></tr></thead><tbody><tr><td>エクスポート方法</td><td>連続エクスポート</td><td>診断設定</td></tr><tr><td>ストレージ アカウントへのエクスポート</td><td>○</td><td>○</td></tr><tr><td>(別の) Log Analytics ワークスペースへのエクスポート</td><td></td><td>○</td></tr><tr><td>イベント ハブへのエクスポート</td><td></td><td>○</td></tr></tbody></table><p>クラシック版とワークスペース版と比較してエクスポート方法が異なります。<br>そのため、クラシック版からワークスペース版へ移行した場合は、連続エクスポートがご利用出来なくなります。<br>移行前には必ず連続エクスポートを機能を無効化していただき、移行後に診断設定を構築していただく必要があるため注意が必要です。</p><h3 id="連続エクスポートに関する注意点"><a href="#連続エクスポートに関する注意点" class="headerlink" title="連続エクスポートに関する注意点"></a>連続エクスポートに関する注意点</h3><p>現時点では連続エクスポートは非推奨となっております。<br>また、連続エクスポートに対応していないリージョンも存在するため、もしクラシック版で連続エクスポートをご利用いただく場合は、下記のドキュメントをご一読いただくようお願いしています。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/export-telemetry">Application Insights からのテレメトリのエクスポート</a></li></ul><h3 id="診断設定に関する注意点"><a href="#診断設定に関する注意点" class="headerlink" title="診断設定に関する注意点"></a>診断設定に関する注意点</h3><p>ワークスペース版 Application Insights リソースにて、診断設定を利用して他の Log Analytics ワークスペースへエクスポートした場合、当該 Application Insights リソースからログ検索すると<strong>二重でログが取得される</strong>現象が発生します。<br>(Application Insights リソースに紐付いている Log Analytics ワークスペースに格納されたログと、診断設定で指定した他の Log Analytics ワークスペースに格納されたログが取得される)  </p><p>現時点では仕様となっております。<br>そのため、予め注意していただけますと幸いです。</p><h4 id="参考資料-1"><a href="#参考資料-1" class="headerlink" title="参考資料"></a>参考資料</h4><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/export-telemetry">Application Insights からのテレメトリのエクスポート (連続エクスポート)</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/create-workspace-resource#export-telemetry">テレメトリのエクスポート (診断設定)</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/convert-classic-resource#continuous-export">ワークスペース版への移行の際の、連続エクスポートに関する注意点</a></li></ul><h2 id="データ保有期間の設定場所が異なる"><a href="#データ保有期間の設定場所が異なる" class="headerlink" title="データ保有期間の設定場所が異なる"></a>データ保有期間の設定場所が異なる</h2><p>前述のとおり、クラシック版とワークスペース版と比較するとデータ保存先が異なります。<br>データ保有期間は保存先に依存しておりますので、設定場所が異なる点注意が必要です。</p><p>クラシック版の場合は、下図のように Application Insights リソース ページからデータ保有期間の変更が可能です。</p><p><img src="https://user-images.githubusercontent.com/25476639/126421433-3e4872d9-f9b0-43cb-92a0-8a6650ca72b9.png"></p><p>一方でワークスペース版の場合は、Application Insights リソース ページからは変更出来ません。<br>Application Insights リソースに紐付いている Log Analytics ワークスペースにて変更する必要があります。</p><p><img src="https://user-images.githubusercontent.com/25476639/126421328-301f8c10-5039-432d-9fcc-22d148c22b0a.png"></p><h2 id="その他-よくあるご質問"><a href="#その他-よくあるご質問" class="headerlink" title="その他 よくあるご質問"></a>その他 よくあるご質問</h2><h3 id="Q-1-料金は変わりますか"><a href="#Q-1-料金は変わりますか" class="headerlink" title="Q 1 料金は変わりますか"></a>Q 1 料金は変わりますか</h3><p>料金は変わりません。<br>また、ワークスペース版の場合に、Application Insights リソースと Log Analytics ワークスペースとで 2 重に費用が発生するのでは? というご質問をよくいただきますが、2 重に費用が発生しませんのでご安心ください。</p><h3 id="Q-2-ログ-アラート-ルールで使用していた今までのクエリは使えなくなりますか"><a href="#Q-2-ログ-アラート-ルールで使用していた今までのクエリは使えなくなりますか" class="headerlink" title="Q 2 ログ アラート ルールで使用していた今までのクエリは使えなくなりますか"></a>Q 2 ログ アラート ルールで使用していた今までのクエリは使えなくなりますか</h3><p>ログベースのアラートについては、引き続き完全な下位互換性を提供します。<br>そのため、既存のログ アラート ルールに対してクエリの内容をご変更いただく必要はありません。</p><p>詳細は下記のドキュメントに記載があります。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/convert-classic-resource#understanding-log-queries">ログ クエリについて</a></li></ul><h3 id="Q-3-どうやってクラシック版かワークスペース版かを確認すればよいですか"><a href="#Q-3-どうやってクラシック版かワークスペース版かを確認すればよいですか" class="headerlink" title="Q 3 どうやってクラシック版かワークスペース版かを確認すればよいですか"></a>Q 3 どうやってクラシック版かワークスペース版かを確認すればよいですか</h3><p>Azure potal にて、当該 Application Insights リソース ページへ移動し、概要ページを参照していただければご確認いただけます。</p><p>下図のように Log Analytics ワークスペースのリンクが存在する場合は、ワークスペース版 Application Insights リソースです。</p><p><img src="https://user-images.githubusercontent.com/25476639/126263222-b890c59b-b672-4ff1-9c1e-4e25e1820c4a.png"></p><p>下図のようにワークスペースのリンクがない場合は、クラシック版 Application Insights リソースです。</p><p><img src="https://user-images.githubusercontent.com/25476639/126263264-379cafa3-9ea1-49f5-8e4c-efdf20812b45.png"></p><p>大量に Application Insights リソースが存在して Azure potal から確認するのが大変な場合は、下記のような PowerShell スクリプトを実行いただく事でまとめて確認することが可能です。</p><h4 id="PowerShell-スクリプト"><a href="#PowerShell-スクリプト" class="headerlink" title="PowerShell スクリプト"></a>PowerShell スクリプト</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Connect-AzAccount</span><br><span class="line">Set-AzContext -SubscriptionID &quot;サブスクリプションID&quot;</span><br><span class="line"></span><br><span class="line">$Sub = (Get-AzContext).Subscription.Id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$Token = (Get-AzAccessToken).Token</span><br><span class="line">$AuthHeader = &quot;Bearer &quot; + $Token</span><br><span class="line">$ReqHeader = @&#123;&quot;Authorization&quot; = $AuthHeader; &quot;Accept&quot; = &quot;application/json&quot;&#125;</span><br><span class="line">$ContType = &quot;application/json&quot;</span><br><span class="line"></span><br><span class="line">$AIs = Get-AzApplicationInsights</span><br><span class="line">foreach($AI in $AIs)&#123;</span><br><span class="line"> $AIName = $AI.Name</span><br><span class="line"> $AIRG = $AI.ResourceGroupName</span><br><span class="line"> $Uri = &quot;https://management.azure.com/subscriptions/&quot; + $Sub + &quot;/resourcegroups/&quot; + $AIRG + &quot;/providers/microsoft.insights/components/&quot; + $AIName + &quot;?api-version=2018-05-01-preview&quot;</span><br><span class="line"> $ReqResult = Invoke-WebRequest -Uri $Uri -Headers $ReqHeader -Method GET -ContentType $ContType</span><br><span class="line"> $Cont = $ReqResult.Content | ConvertFrom-Json</span><br><span class="line"> $Workspace = $Cont.properties.WorkspaceResourceId</span><br><span class="line"> Write-Output(&quot;`nAI Name:&quot; + $AI.Name)</span><br><span class="line"> Write-Output(&quot;Workspace Id:&quot; + $Workspace)</span><br><span class="line"> $Workspace = $null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="実行結果"><a href="#実行結果" class="headerlink" title="実行結果"></a>実行結果</h4><p>Workspace Id: に Log Analytics ワークスペースのリソース ID が記述されている場合は、ワークスペース版 Application Insights リソースとなります。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">AI Name:dasasaki-appservice-aspnet48-ampls</span><br><span class="line">Workspace Id:/subscriptions/11b4afdb-3329-42f2-b8dc-b26c5ac19146/resourcegroups/defaultresourcegroup-ejp/providers/microsoft.operationalinsights/workspaces/defaultworkspace-11b4afdb-3329-42f2-b8dc-b26c5ac19146-ejp</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-sparkapp</span><br><span class="line">Workspace Id:</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-csnetcore31</span><br><span class="line">Workspace Id:</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-wsai-jpeast</span><br><span class="line">Workspace Id:/subscriptions/11b4afdb-3329-42f2-b8dc-b26c5ac19146/resourcegroups/dasasaki_rg/providers/microsoft.operationalinsights/workspaces/dasasaki-test</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-aiws-jpeast2</span><br><span class="line">Workspace Id:/subscriptions/11b4afdb-3329-42f2-b8dc-b26c5ac19146/resourcegroups/dasasaki_rg/providers/microsoft.operationalinsights/workspaces/dasasaki-ws-jpeast</span><br><span class="line"></span><br><span class="line">AI Name:dasaski-nodejs14-basic-auth</span><br><span class="line">Workspace Id:</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-appservice-aspnet48-ampls-linux</span><br><span class="line">Workspace Id:/subscriptions/11b4afdb-3329-42f2-b8dc-b26c5ac19146/resourcegroups/defaultresourcegroup-ejp/providers/microsoft.operationalinsights/workspaces/defaultworkspace-11b4afdb-3329-42f2-b8dc-b26c5ac19146-ejp</span><br><span class="line"></span><br><span class="line">AI Name:dasasaki-netsdk</span><br><span class="line">Workspace Id:</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="Q-4-ワークスペース版へ移行すると、使えなくなる機能はありますか"><a href="#Q-4-ワークスペース版へ移行すると、使えなくなる機能はありますか" class="headerlink" title="Q 4 ワークスペース版へ移行すると、使えなくなる機能はありますか"></a>Q 4 ワークスペース版へ移行すると、使えなくなる機能はありますか</h3><p>連続エクスポートがご利用いただけなくなります。<br>連続エクスポートの代わりに、診断設定を用いてストレージ アカウントへテレメトリ データを転送する事になる点、ご留意願います。</p><p>アプリケーション マップや可用性テスト、トランザクションの検索などといったそれ以外の機能に関しましては、問題なくご利用いただけますのでご安心ください。</p><h3 id="Q-5-ワークスペース版への移行作業中は、テレメトリ-データは欠落しますか"><a href="#Q-5-ワークスペース版への移行作業中は、テレメトリ-データは欠落しますか" class="headerlink" title="Q 5 ワークスペース版への移行作業中は、テレメトリ データは欠落しますか"></a>Q 5 ワークスペース版への移行作業中は、テレメトリ データは欠落しますか</h3><p>テレメトリ データは欠落しませんので、ご安心して移行作業を実施してください。<br>ただし、その他に注意点がございますので、移行作業は必ず下記のドキュメントを読みながら実施してください。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/app/convert-classic-resource">ワークスペースベースの Application Insights リソースに移行する</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Monitoring &amp;amp; Integration サポート チームの北山です。&lt;br&gt;今回の記事では、Application Insights リソースのクラシック版とワークスペース版との違いについて説明します。&lt;/p&gt;
&lt;h2 id=&quot;目次</summary>
      
    
    
    
    
    <category term="Tips" scheme="https://jpazmon-integ.github.io/blog/tags/Tips/"/>
    
    <category term="FAQ" scheme="https://jpazmon-integ.github.io/blog/tags/FAQ/"/>
    
    <category term="Application Insights" scheme="https://jpazmon-integ.github.io/blog/tags/Application-Insights/"/>
    
  </entry>
  
</feed>
